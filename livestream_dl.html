<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>livestream_dl API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#ls-dlp">ls-dlp</a>
  <ul>
    <li><a href="#key-features">Key Features</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#installation">Installation</a></li>
    <li><a href="#usage">Usage</a></li>
    <li><a href="#command-line-options">Command Line Options</a></li>
    <li><a href="#downloader-methods">Downloader methods</a></li>
    <li><a href="#known-issues">Known Issues</a></li>
  </ul></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#LiveStreamDownloader">LiveStreamDownloader</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LiveStreamDownloader.__init__">LiveStreamDownloader</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.kill_this">kill_this</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.kill_all">kill_all</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.cleanup">cleanup</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.live_chat_result">live_chat_result</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.chat_timeout">chat_timeout</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.file_names">file_names</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.stats">stats</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.refresh_json">refresh_json</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.live_status">live_status</a>
                        </li>
                        <li>
                                <a class="variable" href="#LiveStreamDownloader.lock">lock</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.download_stream">download_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.download_stream_direct">download_stream_direct</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.recover_stream">recover_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.submit_download">submit_download</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.download_segments">download_segments</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.output_filename">output_filename</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.move_to_final">move_to_final</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.download_live_chat">download_live_chat</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.replace_ip_in_json">replace_ip_in_json</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.remove_urls_from_json">remove_urls_from_json</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.download_auxiliary_files">download_auxiliary_files</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.create_mp4">create_mp4</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.write_ffmpeg_command">write_ffmpeg_command</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.convert_bytes">convert_bytes</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.print_stats">print_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.add_url_param">add_url_param</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.trim_info_json">trim_info_json</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.remove_format_segment_playlist_from_info_dict">remove_format_segment_playlist_from_info_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#LiveStreamDownloader.refresh_info_json">refresh_info_json</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#__version__">__version__</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
livestream_dl    </h1>

                        <div class="docstring"><h1 id="ls-dlp">ls-dlp</h1>

<p>This is a forked project of <a href="https://github.com/CanOfSocks/livestream_dl">livestream_dl</a>.</p>

<p>A robust YouTube livestream downloader that combines the reliability of <a href="https://github.com/yt-dlp/yt-dlp">yt-dlp</a> with the fragment-based downloading principles of <a href="https://github.com/Kethsar/ytarchive">ytarchive</a>.</p>

<p>This tool focuses on using <code>yt-dlp</code> for stream information extraction, ensuring compatibility with YouTube's changing infrastructure. It is designed to handle live recording with the ability to recover streams if they become unavailable (e.g., go private) during the download process.</p>

<h2 id="key-features">Key Features</h2>

<ul>
<li><strong>Robust Downloading:</strong> Uses <code>yt-dlp</code> for extraction, minimizing breakage from YouTube updates.</li>
<li><strong>Stream Recovery:</strong> capable of recovering streams that go private during recording (requires specific configuration).</li>
<li><strong>Dual Write Modes:</strong> Supports both direct <code>.ts</code> file writing (low disk IO) and SQLite-backed downloading (safer for unstable connections).</li>
<li><strong>Live Chat:</strong> Integrated support for downloading live chat (via <code>yt-dlp</code>) and bundling it into a ZIP file.</li>
<li><strong>Channel Monitoring:</strong> Automated monitoring of channels for upcoming or live streams.</li>
<li><strong>Protocol Fallbacks:</strong> Optional support for DASH and HLS (m3u8) protocols to avoid modifying <code>yt-dlp</code> source code.</li>
</ul>

<hr />

<h2 id="requirements">Requirements</h2>

<ul>
<li><a href="https://www.python.org/">Python</a> 3.12+ (Developed on 3.13)</li>
<li><a href="https://ffmpeg.org/">FFmpeg</a> (Required for merging video/audio)</li>
<li><a href="https://deno.com/">deno</a> Required for yt-dlp</li>
</ul>

<h2 id="installation">Installation</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/eggplants/livearchive_dl
</code></pre>
</div>

<h2 id="usage">Usage</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code>ls-dlp<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span><span class="o">[</span>VIDEO_URL_OR_ID<span class="o">]</span>
</code></pre>
</div>

<h3 id="examples">Examples</h3>

<p><strong>Basic download:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>ls-dlp<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--dash<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--m3u8<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--write-thumbnail<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--embed-thumbnail<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--wait-for-video<span class="w"> </span><span class="s2">&quot;60:600&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--clean-info-json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--remove-ip-from-json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--live-chat<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resolution<span class="w"> </span><span class="s2">&quot;best&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--write-info-json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-level<span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="w"> </span>--<span class="w"> </span><span class="s2">&quot;[VIDEO_ID]&quot;</span>
</code></pre>
</div>

<p><strong>Download with live chat and embed thumbnail:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>ls-dlp<span class="w"> </span>--live-chat<span class="w"> </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span>--embed-thumbnail<span class="w"> </span>VIDEO_ID
</code></pre>
</div>

<p><strong>Monitor a channel for streams:</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code>ls-dlp<span class="w"> </span>--monitor-channel<span class="w"> </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span>--dash<span class="w"> </span>--m3u8<span class="w"> </span>--wait-for-video<span class="w"> </span><span class="m">60</span><span class="w"> </span>CHANNEL_ID
</code></pre>
</div>

<hr />

<h2 id="command-line-options">Command Line Options</h2>

<h3 id="general-configuration">General Configuration</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>ID</code></td>
  <td><code>None</code></td>
  <td>The video URL or ID (Positional argument).</td>
</tr>
<tr>
  <td><code>--help</code>, <code>-h</code></td>
  <td>N/A</td>
  <td>Show the help message and exit.</td>
</tr>
<tr>
  <td><code>--cookies</code></td>
  <td><code>None</code></td>
  <td>Path to a Netscape-formatted cookies file (required for age-gated or members-only content).</td>
</tr>
<tr>
  <td><code>--temp-folder</code></td>
  <td><code>None</code></td>
  <td>Path for temporary files (database, segments). Supports <code>yt-dlp</code> output formatting.</td>
</tr>
<tr>
  <td><code>--output</code></td>
  <td><code>%(fulltitle)s (%(id)s)</code></td>
  <td>Path/filename for output files. Supports <a href="https://github.com/yt-dlp/yt-dlp?tab=readme-ov-file#output-template">yt-dlp output formatting</a>. A good example is: <code>"[%(release_date,upload_date)s] %(fulltitle).120B [%(channel)s] (%(id)s)"</code></td>
</tr>
<tr>
  <td><code>--ext</code></td>
  <td><code>None</code></td>
  <td>Force the extension of the final video file (e.g., <code>.mp4</code>, <code>.mkv</code>).</td>
</tr>
<tr>
  <td><code>--json-file</code></td>
  <td><code>None</code></td>
  <td>Path to an existing <code>yt-dlp</code> info.json file. Overrides <code>ID</code> and skips retrieving URLs from the web.</td>
</tr>
<tr>
  <td><code>--write-ffmpeg-command</code></td>
  <td><code>False</code></td>
  <td>Writes the final FFmpeg command used to merge the file to a <code>.txt</code> file for debugging or manual merging.</td>
</tr>
</tbody>
</table>

<h3 id="download-formatting">Download &amp; Formatting</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--resolution</code></td>
  <td><code>best</code></td>
  <td>Desired resolution. Can be <code>best</code>, <code>audio_only</code>, or a custom <a href="https://github.com/yt-dlp/yt-dlp?tab=readme-ov-file#format-selection">yt-dlp format filter</a>. <br>-Audio is always set to "ba" (best audio) regardless of filters. <br>-"best" is converted to "bv". <br>-If unspecified, a prompt will appear.</td>
</tr>
<tr>
  <td><code>--custom-sort</code></td>
  <td><code>None</code></td>
  <td>Custom sorting algorithm for formats based on <a href="https://github.com/yt-dlp/yt-dlp?tab=readme-ov-file#sorting-formats">yt-dlp sorting syntax</a>.</td>
</tr>
<tr>
  <td><code>--threads</code></td>
  <td><code>1</code></td>
  <td>Number of download threads <em>per format</em>. Total threads = this value Ã— 2 (for video+audio).</td>
</tr>
<tr>
  <td><code>--batch-size</code></td>
  <td><code>5</code></td>
  <td>Number of segments downloaded before the temporary database is committed to disk (reduces disk IO).</td>
</tr>
<tr>
  <td><code>--segment-retries</code></td>
  <td><code>10</code></td>
  <td>Number of times to retry downloading a specific segment before failing.</td>
</tr>
<tr>
  <td><code>--dash</code></td>
  <td><code>False</code></td>
  <td>Use DASH URLs as fallback. Does <strong>not</strong> require <code>yt-dlp</code> modification but prevents stream recovery if DASH URLs are used.</td>
</tr>
<tr>
  <td><code>--m3u8</code></td>
  <td><code>False</code></td>
  <td>Use HLS (m3u8) URLs as fallback. Combined audio/video streams (halves requests). Does <strong>not</strong> require <code>yt-dlp</code> modification but prevents recovery if m3u8 URLs are used.</td>
</tr>
<tr>
  <td><code>--force-m3u8</code></td>
  <td><code>False</code></td>
  <td>Forces the use of m3u8 stream URLs.</td>
</tr>
<tr>
  <td><code>--wait-for-video</code></td>
  <td><code>None</code></td>
  <td>Wait time (int) or range (<code>min:max</code>) to wait for a video to start or become available. Refer to <a href="https://github.com/yt-dlp/yt-dlp?tab=readme-ov-file#general-options">yt-dlp's documentation</a></td>
</tr>
<tr>
  <td><code>--ytdlp-options</code></td>
  <td><code>None</code></td>
  <td>JSON string of additional <code>yt-dlp</code> options (overwrites conflicts). E.g <code>'{"extractor_args":{"youtubepot-bgutilhttp":{"base_url":["http://bgutil-provider:4416"]}}}'</code> to use Potoken retrieval. Refer to full options for more examples.</td>
</tr>
</tbody>
</table>

<h3 id="processing-output">Processing &amp; Output</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--no-merge</code></td>
  <td><code>False</code></td>
  <td>Do not merge video and audio using FFmpeg after download.</td>
</tr>
<tr>
  <td><code>--merge</code></td>
  <td><code>False</code></td>
  <td>Force merging video using FFmpeg (overrides <code>--no-merge</code>).</td>
</tr>
<tr>
  <td><code>--write-thumbnail</code></td>
  <td><code>False</code></td>
  <td>Save the video thumbnail to a separate file.</td>
</tr>
<tr>
  <td><code>--embed-thumbnail</code></td>
  <td><code>False</code></td>
  <td>Embed the thumbnail into the final video file (ignored if <code>--no-merge</code> is active).</td>
</tr>
<tr>
  <td><code>--write-info-json</code></td>
  <td><code>False</code></td>
  <td>Write the video metadata to an <code>info.json</code> file.</td>
</tr>
<tr>
  <td><code>--write-description</code></td>
  <td><code>False</code></td>
  <td>Write the video description to a separate text file.</td>
</tr>
<tr>
  <td><code>--keep-temp-files</code></td>
  <td><code>False</code></td>
  <td>Keep all temporary files (database and TS files) after finishing.</td>
</tr>
<tr>
  <td><code>--keep-ts-files</code></td>
  <td><code>False</code></td>
  <td>Keep the intermediate TS files but delete the database.</td>
</tr>
<tr>
  <td><code>--live-chat</code></td>
  <td><code>False</code></td>
  <td>Download live chat (requires <code>yt-dlp</code>).</td>
</tr>
<tr>
  <td><code>--stop-chat-when-done</code></td>
  <td><code>300</code></td>
  <td>Max seconds to wait for chat download to finish after stream ends.</td>
</tr>
</tbody>
</table>

<h3 id="database-storage-modes">Database &amp; Storage Modes</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--database-in-memory</code></td>
  <td><code>False</code></td>
  <td>Keep the segment database in RAM. High memory usage; not recommended for long streams.</td>
</tr>
<tr>
  <td><code>--direct-to-ts</code></td>
  <td><code>False</code></td>
  <td>Write directly to a <code>.ts</code> file instead of using a SQLite database. See "Downloader methods" below.</td>
</tr>
<tr>
  <td><code>--keep-database-file</code></td>
  <td><code>False</code></td>
  <td>Keep the database file after completion. If using <code>--direct-to-ts</code>, keeps the state file.</td>
</tr>
</tbody>
</table>

<h3 id="recovery-resilience">Recovery &amp; Resilience</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--recovery</code></td>
  <td><code>False</code></td>
  <td>Puts the downloader directly into stream recovery mode.</td>
</tr>
<tr>
  <td><code>--force-recover-merge</code></td>
  <td><code>False</code></td>
  <td>Forces merging to the final file even if not all segments were successfully recovered.</td>
</tr>
<tr>
  <td><code>--recovery-failure-tolerance</code></td>
  <td><code>0</code></td>
  <td>Max number of fragments allowed to fail during recovery without throwing a final error.</td>
</tr>
<tr>
  <td><code>--wait-limit</code></td>
  <td><code>0</code></td>
  <td>Max wait intervals (~10s each) for new segments. If <code>0</code>, waits until status changes to <code>post_live</code> or <code>was_live</code>.</td>
</tr>
</tbody>
</table>

<h3 id="network-logging">Network &amp; Logging</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--proxy</code></td>
  <td><code>None</code></td>
  <td>Proxy URL (string) or JSON string for multiple methods. First proxy used for <code>yt-dlp</code>/chat.</td>
</tr>
<tr>
  <td><code>--ipv4</code></td>
  <td><code>False</code></td>
  <td>Force IPv4 only.</td>
</tr>
<tr>
  <td><code>--ipv6</code></td>
  <td><code>False</code></td>
  <td>Force IPv6 only.</td>
</tr>
<tr>
  <td><code>--log-level</code></td>
  <td><code>INFO</code></td>
  <td>Logging level: <code>DEBUG</code>, <code>VERBOSE</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>, <code>CRITICAL</code>. <code>Verbose</code> logging is a custom level that includes the <code>INFO</code> logs of <code>yt-dlp</code>.</td>
</tr>
<tr>
  <td><code>--no-console</code></td>
  <td><code>False</code></td>
  <td>Disable printing log messages to the console.</td>
</tr>
<tr>
  <td><code>--log-file</code></td>
  <td><code>None</code></td>
  <td>Path to a file where log messages will be saved.</td>
</tr>
<tr>
  <td><code>--stats-as-json</code></td>
  <td><code>False</code></td>
  <td>Prints download statistics as a JSON string (bypasses log level).</td>
</tr>
<tr>
  <td><code>--new-line</code></td>
  <td><code>False</code></td>
  <td>Ensures console messages always print to a new line (useful for some terminals).</td>
</tr>
</tbody>
</table>

<h3 id="channel-monitoring">Channel Monitoring</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--monitor-channel</code></td>
  <td><code>False</code></td>
  <td>Enables channel monitoring mode. Use the Channel ID in the <code>ID</code> argument.</td>
</tr>
<tr>
  <td><code>--members-only</code></td>
  <td><code>False</code></td>
  <td>Monitor the 'Members Only' playlist instead of public streams. Requires cookies.</td>
</tr>
<tr>
  <td><code>--upcoming-lookahead</code></td>
  <td><code>24</code></td>
  <td>Maximum time (in hours) to look ahead for upcoming videos to schedule.</td>
</tr>
<tr>
  <td><code>--playlist-items</code></td>
  <td><code>50</code></td>
  <td>Maximum number of playlist items to check when monitoring.</td>
</tr>
</tbody>
</table>

<h3 id="metadata-privacy">Metadata Privacy</h3>

<table>
<thead>
<tr>
  <th>Option</th>
  <th>Default</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>--remove-ip-from-json</code></td>
  <td><code>False</code></td>
  <td>Replaces IP addresses in <code>info.json</code> with <code>0.0.0.0</code>.</td>
</tr>
<tr>
  <td><code>--clean-urls</code></td>
  <td><code>False</code></td>
  <td>Removes potentially identifiable stream URLs from <code>info.json</code>.</td>
</tr>
<tr>
  <td><code>--clean-info-json</code></td>
  <td><code>False</code></td>
  <td>Enables <code>yt-dlp</code>'s internal <code>clean-info-json</code> option.</td>
</tr>
</tbody>
</table>

<h3 id="full-options">Full options</h3>

<pre><code>$ ls-dlp --help
usage: runner.py [-h] [--resolution RESOLUTION] [--custom-sort CUSTOM_SORT] [--threads THREADS] [--batch-size BATCH_SIZE] [--segment-retries SEGMENT_RETRIES] [--no-merge] [--merge] [--cookies COOKIES] [--output OUTPUT] [--ext EXT] [--temp-folder TEMP_FOLDER] [--write-thumbnail] [--embed-thumbnail]      
                 [--write-info-json] [--write-description] [--keep-temp-files] [--keep-ts-files] [--live-chat] [--keep-database-file] [--recovery] [--force-recover-merge] [--recovery-failure-tolerance RECOVERY_FAILURE_TOLERANCE] [--wait-limit WAIT_LIMIT] [--database-in-memory] [--direct-to-ts]
                 [--wait-for-video WAIT_FOR_VIDEO] [--json-file JSON_FILE] [--remove-ip-from-json] [--clean-urls] [--clean-info-json] [--log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}] [--no-console] [--log-file LOG_FILE] [--write-ffmpeg-command] [--stats-as-json] [--ytdlp-options YTDLP_OPTIONS] [--dash]
                 [--m3u8] [--force-m3u8] [--proxy [PROXY]] [--ipv4 | --ipv6] [--stop-chat-when-done STOP_CHAT_WHEN_DONE] [--new-line] [--monitor-channel] [--members-only] [--upcoming-lookahead UPCOMING_LOOKAHEAD] [--playlist-items PLAYLIST_ITEMS]
                 [ID]

Download YouTube livestreams (https://github.com/CanOfSocks/livestream_dl)

positional arguments:
  ID                    The video URL or ID

options:
  -h, --help            show this help message and exit
  --resolution RESOLUTION
                        Desired resolution. Can be best, audio_only or a custom filter based off yt-dlp's format filtering: https://github.com/yt-dlp/yt-dlp?tab=readme-ov-file#filtering-formats. Audio will always be set as "ba" (best audio) regardless of filters set. "best" will be converted to "bv" A prompt     
                        will be displayed if no value is entered
  --custom-sort CUSTOM_SORT
                        Custom sorting algorithm for formats based off yt-dlp's format sorting: https://github.com/yt-dlp/yt-dlp?tab=readme-ov-file#sorting-formats
  --threads THREADS     Number of download threads per format. This will be 2x for an video and audio download. Default: 1
  --batch-size BATCH_SIZE
                        Number of segments before the temporary database is committed to disk. This is useful for reducing disk access instances. Default: 5
  --segment-retries SEGMENT_RETRIES
                        Number of times to retry grabbing a segment. Default: 10
  --no-merge            Don't merge video using ffmpeg
  --merge               Merge video using ffmpeg, overrides --no-merge
  --cookies COOKIES     Path to cookies file
  --output OUTPUT       Path/file name for output files. Supports yt-dlp output formatting
  --ext EXT             Force extension of video file. E.g. '.mp4'
  --temp-folder TEMP_FOLDER
                        Path for temporary files. Supports yt-dlp output formatting
  --write-thumbnail     Write thumbnail to file
  --embed-thumbnail     Embed thumbnail into final file. Ignored if --no-merge is used
  --write-info-json     Write info.json to file
  --write-description   Write description to file
  --keep-temp-files     Keep all temp files i.e. database and/or ts files
  --keep-ts-files       Keep all ts files
  --live-chat           Get Live chat
  --keep-database-file  Keep database file. If using with --direct-to-ts, this keeps the state file
  --recovery            Puts downloader into stream recovery mode
  --force-recover-merge
                        Forces merging to final file even if all segements could not be recovered
  --recovery-failure-tolerance RECOVERY_FAILURE_TOLERANCE
                        Maximum number of fragments that fail to download (exceed the retry limit) and not throw an error. May cause unexpected issues when merging to .ts file and remuxing. Default: 0
  --wait-limit WAIT_LIMIT
                        Set maximum number of wait intervals for new segments. Each wait interval is ~10s (e.g. a value of 20 would be 200s). A mimimum of value of 20 is recommended. Stream URLs are refreshed every 10 intervals. A value of 0 wait until the video moves into 'was_live' or 'post_live' status.       
                        Default: 0
  --database-in-memory  Keep stream segments database in memory. Requires a lot of RAM (Not recommended)
  --direct-to-ts        Write directly to ts file instead of database. May use more RAM if a segment is slow to download. This overwrites most database options
  --wait-for-video WAIT_FOR_VIDEO
                        Wait time (int) or Minimum and maximum (min:max) interval to wait for a video
  --json-file JSON_FILE
                        Path to existing yt-dlp info.json file. Overrides ID and skips retrieving URLs
  --remove-ip-from-json
                        Replaces IP entries in info.json with 0.0.0.0
  --clean-urls          Removes stream URLs from info.json that contain potentially identifiable information. These URLs are usually useless once they have expired
  --clean-info-json     Enables yt-dlp's 'clean-info-json' option
  --log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}
                        Set the logging level. Default is INFO.
  --no-console          Do not log messages to the console.
  --log-file LOG_FILE   Path to the log file where messages will be saved.
  --write-ffmpeg-command
                        Writes FFmpeg command to a txt file
  --stats-as-json       Prints stats as a JSON formatted string. Bypasses logging and prints regardless of log level
  --ytdlp-options YTDLP_OPTIONS
                        Additional yt-dlp options as a JSON string. Overwrites any options that are already defined by other options. Available options: https://github.com/yt-dlp/yt-dlp/blob/master/yt_dlp/YoutubeDL.py#L183. E.g. '{"extractor_args": {"youtube": {"player_client": ["web_creator"]}, "youtubepot-     
                        bgutilhttp":{ "base_url": ["http://10.1.1.40:4416"]}}}' if you have installed the potoken plugin
  --dash                Gets any available DASH urls as a fallback to adaptive URLs. Dash URLs do not require yt-dlp modification to be used, but can't be used for stream recovery and can cause large info.json files when a stream is in the 'post_live' status
  --m3u8                Gets any available m3u8 urls as a fallback to adaptive URLs. m3u8 URLs do not require yt-dlp modification to be used, but can't be used for stream recovery. m3u8 URLs provide both video and audio in each fragment and could allow for the amount of segment download requests to be halved     
  --force-m3u8          Forces use of m3u8 stream URLs
  --proxy [PROXY]       (Requires testing) Specify proxy to use for web requests. Can be a string for a single proxy or a JSON formatted string to specify multiple methods. For multiple, refer to format https://requests.readthedocs.io/en/latest/user/advanced/#proxies. The first proxy specified will be used for   
                        yt-dlp and live chat functions.
  --ipv4                Force IPv4 only
  --ipv6                Force IPv6 only
  --stop-chat-when-done STOP_CHAT_WHEN_DONE
                        Wait a maximum of X seconds after a stream is finished to download live chat. Default: 300. This is useful if waiting for chat to end causes hanging.
  --new-line            Console messages always print to new line. (Currently only ensured for stats output)
  --monitor-channel     Use monitor channel feature (Alpha). Specify channel ID in 'ID' argument
  --members-only        Monitor 'Members Only' playlist for streams instead of 'Streams' playlist. Requires cookies.
  --upcoming-lookahead UPCOMING_LOOKAHEAD
                        Maximum time (in hours) to start a downloader instance for a video. Default: 24
  --playlist-items PLAYLIST_ITEMS
                        Maximum number of playlist items to check. Default: 50
</code></pre>

<hr />

<h2 id="downloader-methods">Downloader methods</h2>

<p>There are two download methods available for livestream downloading, using a SQLite database and writing directly to a ts file. For stream recovery, only the SQLite option is available. Merging to a video or audio file (.mp4, .mkv, .ogg etc) will require an extra write of information. The default method is the SQLite method.</p>

<h3 id="direct-writing-to-a-ts-file">Direct writing to a .ts file</h3>

<p>Writing directly to a ts file helps reduce the number of writes to a disk during the recording as it is only necessary to write to the final ts file. This may reduce disk wear over a long period of time of downloading many streams.
As segments are downloaded, the sequence number of the segment is used to decide which segment will be appended to the ts file next. If the "next" segment is not available to be written to the disk, other segments will be stored in RAM until the respective previous segment has been written to the disk. This performs in a similar way to <a href="https://github.com/Kethsar/ytarchive">ytarchive</a>.
To reduce file opening and closing actions on the file system, if multiple sequential segments can be written at once, they will be written into the file at once.
A state file is saved each time segments are written to the disk, saving the latest segment and size of the file, so the downloader doesn't need to re-download segments should the downloading session stop for any reason.
Segment downloads are not guaranteed to finish in a sequential order if more than 1 thread is used. If a segment is particularly slow at downloading, this may increase ram usage significantly while subsequent segments are saved in RAM.</p>

<p>For regular livestream recording that doesn't experience frequent segment download errors, using the direct writing method will work well.</p>

<h3 id="sqlite">SQLite</h3>

<p>The SQLite downloader method is used to improve handling of non-sequential successful segment downloads. This works by creating and using a basic table of the segment number as an ID and a blob to store the segment data. Once all segments are downloaded, a query is executed to sort all of the downloaded segments into the correct order and saved to a .ts file. This helps significantly to manage downloaded segments when failures occur often, such as unavailable stream recovery. By writing to the database and a final .ts file, this will require 2 full writes of the downloaded data, which may increase wear on flash-based systems. For most users, this increased wear will not be significant in the long-term.
This improves over saving individual segment files like <a href="https://www.google.com/search?q=https://github.com/Kethsar/ytarchive%5D(https://github.com/HoloArchivists/ytarchive-raw-go)">ytarchive-raw-go</a> as all the downloaded segments are encapsilated into a single file, making it easier for the file system to handle.
In the SQLite method, the existence of a downloaded segment is checked before it is downloaded. This allows failed segments to be "looped back to" later without causing other slowdowns, and ensures some information is saved for a segment (even if it is empty, as is the case sometimes).</p>

<hr />

<h2 id="known-issues">Known Issues</h2>

<ul>
<li><strong>Concurrent Futures:</strong> The downloader uses <code>concurrent.futures</code> for thread management. While robust, stopping the downloader gracefully (e.g., via Keyboard Interrupt) can sometimes be delayed if a thread is stuck on a request.</li>
<li><strong>Stream Recovery:</strong> This feature is currently in a "semi-broken" state and may not work reliably for all stream types.</li>
</ul>
</div>

                        <input id="mod-livestream_dl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-livestream_dl-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;.. include:: ../README.md&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">importlib.metadata</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.download_live</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiveStreamDownloader</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="k">except</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">PackageNotFoundError</span><span class="p">:</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.0.0&quot;</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s2">&quot;LiveStreamDownloader&quot;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;__version__&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="LiveStreamDownloader">
                            <input id="LiveStreamDownloader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LiveStreamDownloader</span>:

                <label class="view-source-button" for="LiveStreamDownloader-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader-39"><a href="#LiveStreamDownloader-39"><span class="linenos">  39</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LiveStreamDownloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-40"><a href="#LiveStreamDownloader-40"><span class="linenos">  40</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-41"><a href="#LiveStreamDownloader-41"><span class="linenos">  41</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-42"><a href="#LiveStreamDownloader-42"><span class="linenos">  42</span></a>        <span class="n">kill_all</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
</span><span id="LiveStreamDownloader-43"><a href="#LiveStreamDownloader-43"><span class="linenos">  43</span></a>        <span class="n">cleanup</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
</span><span id="LiveStreamDownloader-44"><a href="#LiveStreamDownloader-44"><span class="linenos">  44</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-45"><a href="#LiveStreamDownloader-45"><span class="linenos">  45</span></a>        <span class="n">kill_this</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-46"><a href="#LiveStreamDownloader-46"><span class="linenos">  46</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-47"><a href="#LiveStreamDownloader-47"><span class="linenos">  47</span></a>        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-48"><a href="#LiveStreamDownloader-48"><span class="linenos">  48</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="LiveStreamDownloader-49"><a href="#LiveStreamDownloader-49"><span class="linenos">  49</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-50"><a href="#LiveStreamDownloader-50"><span class="linenos">  50</span></a>            <span class="c1"># 1. Create a Named Logger instance and assign it to self.logger</span>
</span><span id="LiveStreamDownloader-51"><a href="#LiveStreamDownloader-51"><span class="linenos">  51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-52"><a href="#LiveStreamDownloader-52"><span class="linenos">  52</span></a>            <span class="c1"># Ensure it processes messages (important if you don&#39;t call setup_logging immediately)</span>
</span><span id="LiveStreamDownloader-53"><a href="#LiveStreamDownloader-53"><span class="linenos">  53</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-54"><a href="#LiveStreamDownloader-54"><span class="linenos">  54</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="LiveStreamDownloader-55"><a href="#LiveStreamDownloader-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span> <span class="o">=</span> <span class="n">kill_this</span> <span class="ow">or</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-56"><a href="#LiveStreamDownloader-56"><span class="linenos">  56</span></a>
</span><span id="LiveStreamDownloader-57"><a href="#LiveStreamDownloader-57"><span class="linenos">  57</span></a>        <span class="c1"># Global state converted to instance attributes</span>
</span><span id="LiveStreamDownloader-58"><a href="#LiveStreamDownloader-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span> <span class="o">=</span> <span class="n">kill_all</span>
</span><span id="LiveStreamDownloader-59"><a href="#LiveStreamDownloader-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">cleanup</span>
</span><span id="LiveStreamDownloader-60"><a href="#LiveStreamDownloader-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live_chat_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-61"><a href="#LiveStreamDownloader-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chat_timeout</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-62"><a href="#LiveStreamDownloader-62"><span class="linenos">  62</span></a>        <span class="c1"># File name dictionary</span>
</span><span id="LiveStreamDownloader-63"><a href="#LiveStreamDownloader-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;streams&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="LiveStreamDownloader-64"><a href="#LiveStreamDownloader-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader-65"><a href="#LiveStreamDownloader-65"><span class="linenos">  65</span></a>
</span><span id="LiveStreamDownloader-66"><a href="#LiveStreamDownloader-66"><span class="linenos">  66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader-67"><a href="#LiveStreamDownloader-67"><span class="linenos">  67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="LiveStreamDownloader-68"><a href="#LiveStreamDownloader-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-69"><a href="#LiveStreamDownloader-69"><span class="linenos">  69</span></a>
</span><span id="LiveStreamDownloader-70"><a href="#LiveStreamDownloader-70"><span class="linenos">  70</span></a>    <span class="c1"># Create runner function for each download format</span>
</span><span id="LiveStreamDownloader-71"><a href="#LiveStreamDownloader-71"><span class="linenos">  71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_stream</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-72"><a href="#LiveStreamDownloader-72"><span class="linenos">  72</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-73"><a href="#LiveStreamDownloader-73"><span class="linenos">  73</span></a>        <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-74"><a href="#LiveStreamDownloader-74"><span class="linenos">  74</span></a>        <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-75"><a href="#LiveStreamDownloader-75"><span class="linenos">  75</span></a>        <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-76"><a href="#LiveStreamDownloader-76"><span class="linenos">  76</span></a>        <span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-77"><a href="#LiveStreamDownloader-77"><span class="linenos">  77</span></a>        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-78"><a href="#LiveStreamDownloader-78"><span class="linenos">  78</span></a>        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-79"><a href="#LiveStreamDownloader-79"><span class="linenos">  79</span></a>        <span class="n">keep_database</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-80"><a href="#LiveStreamDownloader-80"><span class="linenos">  80</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-81"><a href="#LiveStreamDownloader-81"><span class="linenos">  81</span></a>        <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-82"><a href="#LiveStreamDownloader-82"><span class="linenos">  82</span></a>        <span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-83"><a href="#LiveStreamDownloader-83"><span class="linenos">  83</span></a>        <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-84"><a href="#LiveStreamDownloader-84"><span class="linenos">  84</span></a>        <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-85"><a href="#LiveStreamDownloader-85"><span class="linenos">  85</span></a>        <span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-86"><a href="#LiveStreamDownloader-86"><span class="linenos">  86</span></a>        <span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-87"><a href="#LiveStreamDownloader-87"><span class="linenos">  87</span></a>        <span class="n">force_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-88"><a href="#LiveStreamDownloader-88"><span class="linenos">  88</span></a>        <span class="n">manifest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-89"><a href="#LiveStreamDownloader-89"><span class="linenos">  89</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-90"><a href="#LiveStreamDownloader-90"><span class="linenos">  90</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader-91"><a href="#LiveStreamDownloader-91"><span class="linenos">  91</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-92"><a href="#LiveStreamDownloader-92"><span class="linenos">  92</span></a>            <span class="n">download_params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-93"><a href="#LiveStreamDownloader-93"><span class="linenos">  93</span></a>            <span class="n">download_params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;download_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream</span><span class="p">})</span>
</span><span id="LiveStreamDownloader-94"><a href="#LiveStreamDownloader-94"><span class="linenos">  94</span></a>            <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-95"><a href="#LiveStreamDownloader-95"><span class="linenos">  95</span></a>            <span class="n">filetype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-96"><a href="#LiveStreamDownloader-96"><span class="linenos">  96</span></a>
</span><span id="LiveStreamDownloader-97"><a href="#LiveStreamDownloader-97"><span class="linenos">  97</span></a>            <span class="k">with</span> <span class="n">DownloadStream</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-98"><a href="#LiveStreamDownloader-98"><span class="linenos">  98</span></a>                <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-99"><a href="#LiveStreamDownloader-99"><span class="linenos">  99</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-100"><a href="#LiveStreamDownloader-100"><span class="linenos"> 100</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-101"><a href="#LiveStreamDownloader-101"><span class="linenos"> 101</span></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-102"><a href="#LiveStreamDownloader-102"><span class="linenos"> 102</span></a>                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-103"><a href="#LiveStreamDownloader-103"><span class="linenos"> 103</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-104"><a href="#LiveStreamDownloader-104"><span class="linenos"> 104</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-105"><a href="#LiveStreamDownloader-105"><span class="linenos"> 105</span></a>                <span class="n">fragment_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-106"><a href="#LiveStreamDownloader-106"><span class="linenos"> 106</span></a>                <span class="n">yt_dlp_options</span><span class="o">=</span><span class="n">yt_dlp_options</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-107"><a href="#LiveStreamDownloader-107"><span class="linenos"> 107</span></a>                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-108"><a href="#LiveStreamDownloader-108"><span class="linenos"> 108</span></a>                <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="n">yt_dlp_sort</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-109"><a href="#LiveStreamDownloader-109"><span class="linenos"> 109</span></a>                <span class="n">include_dash</span><span class="o">=</span><span class="n">include_dash</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-110"><a href="#LiveStreamDownloader-110"><span class="linenos"> 110</span></a>                <span class="n">include_m3u8</span><span class="o">=</span><span class="n">include_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-111"><a href="#LiveStreamDownloader-111"><span class="linenos"> 111</span></a>                <span class="n">force_m3u8</span><span class="o">=</span><span class="n">force_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-112"><a href="#LiveStreamDownloader-112"><span class="linenos"> 112</span></a>                <span class="n">download_params</span><span class="o">=</span><span class="n">download_params</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-113"><a href="#LiveStreamDownloader-113"><span class="linenos"> 113</span></a>                <span class="n">livestream_coordinator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-114"><a href="#LiveStreamDownloader-114"><span class="linenos"> 114</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-115"><a href="#LiveStreamDownloader-115"><span class="linenos"> 115</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">downloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-116"><a href="#LiveStreamDownloader-116"><span class="linenos"> 116</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Recording&quot;</span>
</span><span id="LiveStreamDownloader-117"><a href="#LiveStreamDownloader-117"><span class="linenos"> 117</span></a>                <span class="n">downloader</span><span class="o">.</span><span class="n">live_dl</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-118"><a href="#LiveStreamDownloader-118"><span class="linenos"> 118</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">combine_segments_to_file</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">merged_file_name</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-119"><a href="#LiveStreamDownloader-119"><span class="linenos"> 119</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_database</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-120"><a href="#LiveStreamDownloader-120"><span class="linenos"> 120</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging to ts complete, removing </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-121"><a href="#LiveStreamDownloader-121"><span class="linenos"> 121</span></a>                    <span class="n">downloader</span><span class="o">.</span><span class="n">delete_temp_database</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-122"><a href="#LiveStreamDownloader-122"><span class="linenos"> 122</span></a>                <span class="k">elif</span> <span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-123"><a href="#LiveStreamDownloader-123"><span class="linenos"> 123</span></a>                    <span class="n">database_file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-124"><a href="#LiveStreamDownloader-124"><span class="linenos"> 124</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-125"><a href="#LiveStreamDownloader-125"><span class="linenos"> 125</span></a>
</span><span id="LiveStreamDownloader-126"><a href="#LiveStreamDownloader-126"><span class="linenos"> 126</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-127"><a href="#LiveStreamDownloader-127"><span class="linenos"> 127</span></a>                <span class="n">filetype</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">type</span>
</span><span id="LiveStreamDownloader-128"><a href="#LiveStreamDownloader-128"><span class="linenos"> 128</span></a>
</span><span id="LiveStreamDownloader-129"><a href="#LiveStreamDownloader-129"><span class="linenos"> 129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">file</span><span class="p">})</span>
</span><span id="LiveStreamDownloader-130"><a href="#LiveStreamDownloader-130"><span class="linenos"> 130</span></a>
</span><span id="LiveStreamDownloader-131"><a href="#LiveStreamDownloader-131"><span class="linenos"> 131</span></a>            <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">filetype</span>
</span><span id="LiveStreamDownloader-132"><a href="#LiveStreamDownloader-132"><span class="linenos"> 132</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-133"><a href="#LiveStreamDownloader-133"><span class="linenos"> 133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error occurred while downloading stream&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-134"><a href="#LiveStreamDownloader-134"><span class="linenos"> 134</span></a>            <span class="k">raise</span>
</span><span id="LiveStreamDownloader-135"><a href="#LiveStreamDownloader-135"><span class="linenos"> 135</span></a>
</span><span id="LiveStreamDownloader-136"><a href="#LiveStreamDownloader-136"><span class="linenos"> 136</span></a>    <span class="c1"># Create runner function for each download format</span>
</span><span id="LiveStreamDownloader-137"><a href="#LiveStreamDownloader-137"><span class="linenos"> 137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_stream_direct</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-138"><a href="#LiveStreamDownloader-138"><span class="linenos"> 138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-139"><a href="#LiveStreamDownloader-139"><span class="linenos"> 139</span></a>        <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-140"><a href="#LiveStreamDownloader-140"><span class="linenos"> 140</span></a>        <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-141"><a href="#LiveStreamDownloader-141"><span class="linenos"> 141</span></a>        <span class="n">batch_size</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-142"><a href="#LiveStreamDownloader-142"><span class="linenos"> 142</span></a>        <span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-143"><a href="#LiveStreamDownloader-143"><span class="linenos"> 143</span></a>        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-144"><a href="#LiveStreamDownloader-144"><span class="linenos"> 144</span></a>        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-145"><a href="#LiveStreamDownloader-145"><span class="linenos"> 145</span></a>        <span class="n">keep_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-146"><a href="#LiveStreamDownloader-146"><span class="linenos"> 146</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-147"><a href="#LiveStreamDownloader-147"><span class="linenos"> 147</span></a>        <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-148"><a href="#LiveStreamDownloader-148"><span class="linenos"> 148</span></a>        <span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-149"><a href="#LiveStreamDownloader-149"><span class="linenos"> 149</span></a>        <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-150"><a href="#LiveStreamDownloader-150"><span class="linenos"> 150</span></a>        <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-151"><a href="#LiveStreamDownloader-151"><span class="linenos"> 151</span></a>        <span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-152"><a href="#LiveStreamDownloader-152"><span class="linenos"> 152</span></a>        <span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-153"><a href="#LiveStreamDownloader-153"><span class="linenos"> 153</span></a>        <span class="n">force_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-154"><a href="#LiveStreamDownloader-154"><span class="linenos"> 154</span></a>        <span class="n">manifest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-155"><a href="#LiveStreamDownloader-155"><span class="linenos"> 155</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-156"><a href="#LiveStreamDownloader-156"><span class="linenos"> 156</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader-157"><a href="#LiveStreamDownloader-157"><span class="linenos"> 157</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-158"><a href="#LiveStreamDownloader-158"><span class="linenos"> 158</span></a>            <span class="n">download_params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-159"><a href="#LiveStreamDownloader-159"><span class="linenos"> 159</span></a>            <span class="n">download_params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;download_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream_direct</span><span class="p">})</span>
</span><span id="LiveStreamDownloader-160"><a href="#LiveStreamDownloader-160"><span class="linenos"> 160</span></a>            <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-161"><a href="#LiveStreamDownloader-161"><span class="linenos"> 161</span></a>            <span class="n">filetype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-162"><a href="#LiveStreamDownloader-162"><span class="linenos"> 162</span></a>
</span><span id="LiveStreamDownloader-163"><a href="#LiveStreamDownloader-163"><span class="linenos"> 163</span></a>            <span class="k">with</span> <span class="n">DownloadStreamDirect</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-164"><a href="#LiveStreamDownloader-164"><span class="linenos"> 164</span></a>                <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-165"><a href="#LiveStreamDownloader-165"><span class="linenos"> 165</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-166"><a href="#LiveStreamDownloader-166"><span class="linenos"> 166</span></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-167"><a href="#LiveStreamDownloader-167"><span class="linenos"> 167</span></a>                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-168"><a href="#LiveStreamDownloader-168"><span class="linenos"> 168</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-169"><a href="#LiveStreamDownloader-169"><span class="linenos"> 169</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-170"><a href="#LiveStreamDownloader-170"><span class="linenos"> 170</span></a>                <span class="n">fragment_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-171"><a href="#LiveStreamDownloader-171"><span class="linenos"> 171</span></a>                <span class="n">yt_dlp_options</span><span class="o">=</span><span class="n">yt_dlp_options</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-172"><a href="#LiveStreamDownloader-172"><span class="linenos"> 172</span></a>                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-173"><a href="#LiveStreamDownloader-173"><span class="linenos"> 173</span></a>                <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="n">yt_dlp_sort</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-174"><a href="#LiveStreamDownloader-174"><span class="linenos"> 174</span></a>                <span class="n">include_dash</span><span class="o">=</span><span class="n">include_dash</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-175"><a href="#LiveStreamDownloader-175"><span class="linenos"> 175</span></a>                <span class="n">include_m3u8</span><span class="o">=</span><span class="n">include_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-176"><a href="#LiveStreamDownloader-176"><span class="linenos"> 176</span></a>                <span class="n">force_m3u8</span><span class="o">=</span><span class="n">force_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-177"><a href="#LiveStreamDownloader-177"><span class="linenos"> 177</span></a>                <span class="n">download_params</span><span class="o">=</span><span class="n">download_params</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-178"><a href="#LiveStreamDownloader-178"><span class="linenos"> 178</span></a>                <span class="n">livestream_coordinator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-179"><a href="#LiveStreamDownloader-179"><span class="linenos"> 179</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-180"><a href="#LiveStreamDownloader-180"><span class="linenos"> 180</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">downloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-181"><a href="#LiveStreamDownloader-181"><span class="linenos"> 181</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Recording&quot;</span>
</span><span id="LiveStreamDownloader-182"><a href="#LiveStreamDownloader-182"><span class="linenos"> 182</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">live_dl</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-183"><a href="#LiveStreamDownloader-183"><span class="linenos"> 183</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-184"><a href="#LiveStreamDownloader-184"><span class="linenos"> 184</span></a>                <span class="n">filetype</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">type</span>
</span><span id="LiveStreamDownloader-185"><a href="#LiveStreamDownloader-185"><span class="linenos"> 185</span></a>                <span class="n">downloader</span><span class="o">.</span><span class="n">delete_state_file</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-186"><a href="#LiveStreamDownloader-186"><span class="linenos"> 186</span></a>
</span><span id="LiveStreamDownloader-187"><a href="#LiveStreamDownloader-187"><span class="linenos"> 187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">file</span><span class="p">})</span>
</span><span id="LiveStreamDownloader-188"><a href="#LiveStreamDownloader-188"><span class="linenos"> 188</span></a>            <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">filetype</span>
</span><span id="LiveStreamDownloader-189"><a href="#LiveStreamDownloader-189"><span class="linenos"> 189</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-190"><a href="#LiveStreamDownloader-190"><span class="linenos"> 190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error occurred while downloading stream&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-191"><a href="#LiveStreamDownloader-191"><span class="linenos"> 191</span></a>            <span class="k">raise</span>
</span><span id="LiveStreamDownloader-192"><a href="#LiveStreamDownloader-192"><span class="linenos"> 192</span></a>
</span><span id="LiveStreamDownloader-193"><a href="#LiveStreamDownloader-193"><span class="linenos"> 193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recover_stream</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-194"><a href="#LiveStreamDownloader-194"><span class="linenos"> 194</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-195"><a href="#LiveStreamDownloader-195"><span class="linenos"> 195</span></a>        <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-196"><a href="#LiveStreamDownloader-196"><span class="linenos"> 196</span></a>        <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-197"><a href="#LiveStreamDownloader-197"><span class="linenos"> 197</span></a>        <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-198"><a href="#LiveStreamDownloader-198"><span class="linenos"> 198</span></a>        <span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-199"><a href="#LiveStreamDownloader-199"><span class="linenos"> 199</span></a>        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-200"><a href="#LiveStreamDownloader-200"><span class="linenos"> 200</span></a>        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-201"><a href="#LiveStreamDownloader-201"><span class="linenos"> 201</span></a>        <span class="n">keep_database</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-202"><a href="#LiveStreamDownloader-202"><span class="linenos"> 202</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-203"><a href="#LiveStreamDownloader-203"><span class="linenos"> 203</span></a>        <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-204"><a href="#LiveStreamDownloader-204"><span class="linenos"> 204</span></a>        <span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-205"><a href="#LiveStreamDownloader-205"><span class="linenos"> 205</span></a>        <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-206"><a href="#LiveStreamDownloader-206"><span class="linenos"> 206</span></a>        <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-207"><a href="#LiveStreamDownloader-207"><span class="linenos"> 207</span></a>        <span class="n">force_merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-208"><a href="#LiveStreamDownloader-208"><span class="linenos"> 208</span></a>        <span class="n">recovery_failure_tolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-209"><a href="#LiveStreamDownloader-209"><span class="linenos"> 209</span></a>        <span class="n">manifest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-210"><a href="#LiveStreamDownloader-210"><span class="linenos"> 210</span></a>        <span class="n">stream_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-211"><a href="#LiveStreamDownloader-211"><span class="linenos"> 211</span></a>        <span class="n">no_merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-212"><a href="#LiveStreamDownloader-212"><span class="linenos"> 212</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-213"><a href="#LiveStreamDownloader-213"><span class="linenos"> 213</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader-214"><a href="#LiveStreamDownloader-214"><span class="linenos"> 214</span></a>        <span class="k">if</span> <span class="n">stream_urls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-215"><a href="#LiveStreamDownloader-215"><span class="linenos"> 215</span></a>            <span class="n">stream_urls</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LiveStreamDownloader-216"><a href="#LiveStreamDownloader-216"><span class="linenos"> 216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-217"><a href="#LiveStreamDownloader-217"><span class="linenos"> 217</span></a>            <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-218"><a href="#LiveStreamDownloader-218"><span class="linenos"> 218</span></a>            <span class="n">filetype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-219"><a href="#LiveStreamDownloader-219"><span class="linenos"> 219</span></a>
</span><span id="LiveStreamDownloader-220"><a href="#LiveStreamDownloader-220"><span class="linenos"> 220</span></a>            <span class="k">with</span> <span class="n">StreamRecovery</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-221"><a href="#LiveStreamDownloader-221"><span class="linenos"> 221</span></a>                <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-222"><a href="#LiveStreamDownloader-222"><span class="linenos"> 222</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-223"><a href="#LiveStreamDownloader-223"><span class="linenos"> 223</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-224"><a href="#LiveStreamDownloader-224"><span class="linenos"> 224</span></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-225"><a href="#LiveStreamDownloader-225"><span class="linenos"> 225</span></a>                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-226"><a href="#LiveStreamDownloader-226"><span class="linenos"> 226</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-227"><a href="#LiveStreamDownloader-227"><span class="linenos"> 227</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-228"><a href="#LiveStreamDownloader-228"><span class="linenos"> 228</span></a>                <span class="n">fragment_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-229"><a href="#LiveStreamDownloader-229"><span class="linenos"> 229</span></a>                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-230"><a href="#LiveStreamDownloader-230"><span class="linenos"> 230</span></a>                <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="n">yt_dlp_sort</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-231"><a href="#LiveStreamDownloader-231"><span class="linenos"> 231</span></a>                <span class="n">livestream_coordinator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-232"><a href="#LiveStreamDownloader-232"><span class="linenos"> 232</span></a>                <span class="n">stream_urls</span><span class="o">=</span><span class="n">stream_urls</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-233"><a href="#LiveStreamDownloader-233"><span class="linenos"> 233</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-234"><a href="#LiveStreamDownloader-234"><span class="linenos"> 234</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">downloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-235"><a href="#LiveStreamDownloader-235"><span class="linenos"> 235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Recording&quot;</span>
</span><span id="LiveStreamDownloader-236"><a href="#LiveStreamDownloader-236"><span class="linenos"> 236</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">live_dl</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-237"><a href="#LiveStreamDownloader-237"><span class="linenos"> 237</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">force_merge</span> <span class="ow">or</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="n">recovery_failure_tolerance</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">no_merge</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-238"><a href="#LiveStreamDownloader-238"><span class="linenos"> 238</span></a>                    <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-239"><a href="#LiveStreamDownloader-239"><span class="linenos"> 239</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-240"><a href="#LiveStreamDownloader-240"><span class="linenos"> 240</span></a>                            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">) Stream recovery of format </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> outstanding segments which were not able to complete. Exitting&quot;</span>
</span><span id="LiveStreamDownloader-241"><a href="#LiveStreamDownloader-241"><span class="linenos"> 241</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader-242"><a href="#LiveStreamDownloader-242"><span class="linenos"> 242</span></a>                    <span class="n">file_name</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">combine_segments_to_file</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">merged_file_name</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-243"><a href="#LiveStreamDownloader-243"><span class="linenos"> 243</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_database</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-244"><a href="#LiveStreamDownloader-244"><span class="linenos"> 244</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging to ts complete, removing </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-245"><a href="#LiveStreamDownloader-245"><span class="linenos"> 245</span></a>                        <span class="n">downloader</span><span class="o">.</span><span class="n">delete_temp_database</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-246"><a href="#LiveStreamDownloader-246"><span class="linenos"> 246</span></a>                    <span class="k">elif</span> <span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-247"><a href="#LiveStreamDownloader-247"><span class="linenos"> 247</span></a>                        <span class="n">database_file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-248"><a href="#LiveStreamDownloader-248"><span class="linenos"> 248</span></a>                            <span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span>
</span><span id="LiveStreamDownloader-249"><a href="#LiveStreamDownloader-249"><span class="linenos"> 249</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader-250"><a href="#LiveStreamDownloader-250"><span class="linenos"> 250</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-251"><a href="#LiveStreamDownloader-251"><span class="linenos"> 251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-252"><a href="#LiveStreamDownloader-252"><span class="linenos"> 252</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">) Stream recovery of format </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> outstanding segments which were not able to complete. Exitting&quot;</span>
</span><span id="LiveStreamDownloader-253"><a href="#LiveStreamDownloader-253"><span class="linenos"> 253</span></a>                    <span class="k">raise</span> <span class="n">VideoDownloadError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-254"><a href="#LiveStreamDownloader-254"><span class="linenos"> 254</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-255"><a href="#LiveStreamDownloader-255"><span class="linenos"> 255</span></a>                <span class="n">filetype</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">type</span>
</span><span id="LiveStreamDownloader-256"><a href="#LiveStreamDownloader-256"><span class="linenos"> 256</span></a>
</span><span id="LiveStreamDownloader-257"><a href="#LiveStreamDownloader-257"><span class="linenos"> 257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">file</span><span class="p">})</span>
</span><span id="LiveStreamDownloader-258"><a href="#LiveStreamDownloader-258"><span class="linenos"> 258</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-259"><a href="#LiveStreamDownloader-259"><span class="linenos"> 259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error occurred while downloading stream&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-260"><a href="#LiveStreamDownloader-260"><span class="linenos"> 260</span></a>            <span class="k">raise</span>
</span><span id="LiveStreamDownloader-261"><a href="#LiveStreamDownloader-261"><span class="linenos"> 261</span></a>        <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">filetype</span>
</span><span id="LiveStreamDownloader-262"><a href="#LiveStreamDownloader-262"><span class="linenos"> 262</span></a>
</span><span id="LiveStreamDownloader-263"><a href="#LiveStreamDownloader-263"><span class="linenos"> 263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-264"><a href="#LiveStreamDownloader-264"><span class="linenos"> 264</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">False</span>
</span><span id="LiveStreamDownloader-265"><a href="#LiveStreamDownloader-265"><span class="linenos"> 265</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader-266"><a href="#LiveStreamDownloader-266"><span class="linenos"> 266</span></a>        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader-267"><a href="#LiveStreamDownloader-267"><span class="linenos"> 267</span></a>
</span><span id="LiveStreamDownloader-268"><a href="#LiveStreamDownloader-268"><span class="linenos"> 268</span></a>        <span class="c1"># Options only not used by recovery</span>
</span><span id="LiveStreamDownloader-269"><a href="#LiveStreamDownloader-269"><span class="linenos"> 269</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-270"><a href="#LiveStreamDownloader-270"><span class="linenos"> 270</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-271"><a href="#LiveStreamDownloader-271"><span class="linenos"> 271</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader-272"><a href="#LiveStreamDownloader-272"><span class="linenos"> 272</span></a>                    <span class="s2">&quot;include_dash&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-273"><a href="#LiveStreamDownloader-273"><span class="linenos"> 273</span></a>                    <span class="s2">&quot;include_m3u8&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-274"><a href="#LiveStreamDownloader-274"><span class="linenos"> 274</span></a>                    <span class="s2">&quot;force_m3u8&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-275"><a href="#LiveStreamDownloader-275"><span class="linenos"> 275</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader-276"><a href="#LiveStreamDownloader-276"><span class="linenos"> 276</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-277"><a href="#LiveStreamDownloader-277"><span class="linenos"> 277</span></a>
</span><span id="LiveStreamDownloader-278"><a href="#LiveStreamDownloader-278"><span class="linenos"> 278</span></a>        <span class="c1"># Select the function</span>
</span><span id="LiveStreamDownloader-279"><a href="#LiveStreamDownloader-279"><span class="linenos"> 279</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-280"><a href="#LiveStreamDownloader-280"><span class="linenos"> 280</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recover_stream</span>
</span><span id="LiveStreamDownloader-281"><a href="#LiveStreamDownloader-281"><span class="linenos"> 281</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-282"><a href="#LiveStreamDownloader-282"><span class="linenos"> 282</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader-283"><a href="#LiveStreamDownloader-283"><span class="linenos"> 283</span></a>                    <span class="s2">&quot;force_merge&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_recovery_merge&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-284"><a href="#LiveStreamDownloader-284"><span class="linenos"> 284</span></a>                    <span class="s2">&quot;recovery_failure_tolerance&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery_failure_tolerance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-285"><a href="#LiveStreamDownloader-285"><span class="linenos"> 285</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader-286"><a href="#LiveStreamDownloader-286"><span class="linenos"> 286</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-287"><a href="#LiveStreamDownloader-287"><span class="linenos"> 287</span></a>        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;direct_to_ts&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-288"><a href="#LiveStreamDownloader-288"><span class="linenos"> 288</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream_direct</span>
</span><span id="LiveStreamDownloader-289"><a href="#LiveStreamDownloader-289"><span class="linenos"> 289</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-290"><a href="#LiveStreamDownloader-290"><span class="linenos"> 290</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader-291"><a href="#LiveStreamDownloader-291"><span class="linenos"> 291</span></a>                    <span class="s2">&quot;keep_state&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_database_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-292"><a href="#LiveStreamDownloader-292"><span class="linenos"> 292</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader-293"><a href="#LiveStreamDownloader-293"><span class="linenos"> 293</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-294"><a href="#LiveStreamDownloader-294"><span class="linenos"> 294</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-295"><a href="#LiveStreamDownloader-295"><span class="linenos"> 295</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream</span>
</span><span id="LiveStreamDownloader-296"><a href="#LiveStreamDownloader-296"><span class="linenos"> 296</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-297"><a href="#LiveStreamDownloader-297"><span class="linenos"> 297</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader-298"><a href="#LiveStreamDownloader-298"><span class="linenos"> 298</span></a>                    <span class="s2">&quot;keep_database&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_database_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-299"><a href="#LiveStreamDownloader-299"><span class="linenos"> 299</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader-300"><a href="#LiveStreamDownloader-300"><span class="linenos"> 300</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-301"><a href="#LiveStreamDownloader-301"><span class="linenos"> 301</span></a>
</span><span id="LiveStreamDownloader-302"><a href="#LiveStreamDownloader-302"><span class="linenos"> 302</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LiveStreamDownloader-303"><a href="#LiveStreamDownloader-303"><span class="linenos"> 303</span></a>            <span class="s2">&quot;info_dict&quot;</span><span class="p">:</span> <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-304"><a href="#LiveStreamDownloader-304"><span class="linenos"> 304</span></a>            <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;audio_only&quot;</span> <span class="k">if</span> <span class="n">is_audio</span> <span class="k">else</span> <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-305"><a href="#LiveStreamDownloader-305"><span class="linenos"> 305</span></a>            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-306"><a href="#LiveStreamDownloader-306"><span class="linenos"> 306</span></a>            <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-307"><a href="#LiveStreamDownloader-307"><span class="linenos"> 307</span></a>            <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="n">download_folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-308"><a href="#LiveStreamDownloader-308"><span class="linenos"> 308</span></a>            <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-309"><a href="#LiveStreamDownloader-309"><span class="linenos"> 309</span></a>            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segment_retries&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-310"><a href="#LiveStreamDownloader-310"><span class="linenos"> 310</span></a>            <span class="s2">&quot;cookies&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cookies&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-311"><a href="#LiveStreamDownloader-311"><span class="linenos"> 311</span></a>            <span class="s2">&quot;yt_dlp_options&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ytdlp_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-312"><a href="#LiveStreamDownloader-312"><span class="linenos"> 312</span></a>            <span class="s2">&quot;proxies&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-313"><a href="#LiveStreamDownloader-313"><span class="linenos"> 313</span></a>            <span class="s2">&quot;yt_dlp_sort&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_sort&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-314"><a href="#LiveStreamDownloader-314"><span class="linenos"> 314</span></a>        <span class="p">}</span>
</span><span id="LiveStreamDownloader-315"><a href="#LiveStreamDownloader-315"><span class="linenos"> 315</span></a>
</span><span id="LiveStreamDownloader-316"><a href="#LiveStreamDownloader-316"><span class="linenos"> 316</span></a>        <span class="k">if</span> <span class="n">extra_kwargs</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-317"><a href="#LiveStreamDownloader-317"><span class="linenos"> 317</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_kwargs</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-318"><a href="#LiveStreamDownloader-318"><span class="linenos"> 318</span></a>
</span><span id="LiveStreamDownloader-319"><a href="#LiveStreamDownloader-319"><span class="linenos"> 319</span></a>        <span class="c1"># Add any extra values not yet existing</span>
</span><span id="LiveStreamDownloader-320"><a href="#LiveStreamDownloader-320"><span class="linenos"> 320</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LiveStreamDownloader-321"><a href="#LiveStreamDownloader-321"><span class="linenos"> 321</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-322"><a href="#LiveStreamDownloader-322"><span class="linenos"> 322</span></a>
</span><span id="LiveStreamDownloader-323"><a href="#LiveStreamDownloader-323"><span class="linenos"> 323</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting executor with: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-324"><a href="#LiveStreamDownloader-324"><span class="linenos"> 324</span></a>
</span><span id="LiveStreamDownloader-325"><a href="#LiveStreamDownloader-325"><span class="linenos"> 325</span></a>        <span class="c1"># Submit to executor</span>
</span><span id="LiveStreamDownloader-326"><a href="#LiveStreamDownloader-326"><span class="linenos"> 326</span></a>        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-327"><a href="#LiveStreamDownloader-327"><span class="linenos"> 327</span></a>        <span class="n">futures</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-328"><a href="#LiveStreamDownloader-328"><span class="linenos"> 328</span></a>        <span class="k">return</span> <span class="n">future</span>
</span><span id="LiveStreamDownloader-329"><a href="#LiveStreamDownloader-329"><span class="linenos"> 329</span></a>
</span><span id="LiveStreamDownloader-330"><a href="#LiveStreamDownloader-330"><span class="linenos"> 330</span></a>    <span class="c1"># Multithreaded function to download new segments with delayed commit after a batch</span>
</span><span id="LiveStreamDownloader-331"><a href="#LiveStreamDownloader-331"><span class="linenos"> 331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_segments</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-332"><a href="#LiveStreamDownloader-332"><span class="linenos"> 332</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thread_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-333"><a href="#LiveStreamDownloader-333"><span class="linenos"> 333</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-334"><a href="#LiveStreamDownloader-334"><span class="linenos"> 334</span></a>        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-335"><a href="#LiveStreamDownloader-335"><span class="linenos"> 335</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader-336"><a href="#LiveStreamDownloader-336"><span class="linenos"> 336</span></a>        <span class="n">futures</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-337"><a href="#LiveStreamDownloader-337"><span class="linenos"> 337</span></a>
</span><span id="LiveStreamDownloader-338"><a href="#LiveStreamDownloader-338"><span class="linenos"> 338</span></a>        <span class="k">if</span> <span class="n">thread_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-339"><a href="#LiveStreamDownloader-339"><span class="linenos"> 339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span> <span class="o">=</span> <span class="n">thread_event</span>
</span><span id="LiveStreamDownloader-340"><a href="#LiveStreamDownloader-340"><span class="linenos"> 340</span></a>
</span><span id="LiveStreamDownloader-341"><a href="#LiveStreamDownloader-341"><span class="linenos"> 341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-342"><a href="#LiveStreamDownloader-342"><span class="linenos"> 342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Starting&quot;</span>
</span><span id="LiveStreamDownloader-343"><a href="#LiveStreamDownloader-343"><span class="linenos"> 343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-344"><a href="#LiveStreamDownloader-344"><span class="linenos"> 344</span></a>        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-345"><a href="#LiveStreamDownloader-345"><span class="linenos"> 345</span></a>        <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-346"><a href="#LiveStreamDownloader-346"><span class="linenos"> 346</span></a>        <span class="c1"># Requires testing</span>
</span><span id="LiveStreamDownloader-347"><a href="#LiveStreamDownloader-347"><span class="linenos"> 347</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">outputFile</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-348"><a href="#LiveStreamDownloader-348"><span class="linenos"> 348</span></a>            <span class="n">_output_folder</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-349"><a href="#LiveStreamDownloader-349"><span class="linenos"> 349</span></a>            <span class="n">download_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-350"><a href="#LiveStreamDownloader-350"><span class="linenos"> 350</span></a>            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_folder</span>
</span><span id="LiveStreamDownloader-351"><a href="#LiveStreamDownloader-351"><span class="linenos"> 351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-352"><a href="#LiveStreamDownloader-352"><span class="linenos"> 352</span></a>            <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-353"><a href="#LiveStreamDownloader-353"><span class="linenos"> 353</span></a>        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
</span><span id="LiveStreamDownloader-354"><a href="#LiveStreamDownloader-354"><span class="linenos"> 354</span></a>        <span class="k">if</span> <span class="n">download_folder</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-355"><a href="#LiveStreamDownloader-355"><span class="linenos"> 355</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-356"><a href="#LiveStreamDownloader-356"><span class="linenos"> 356</span></a>
</span><span id="LiveStreamDownloader-357"><a href="#LiveStreamDownloader-357"><span class="linenos"> 357</span></a>        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-358"><a href="#LiveStreamDownloader-358"><span class="linenos"> 358</span></a>            <span class="n">done</span> <span class="o">=</span> <span class="n">not_done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-359"><a href="#LiveStreamDownloader-359"><span class="linenos"> 359</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-360"><a href="#LiveStreamDownloader-360"><span class="linenos"> 360</span></a>                <span class="c1"># Download auxiliary files (thumbnail, info,json etc)</span>
</span><span id="LiveStreamDownloader-361"><a href="#LiveStreamDownloader-361"><span class="linenos"> 361</span></a>                <span class="n">auxiliary_thread</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_auxiliary_files</span><span class="p">,</span> <span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-362"><a href="#LiveStreamDownloader-362"><span class="linenos"> 362</span></a>                <span class="n">futures</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">auxiliary_thread</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-363"><a href="#LiveStreamDownloader-363"><span class="linenos"> 363</span></a>
</span><span id="LiveStreamDownloader-364"><a href="#LiveStreamDownloader-364"><span class="linenos"> 364</span></a>                <span class="n">live_chat_thread</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-365"><a href="#LiveStreamDownloader-365"><span class="linenos"> 365</span></a>                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;live_chat&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-366"><a href="#LiveStreamDownloader-366"><span class="linenos"> 366</span></a>                    <span class="n">live_chat_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-367"><a href="#LiveStreamDownloader-367"><span class="linenos"> 367</span></a>                        <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">download_live_chat</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader-368"><a href="#LiveStreamDownloader-368"><span class="linenos"> 368</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader-369"><a href="#LiveStreamDownloader-369"><span class="linenos"> 369</span></a>                    <span class="n">live_chat_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-370"><a href="#LiveStreamDownloader-370"><span class="linenos"> 370</span></a>
</span><span id="LiveStreamDownloader-371"><a href="#LiveStreamDownloader-371"><span class="linenos"> 371</span></a>                <span class="n">format_check</span> <span class="o">=</span> <span class="n">Formats</span><span class="p">()</span><span class="o">.</span><span class="n">getFormatURL</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-372"><a href="#LiveStreamDownloader-372"><span class="linenos"> 372</span></a>                    <span class="n">info_json</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-373"><a href="#LiveStreamDownloader-373"><span class="linenos"> 373</span></a>                    <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-374"><a href="#LiveStreamDownloader-374"><span class="linenos"> 374</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_sort&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-375"><a href="#LiveStreamDownloader-375"><span class="linenos"> 375</span></a>                    <span class="n">include_dash</span><span class="o">=</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
</span><span id="LiveStreamDownloader-376"><a href="#LiveStreamDownloader-376"><span class="linenos"> 376</span></a>                    <span class="n">include_m3u8</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-377"><a href="#LiveStreamDownloader-377"><span class="linenos"> 377</span></a>                    <span class="n">force_m3u8</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-378"><a href="#LiveStreamDownloader-378"><span class="linenos"> 378</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader-379"><a href="#LiveStreamDownloader-379"><span class="linenos"> 379</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">format_check</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-380"><a href="#LiveStreamDownloader-380"><span class="linenos"> 380</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resolution is not valid or does not exist in stream&quot;</span>
</span><span id="LiveStreamDownloader-381"><a href="#LiveStreamDownloader-381"><span class="linenos"> 381</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-382"><a href="#LiveStreamDownloader-382"><span class="linenos"> 382</span></a>                <span class="c1"># For use of specificed format. Expects two values, but can work with more</span>
</span><span id="LiveStreamDownloader-383"><a href="#LiveStreamDownloader-383"><span class="linenos"> 383</span></a>                <span class="c1"># Video + Audio</span>
</span><span id="LiveStreamDownloader-384"><a href="#LiveStreamDownloader-384"><span class="linenos"> 384</span></a>
</span><span id="LiveStreamDownloader-385"><a href="#LiveStreamDownloader-385"><span class="linenos"> 385</span></a>                <span class="k">if</span> <span class="n">resolution</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;audio_only&quot;</span><span class="p">,</span> <span class="s2">&quot;ba&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-386"><a href="#LiveStreamDownloader-386"><span class="linenos"> 386</span></a>                    <span class="c1"># Video</span>
</span><span id="LiveStreamDownloader-387"><a href="#LiveStreamDownloader-387"><span class="linenos"> 387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-388"><a href="#LiveStreamDownloader-388"><span class="linenos"> 388</span></a>                        <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">False</span>
</span><span id="LiveStreamDownloader-389"><a href="#LiveStreamDownloader-389"><span class="linenos"> 389</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader-390"><a href="#LiveStreamDownloader-390"><span class="linenos"> 390</span></a>                    <span class="k">if</span> <span class="n">format_check</span><span class="o">.</span><span class="n">protocol</span> <span class="o">!=</span> <span class="s2">&quot;m3u8_native&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-391"><a href="#LiveStreamDownloader-391"><span class="linenos"> 391</span></a>                        <span class="c1"># Audio</span>
</span><span id="LiveStreamDownloader-392"><a href="#LiveStreamDownloader-392"><span class="linenos"> 392</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-393"><a href="#LiveStreamDownloader-393"><span class="linenos"> 393</span></a>                            <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader-394"><a href="#LiveStreamDownloader-394"><span class="linenos"> 394</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader-395"><a href="#LiveStreamDownloader-395"><span class="linenos"> 395</span></a>                <span class="c1"># Audio-only</span>
</span><span id="LiveStreamDownloader-396"><a href="#LiveStreamDownloader-396"><span class="linenos"> 396</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-397"><a href="#LiveStreamDownloader-397"><span class="linenos"> 397</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-398"><a href="#LiveStreamDownloader-398"><span class="linenos"> 398</span></a>                        <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader-399"><a href="#LiveStreamDownloader-399"><span class="linenos"> 399</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader-400"><a href="#LiveStreamDownloader-400"><span class="linenos"> 400</span></a>
</span><span id="LiveStreamDownloader-401"><a href="#LiveStreamDownloader-401"><span class="linenos"> 401</span></a>                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-402"><a href="#LiveStreamDownloader-402"><span class="linenos"> 402</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="LiveStreamDownloader-403"><a href="#LiveStreamDownloader-403"><span class="linenos"> 403</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Thread kill event is set, ending...&quot;</span>
</span><span id="LiveStreamDownloader-404"><a href="#LiveStreamDownloader-404"><span class="linenos"> 404</span></a>                        <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-405"><a href="#LiveStreamDownloader-405"><span class="linenos"> 405</span></a>                    <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-406"><a href="#LiveStreamDownloader-406"><span class="linenos"> 406</span></a>                        <span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span>
</span><span id="LiveStreamDownloader-407"><a href="#LiveStreamDownloader-407"><span class="linenos"> 407</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader-408"><a href="#LiveStreamDownloader-408"><span class="linenos"> 408</span></a>                    <span class="c1"># Continuously check for completion or interruption</span>
</span><span id="LiveStreamDownloader-409"><a href="#LiveStreamDownloader-409"><span class="linenos"> 409</span></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-410"><a href="#LiveStreamDownloader-410"><span class="linenos"> 410</span></a>                        <span class="n">result</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-411"><a href="#LiveStreamDownloader-411"><span class="linenos"> 411</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[31m</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-412"><a href="#LiveStreamDownloader-412"><span class="linenos"> 412</span></a>
</span><span id="LiveStreamDownloader-413"><a href="#LiveStreamDownloader-413"><span class="linenos"> 413</span></a>                        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;auxiliary&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-414"><a href="#LiveStreamDownloader-414"><span class="linenos"> 414</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-415"><a href="#LiveStreamDownloader-415"><span class="linenos"> 415</span></a>
</span><span id="LiveStreamDownloader-416"><a href="#LiveStreamDownloader-416"><span class="linenos"> 416</span></a>                            <span class="c1"># Remove parts that would not be needed by stream downloaders</span>
</span><span id="LiveStreamDownloader-417"><a href="#LiveStreamDownloader-417"><span class="linenos"> 417</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_format_segment_playlist_from_info_dict</span><span class="p">(</span><span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-418"><a href="#LiveStreamDownloader-418"><span class="linenos"> 418</span></a>                            <span class="n">info_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-419"><a href="#LiveStreamDownloader-419"><span class="linenos"> 419</span></a>                            <span class="c1"># Remove no longer required parts for the rest of the downloader</span>
</span><span id="LiveStreamDownloader-420"><a href="#LiveStreamDownloader-420"><span class="linenos"> 420</span></a>                            <span class="c1"># info_dict = self.trim_info_json(info_dict=info_dict, keys_to_keep={&quot;id&quot;, &quot;ext&quot;, &quot;upload_date&quot;, &quot;original_url&quot;, &quot;description&quot;, &quot;fulltitle&quot;, &quot;channel&quot;})</span>
</span><span id="LiveStreamDownloader-421"><a href="#LiveStreamDownloader-421"><span class="linenos"> 421</span></a>
</span><span id="LiveStreamDownloader-422"><a href="#LiveStreamDownloader-422"><span class="linenos"> 422</span></a>                        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;video&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-423"><a href="#LiveStreamDownloader-423"><span class="linenos"> 423</span></a>                            <span class="c1"># self.file_names[&#39;video&#39;] = result</span>
</span><span id="LiveStreamDownloader-424"><a href="#LiveStreamDownloader-424"><span class="linenos"> 424</span></a>                            <span class="k">pass</span>
</span><span id="LiveStreamDownloader-425"><a href="#LiveStreamDownloader-425"><span class="linenos"> 425</span></a>                        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;audio&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-426"><a href="#LiveStreamDownloader-426"><span class="linenos"> 426</span></a>                            <span class="c1"># self.file_names[&#39;audio&#39;] = result</span>
</span><span id="LiveStreamDownloader-427"><a href="#LiveStreamDownloader-427"><span class="linenos"> 427</span></a>                            <span class="k">pass</span>
</span><span id="LiveStreamDownloader-428"><a href="#LiveStreamDownloader-428"><span class="linenos"> 428</span></a>                        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;live_chat&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-429"><a href="#LiveStreamDownloader-429"><span class="linenos"> 429</span></a>                            <span class="k">pass</span>
</span><span id="LiveStreamDownloader-430"><a href="#LiveStreamDownloader-430"><span class="linenos"> 430</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-431"><a href="#LiveStreamDownloader-431"><span class="linenos"> 431</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="LiveStreamDownloader-432"><a href="#LiveStreamDownloader-432"><span class="linenos"> 432</span></a>
</span><span id="LiveStreamDownloader-433"><a href="#LiveStreamDownloader-433"><span class="linenos"> 433</span></a>                        <span class="n">futures</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-434"><a href="#LiveStreamDownloader-434"><span class="linenos"> 434</span></a>
</span><span id="LiveStreamDownloader-435"><a href="#LiveStreamDownloader-435"><span class="linenos"> 435</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-436"><a href="#LiveStreamDownloader-436"><span class="linenos"> 436</span></a>                        <span class="k">break</span>
</span><span id="LiveStreamDownloader-437"><a href="#LiveStreamDownloader-437"><span class="linenos"> 437</span></a>                    <span class="c1"># else:</span>
</span><span id="LiveStreamDownloader-438"><a href="#LiveStreamDownloader-438"><span class="linenos"> 438</span></a>                    <span class="c1">#    time.sleep(0.9)</span>
</span><span id="LiveStreamDownloader-439"><a href="#LiveStreamDownloader-439"><span class="linenos"> 439</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-440"><a href="#LiveStreamDownloader-440"><span class="linenos"> 440</span></a>
</span><span id="LiveStreamDownloader-441"><a href="#LiveStreamDownloader-441"><span class="linenos"> 441</span></a>                <span class="k">if</span> <span class="n">live_chat_thread</span> <span class="ow">and</span> <span class="n">live_chat_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span><span id="LiveStreamDownloader-442"><a href="#LiveStreamDownloader-442"><span class="linenos"> 442</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Media downloads finished, waiting for live chat to end...&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-443"><a href="#LiveStreamDownloader-443"><span class="linenos"> 443</span></a>                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stop_chat_when_done&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-444"><a href="#LiveStreamDownloader-444"><span class="linenos"> 444</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">chat_timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-445"><a href="#LiveStreamDownloader-445"><span class="linenos"> 445</span></a>                    <span class="k">while</span> <span class="n">live_chat_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span><span class="o">.</span><span class="n">is_set</span><span class="p">()):</span>
</span><span id="LiveStreamDownloader-446"><a href="#LiveStreamDownloader-446"><span class="linenos"> 446</span></a>                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-447"><a href="#LiveStreamDownloader-447"><span class="linenos"> 447</span></a>
</span><span id="LiveStreamDownloader-448"><a href="#LiveStreamDownloader-448"><span class="linenos"> 448</span></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-449"><a href="#LiveStreamDownloader-449"><span class="linenos"> 449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-450"><a href="#LiveStreamDownloader-450"><span class="linenos"> 450</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Keyboard interrupt detected&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-451"><a href="#LiveStreamDownloader-451"><span class="linenos"> 451</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-452"><a href="#LiveStreamDownloader-452"><span class="linenos"> 452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cancelling remaining threads&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-453"><a href="#LiveStreamDownloader-453"><span class="linenos"> 453</span></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">not_done</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-454"><a href="#LiveStreamDownloader-454"><span class="linenos"> 454</span></a>                    <span class="n">_</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-455"><a href="#LiveStreamDownloader-455"><span class="linenos"> 455</span></a>                <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-456"><a href="#LiveStreamDownloader-456"><span class="linenos"> 456</span></a>                    <span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ALL_COMPLETED</span>
</span><span id="LiveStreamDownloader-457"><a href="#LiveStreamDownloader-457"><span class="linenos"> 457</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader-458"><a href="#LiveStreamDownloader-458"><span class="linenos"> 458</span></a>                <span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-459"><a href="#LiveStreamDownloader-459"><span class="linenos"> 459</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shutdown all threads&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-460"><a href="#LiveStreamDownloader-460"><span class="linenos"> 460</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Cancelled&quot;</span>
</span><span id="LiveStreamDownloader-461"><a href="#LiveStreamDownloader-461"><span class="linenos"> 461</span></a>                <span class="k">raise</span>
</span><span id="LiveStreamDownloader-462"><a href="#LiveStreamDownloader-462"><span class="linenos"> 462</span></a>
</span><span id="LiveStreamDownloader-463"><a href="#LiveStreamDownloader-463"><span class="linenos"> 463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Muxing&quot;</span>
</span><span id="LiveStreamDownloader-464"><a href="#LiveStreamDownloader-464"><span class="linenos"> 464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_mp4</span><span class="p">(</span><span class="n">file_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">,</span> <span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-465"><a href="#LiveStreamDownloader-465"><span class="linenos"> 465</span></a>
</span><span id="LiveStreamDownloader-466"><a href="#LiveStreamDownloader-466"><span class="linenos"> 466</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Moving&quot;</span>
</span><span id="LiveStreamDownloader-467"><a href="#LiveStreamDownloader-467"><span class="linenos"> 467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_final</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">file_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-468"><a href="#LiveStreamDownloader-468"><span class="linenos"> 468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Finished&quot;</span>
</span><span id="LiveStreamDownloader-469"><a href="#LiveStreamDownloader-469"><span class="linenos"> 469</span></a>        <span class="c1"># move_to_final(info_dict, options, file_names)</span>
</span><span id="LiveStreamDownloader-470"><a href="#LiveStreamDownloader-470"><span class="linenos"> 470</span></a>
</span><span id="LiveStreamDownloader-471"><a href="#LiveStreamDownloader-471"><span class="linenos"> 471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">output_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-472"><a href="#LiveStreamDownloader-472"><span class="linenos"> 472</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">YoutubeDL</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="o">=</span><span class="n">outtmpl</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-473"><a href="#LiveStreamDownloader-473"><span class="linenos"> 473</span></a>            <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;ï¼…&quot;</span>
</span><span id="LiveStreamDownloader-474"><a href="#LiveStreamDownloader-474"><span class="linenos"> 474</span></a>        <span class="p">)</span>  <span class="c1"># Replace normal percent sign with unicode version to prevent ffmpeg errors</span>
</span><span id="LiveStreamDownloader-475"><a href="#LiveStreamDownloader-475"><span class="linenos"> 475</span></a>
</span><span id="LiveStreamDownloader-476"><a href="#LiveStreamDownloader-476"><span class="linenos"> 476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">file_names</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-477"><a href="#LiveStreamDownloader-477"><span class="linenos"> 477</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">maybe_move</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dest_func</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">file_names</span><span class="p">,</span> <span class="n">option_flag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-478"><a href="#LiveStreamDownloader-478"><span class="linenos"> 478</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;key: key in file_names</span>
</span><span id="LiveStreamDownloader-479"><a href="#LiveStreamDownloader-479"><span class="linenos"> 479</span></a><span class="sd">            dest_func: func -&gt; pathlib -&gt; string dest path</span>
</span><span id="LiveStreamDownloader-480"><a href="#LiveStreamDownloader-480"><span class="linenos"> 480</span></a><span class="sd">            delete_if_false: if True, delete when option_flag not set</span>
</span><span id="LiveStreamDownloader-481"><a href="#LiveStreamDownloader-481"><span class="linenos"> 481</span></a><span class="sd">            option_flag: name of boolean option (write_thumbnail etc)</span>
</span><span id="LiveStreamDownloader-482"><a href="#LiveStreamDownloader-482"><span class="linenos"> 482</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader-483"><a href="#LiveStreamDownloader-483"><span class="linenos"> 483</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">file_names_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-484"><a href="#LiveStreamDownloader-484"><span class="linenos"> 484</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-485"><a href="#LiveStreamDownloader-485"><span class="linenos"> 485</span></a>                <span class="k">return</span>
</span><span id="LiveStreamDownloader-486"><a href="#LiveStreamDownloader-486"><span class="linenos"> 486</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-487"><a href="#LiveStreamDownloader-487"><span class="linenos"> 487</span></a>                <span class="c1"># deletion case (thumbnail / ffmpeg)</span>
</span><span id="LiveStreamDownloader-488"><a href="#LiveStreamDownloader-488"><span class="linenos"> 488</span></a>                <span class="k">if</span> <span class="n">option_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">option_flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-489"><a href="#LiveStreamDownloader-489"><span class="linenos"> 489</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-490"><a href="#LiveStreamDownloader-490"><span class="linenos"> 490</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-491"><a href="#LiveStreamDownloader-491"><span class="linenos"> 491</span></a>                    <span class="n">file_names_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-492"><a href="#LiveStreamDownloader-492"><span class="linenos"> 492</span></a>                    <span class="k">return</span>
</span><span id="LiveStreamDownloader-493"><a href="#LiveStreamDownloader-493"><span class="linenos"> 493</span></a>
</span><span id="LiveStreamDownloader-494"><a href="#LiveStreamDownloader-494"><span class="linenos"> 494</span></a>                <span class="n">dest</span> <span class="o">=</span> <span class="n">dest_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-495"><a href="#LiveStreamDownloader-495"><span class="linenos"> 495</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="LiveStreamDownloader-496"><a href="#LiveStreamDownloader-496"><span class="linenos"> 496</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moving </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-497"><a href="#LiveStreamDownloader-497"><span class="linenos"> 497</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">(),</span> <span class="n">dest</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-498"><a href="#LiveStreamDownloader-498"><span class="linenos"> 498</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-499"><a href="#LiveStreamDownloader-499"><span class="linenos"> 499</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2"> is already in final destination&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-500"><a href="#LiveStreamDownloader-500"><span class="linenos"> 500</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-501"><a href="#LiveStreamDownloader-501"><span class="linenos"> 501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unable to move </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-502"><a href="#LiveStreamDownloader-502"><span class="linenos"> 502</span></a>
</span><span id="LiveStreamDownloader-503"><a href="#LiveStreamDownloader-503"><span class="linenos"> 503</span></a>        <span class="c1"># ensure output dir exists</span>
</span><span id="LiveStreamDownloader-504"><a href="#LiveStreamDownloader-504"><span class="linenos"> 504</span></a>        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-505"><a href="#LiveStreamDownloader-505"><span class="linenos"> 505</span></a>        <span class="k">if</span> <span class="n">out_dir</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-506"><a href="#LiveStreamDownloader-506"><span class="linenos"> 506</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-507"><a href="#LiveStreamDownloader-507"><span class="linenos"> 507</span></a>
</span><span id="LiveStreamDownloader-508"><a href="#LiveStreamDownloader-508"><span class="linenos"> 508</span></a>        <span class="c1"># === individual file handlers ===</span>
</span><span id="LiveStreamDownloader-509"><a href="#LiveStreamDownloader-509"><span class="linenos"> 509</span></a>
</span><span id="LiveStreamDownloader-510"><a href="#LiveStreamDownloader-510"><span class="linenos"> 510</span></a>        <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">option_flag</span><span class="o">=</span><span class="s2">&quot;write_thumbnail&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-511"><a href="#LiveStreamDownloader-511"><span class="linenos"> 511</span></a>
</span><span id="LiveStreamDownloader-512"><a href="#LiveStreamDownloader-512"><span class="linenos"> 512</span></a>        <span class="n">maybe_move</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-513"><a href="#LiveStreamDownloader-513"><span class="linenos"> 513</span></a>            <span class="s2">&quot;info_json&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-514"><a href="#LiveStreamDownloader-514"><span class="linenos"> 514</span></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.info.json&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-515"><a href="#LiveStreamDownloader-515"><span class="linenos"> 515</span></a>        <span class="p">)</span>
</span><span id="LiveStreamDownloader-516"><a href="#LiveStreamDownloader-516"><span class="linenos"> 516</span></a>
</span><span id="LiveStreamDownloader-517"><a href="#LiveStreamDownloader-517"><span class="linenos"> 517</span></a>        <span class="n">maybe_move</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-518"><a href="#LiveStreamDownloader-518"><span class="linenos"> 518</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-519"><a href="#LiveStreamDownloader-519"><span class="linenos"> 519</span></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-520"><a href="#LiveStreamDownloader-520"><span class="linenos"> 520</span></a>        <span class="p">)</span>
</span><span id="LiveStreamDownloader-521"><a href="#LiveStreamDownloader-521"><span class="linenos"> 521</span></a>
</span><span id="LiveStreamDownloader-522"><a href="#LiveStreamDownloader-522"><span class="linenos"> 522</span></a>        <span class="n">stream_manifests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="LiveStreamDownloader-523"><a href="#LiveStreamDownloader-523"><span class="linenos"> 523</span></a>        <span class="k">for</span> <span class="n">manifest</span><span class="p">,</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">stream_manifests</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-524"><a href="#LiveStreamDownloader-524"><span class="linenos"> 524</span></a>            <span class="n">stream_output_file</span> <span class="o">=</span> <span class="n">output_file</span>
</span><span id="LiveStreamDownloader-525"><a href="#LiveStreamDownloader-525"><span class="linenos"> 525</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_manifests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-526"><a href="#LiveStreamDownloader-526"><span class="linenos"> 526</span></a>                <span class="n">stream_output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">manifest</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-527"><a href="#LiveStreamDownloader-527"><span class="linenos"> 527</span></a>            <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">_format</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-528"><a href="#LiveStreamDownloader-528"><span class="linenos"> 528</span></a>
</span><span id="LiveStreamDownloader-529"><a href="#LiveStreamDownloader-529"><span class="linenos"> 529</span></a>            <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">_format</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-530"><a href="#LiveStreamDownloader-530"><span class="linenos"> 530</span></a>
</span><span id="LiveStreamDownloader-531"><a href="#LiveStreamDownloader-531"><span class="linenos"> 531</span></a>            <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;merged&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_output_file</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-532"><a href="#LiveStreamDownloader-532"><span class="linenos"> 532</span></a>
</span><span id="LiveStreamDownloader-533"><a href="#LiveStreamDownloader-533"><span class="linenos"> 533</span></a>        <span class="n">maybe_move</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-534"><a href="#LiveStreamDownloader-534"><span class="linenos"> 534</span></a>            <span class="s2">&quot;live_chat&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-535"><a href="#LiveStreamDownloader-535"><span class="linenos"> 535</span></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.live_chat.zip&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-536"><a href="#LiveStreamDownloader-536"><span class="linenos"> 536</span></a>        <span class="p">)</span>
</span><span id="LiveStreamDownloader-537"><a href="#LiveStreamDownloader-537"><span class="linenos"> 537</span></a>
</span><span id="LiveStreamDownloader-538"><a href="#LiveStreamDownloader-538"><span class="linenos"> 538</span></a>        <span class="c1"># special: databases = list</span>
</span><span id="LiveStreamDownloader-539"><a href="#LiveStreamDownloader-539"><span class="linenos"> 539</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-540"><a href="#LiveStreamDownloader-540"><span class="linenos"> 540</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="LiveStreamDownloader-541"><a href="#LiveStreamDownloader-541"><span class="linenos"> 541</span></a>                <span class="n">dest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">_format</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-542"><a href="#LiveStreamDownloader-542"><span class="linenos"> 542</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="LiveStreamDownloader-543"><a href="#LiveStreamDownloader-543"><span class="linenos"> 543</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moving </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-544"><a href="#LiveStreamDownloader-544"><span class="linenos"> 544</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">(),</span> <span class="n">dest</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-545"><a href="#LiveStreamDownloader-545"><span class="linenos"> 545</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-546"><a href="#LiveStreamDownloader-546"><span class="linenos"> 546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unable to move database files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-547"><a href="#LiveStreamDownloader-547"><span class="linenos"> 547</span></a>
</span><span id="LiveStreamDownloader-548"><a href="#LiveStreamDownloader-548"><span class="linenos"> 548</span></a>        <span class="c1"># special: ffmpeg_cmd</span>
</span><span id="LiveStreamDownloader-549"><a href="#LiveStreamDownloader-549"><span class="linenos"> 549</span></a>        <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;ffmpeg_cmd&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.ffmpeg.txt&quot;</span><span class="p">,</span> <span class="n">option_flag</span><span class="o">=</span><span class="s2">&quot;write_ffmpeg_command&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-550"><a href="#LiveStreamDownloader-550"><span class="linenos"> 550</span></a>
</span><span id="LiveStreamDownloader-551"><a href="#LiveStreamDownloader-551"><span class="linenos"> 551</span></a>        <span class="c1"># remove temp folder</span>
</span><span id="LiveStreamDownloader-552"><a href="#LiveStreamDownloader-552"><span class="linenos"> 552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader-553"><a href="#LiveStreamDownloader-553"><span class="linenos"> 553</span></a><span class="sd">        if options.get(&#39;temp_folder&#39;, None) is not None:</span>
</span><span id="LiveStreamDownloader-554"><a href="#LiveStreamDownloader-554"><span class="linenos"> 554</span></a><span class="sd">            try:</span>
</span><span id="LiveStreamDownloader-555"><a href="#LiveStreamDownloader-555"><span class="linenos"> 555</span></a><span class="sd">                os.rmdir(options.get(&#39;temp_folder&#39;))</span>
</span><span id="LiveStreamDownloader-556"><a href="#LiveStreamDownloader-556"><span class="linenos"> 556</span></a><span class="sd">            except OSError as e:</span>
</span><span id="LiveStreamDownloader-557"><a href="#LiveStreamDownloader-557"><span class="linenos"> 557</span></a><span class="sd">                if e.errno == errno.ENOTEMPTY:</span>
</span><span id="LiveStreamDownloader-558"><a href="#LiveStreamDownloader-558"><span class="linenos"> 558</span></a><span class="sd">                    self.logger.warning(f&quot;Error: Directory not empty: {e.filename}&quot;)</span>
</span><span id="LiveStreamDownloader-559"><a href="#LiveStreamDownloader-559"><span class="linenos"> 559</span></a><span class="sd">                else:</span>
</span><span id="LiveStreamDownloader-560"><a href="#LiveStreamDownloader-560"><span class="linenos"> 560</span></a><span class="sd">                    self.logger.exception(f&quot;Error removing temp folder: {e}&quot;)</span>
</span><span id="LiveStreamDownloader-561"><a href="#LiveStreamDownloader-561"><span class="linenos"> 561</span></a><span class="sd">            except Exception as e:</span>
</span><span id="LiveStreamDownloader-562"><a href="#LiveStreamDownloader-562"><span class="linenos"> 562</span></a><span class="sd">                self.logger.exception(f&quot;Error removing temp folder: {e}&quot;)</span>
</span><span id="LiveStreamDownloader-563"><a href="#LiveStreamDownloader-563"><span class="linenos"> 563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader-564"><a href="#LiveStreamDownloader-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished moving files from temporary directory to output destination&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-565"><a href="#LiveStreamDownloader-565"><span class="linenos"> 565</span></a>
</span><span id="LiveStreamDownloader-566"><a href="#LiveStreamDownloader-566"><span class="linenos"> 566</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_live_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-567"><a href="#LiveStreamDownloader-567"><span class="linenos"> 567</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-568"><a href="#LiveStreamDownloader-568"><span class="linenos"> 568</span></a>
</span><span id="LiveStreamDownloader-569"><a href="#LiveStreamDownloader-569"><span class="linenos"> 569</span></a>        <span class="n">base_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader-570"><a href="#LiveStreamDownloader-570"><span class="linenos"> 570</span></a>
</span><span id="LiveStreamDownloader-571"><a href="#LiveStreamDownloader-571"><span class="linenos"> 571</span></a>        <span class="k">class</span><span class="w"> </span><span class="nc">YTDLP_Chat_logger</span><span class="p">(</span><span class="n">YTDLPLogger</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-572"><a href="#LiveStreamDownloader-572"><span class="linenos"> 572</span></a>            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-573"><a href="#LiveStreamDownloader-573"><span class="linenos"> 573</span></a>                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-574"><a href="#LiveStreamDownloader-574"><span class="linenos"> 574</span></a>                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-575"><a href="#LiveStreamDownloader-575"><span class="linenos"> 575</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-576"><a href="#LiveStreamDownloader-576"><span class="linenos"> 576</span></a>
</span><span id="LiveStreamDownloader-577"><a href="#LiveStreamDownloader-577"><span class="linenos"> 577</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-578"><a href="#LiveStreamDownloader-578"><span class="linenos"> 578</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[live-chat] &quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-579"><a href="#LiveStreamDownloader-579"><span class="linenos"> 579</span></a>                    <span class="k">return</span> <span class="n">msg</span>
</span><span id="LiveStreamDownloader-580"><a href="#LiveStreamDownloader-580"><span class="linenos"> 580</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[live-chat] </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-581"><a href="#LiveStreamDownloader-581"><span class="linenos"> 581</span></a>
</span><span id="LiveStreamDownloader-582"><a href="#LiveStreamDownloader-582"><span class="linenos"> 582</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-583"><a href="#LiveStreamDownloader-583"><span class="linenos"> 583</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-584"><a href="#LiveStreamDownloader-584"><span class="linenos"> 584</span></a>
</span><span id="LiveStreamDownloader-585"><a href="#LiveStreamDownloader-585"><span class="linenos"> 585</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-586"><a href="#LiveStreamDownloader-586"><span class="linenos"> 586</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-587"><a href="#LiveStreamDownloader-587"><span class="linenos"> 587</span></a>
</span><span id="LiveStreamDownloader-588"><a href="#LiveStreamDownloader-588"><span class="linenos"> 588</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-589"><a href="#LiveStreamDownloader-589"><span class="linenos"> 589</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-590"><a href="#LiveStreamDownloader-590"><span class="linenos"> 590</span></a>
</span><span id="LiveStreamDownloader-591"><a href="#LiveStreamDownloader-591"><span class="linenos"> 591</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-592"><a href="#LiveStreamDownloader-592"><span class="linenos"> 592</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-593"><a href="#LiveStreamDownloader-593"><span class="linenos"> 593</span></a>
</span><span id="LiveStreamDownloader-594"><a href="#LiveStreamDownloader-594"><span class="linenos"> 594</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
</span><span id="LiveStreamDownloader-595"><a href="#LiveStreamDownloader-595"><span class="linenos"> 595</span></a>
</span><span id="LiveStreamDownloader-596"><a href="#LiveStreamDownloader-596"><span class="linenos"> 596</span></a>        <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LiveStreamDownloader-597"><a href="#LiveStreamDownloader-597"><span class="linenos"> 597</span></a>            <span class="s2">&quot;skip_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Skip downloading video/audio</span>
</span><span id="LiveStreamDownloader-598"><a href="#LiveStreamDownloader-598"><span class="linenos"> 598</span></a>            <span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="n">YTDLP_Chat_logger</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-599"><a href="#LiveStreamDownloader-599"><span class="linenos"> 599</span></a>            <span class="c1">#&#39;quiet&#39;: True,</span>
</span><span id="LiveStreamDownloader-600"><a href="#LiveStreamDownloader-600"><span class="linenos"> 600</span></a>            <span class="s2">&quot;cookiefile&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cookies&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-601"><a href="#LiveStreamDownloader-601"><span class="linenos"> 601</span></a>            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-602"><a href="#LiveStreamDownloader-602"><span class="linenos"> 602</span></a>            <span class="s2">&quot;concurrent_fragment_downloads&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-603"><a href="#LiveStreamDownloader-603"><span class="linenos"> 603</span></a>            <span class="c1">#&#39;live_from_start&#39;: True,</span>
</span><span id="LiveStreamDownloader-604"><a href="#LiveStreamDownloader-604"><span class="linenos"> 604</span></a>            <span class="s2">&quot;writesubtitles&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Extract subtitles (live chat)</span>
</span><span id="LiveStreamDownloader-605"><a href="#LiveStreamDownloader-605"><span class="linenos"> 605</span></a>            <span class="s2">&quot;subtitlesformat&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>  <span class="c1"># Set format to JSON</span>
</span><span id="LiveStreamDownloader-606"><a href="#LiveStreamDownloader-606"><span class="linenos"> 606</span></a>            <span class="s2">&quot;subtitleslangs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;live_chat&quot;</span><span class="p">],</span>  <span class="c1"># Only extract live chat subtitles</span>
</span><span id="LiveStreamDownloader-607"><a href="#LiveStreamDownloader-607"><span class="linenos"> 607</span></a>            <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="n">base_output</span><span class="p">,</span>  <span class="c1"># Save to a JSON file</span>
</span><span id="LiveStreamDownloader-608"><a href="#LiveStreamDownloader-608"><span class="linenos"> 608</span></a>        <span class="p">}</span>
</span><span id="LiveStreamDownloader-609"><a href="#LiveStreamDownloader-609"><span class="linenos"> 609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ytdlp_options&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="LiveStreamDownloader-610"><a href="#LiveStreamDownloader-610"><span class="linenos"> 610</span></a>        <span class="n">ydl_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ytdlp_options&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="LiveStreamDownloader-611"><a href="#LiveStreamDownloader-611"><span class="linenos"> 611</span></a>
</span><span id="LiveStreamDownloader-612"><a href="#LiveStreamDownloader-612"><span class="linenos"> 612</span></a>        <span class="n">livechat_filename</span> <span class="o">=</span> <span class="n">base_output</span> <span class="o">+</span> <span class="s2">&quot;.live_chat.json&quot;</span>
</span><span id="LiveStreamDownloader-613"><a href="#LiveStreamDownloader-613"><span class="linenos"> 613</span></a>
</span><span id="LiveStreamDownloader-614"><a href="#LiveStreamDownloader-614"><span class="linenos"> 614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading live chat to: </span><span class="si">{</span><span class="n">livechat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-615"><a href="#LiveStreamDownloader-615"><span class="linenos"> 615</span></a>
</span><span id="LiveStreamDownloader-616"><a href="#LiveStreamDownloader-616"><span class="linenos"> 616</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-617"><a href="#LiveStreamDownloader-617"><span class="linenos"> 617</span></a>        <span class="n">part_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">livechat_filename</span><span class="si">}</span><span class="s2">.part&quot;</span>
</span><span id="LiveStreamDownloader-618"><a href="#LiveStreamDownloader-618"><span class="linenos"> 618</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">part_file</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-619"><a href="#LiveStreamDownloader-619"><span class="linenos"> 619</span></a>            <span class="c1"># Append part to</span>
</span><span id="LiveStreamDownloader-620"><a href="#LiveStreamDownloader-620"><span class="linenos"> 620</span></a>            <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># number of characters per chunk, up to 10M characters</span>
</span><span id="LiveStreamDownloader-621"><a href="#LiveStreamDownloader-621"><span class="linenos"> 621</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">part_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fa</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fb</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-622"><a href="#LiveStreamDownloader-622"><span class="linenos"> 622</span></a>                <span class="k">while</span> <span class="n">chunk</span> <span class="o">:=</span> <span class="n">fa</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-623"><a href="#LiveStreamDownloader-623"><span class="linenos"> 623</span></a>                    <span class="n">fb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-624"><a href="#LiveStreamDownloader-624"><span class="linenos"> 624</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">livechat_filename</span><span class="si">}</span><span class="s2">.part&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-625"><a href="#LiveStreamDownloader-625"><span class="linenos"> 625</span></a>
</span><span id="LiveStreamDownloader-626"><a href="#LiveStreamDownloader-626"><span class="linenos"> 626</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-627"><a href="#LiveStreamDownloader-627"><span class="linenos"> 627</span></a>            <span class="n">zip_filename</span> <span class="o">=</span> <span class="n">base_output</span> <span class="o">+</span> <span class="s2">&quot;.live_chat.zip&quot;</span>
</span><span id="LiveStreamDownloader-628"><a href="#LiveStreamDownloader-628"><span class="linenos"> 628</span></a>            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-629"><a href="#LiveStreamDownloader-629"><span class="linenos"> 629</span></a>                <span class="n">zip_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">allowZip64</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader-630"><a href="#LiveStreamDownloader-630"><span class="linenos"> 630</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-631"><a href="#LiveStreamDownloader-631"><span class="linenos"> 631</span></a>                <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-632"><a href="#LiveStreamDownloader-632"><span class="linenos"> 632</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-633"><a href="#LiveStreamDownloader-633"><span class="linenos"> 633</span></a>            <span class="n">live_chat</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;live_chat&quot;</span><span class="p">:</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">zip_filename</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;live_chat&quot;</span><span class="p">)}</span>
</span><span id="LiveStreamDownloader-634"><a href="#LiveStreamDownloader-634"><span class="linenos"> 634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">live_chat</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-635"><a href="#LiveStreamDownloader-635"><span class="linenos"> 635</span></a>            <span class="k">return</span> <span class="n">live_chat</span><span class="p">,</span> <span class="s2">&quot;live_chat&quot;</span>
</span><span id="LiveStreamDownloader-636"><a href="#LiveStreamDownloader-636"><span class="linenos"> 636</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-637"><a href="#LiveStreamDownloader-637"><span class="linenos"> 637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[31m</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-638"><a href="#LiveStreamDownloader-638"><span class="linenos"> 638</span></a>
</span><span id="LiveStreamDownloader-639"><a href="#LiveStreamDownloader-639"><span class="linenos"> 639</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">replace_ip_in_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-640"><a href="#LiveStreamDownloader-640"><span class="linenos"> 640</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;((?:[0-9]{1,3}\.)</span><span class="si">{3}</span><span class="s2">[0-9]{1,3})|((?:[a-f0-9]{1,4}:)</span><span class="si">{7}</span><span class="s2">[a-f0-9]{1,4})&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-641"><a href="#LiveStreamDownloader-641"><span class="linenos"> 641</span></a>
</span><span id="LiveStreamDownloader-642"><a href="#LiveStreamDownloader-642"><span class="linenos"> 642</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-643"><a href="#LiveStreamDownloader-643"><span class="linenos"> 643</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-644"><a href="#LiveStreamDownloader-644"><span class="linenos"> 644</span></a>
</span><span id="LiveStreamDownloader-645"><a href="#LiveStreamDownloader-645"><span class="linenos"> 645</span></a>        <span class="n">modified_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-646"><a href="#LiveStreamDownloader-646"><span class="linenos"> 646</span></a>
</span><span id="LiveStreamDownloader-647"><a href="#LiveStreamDownloader-647"><span class="linenos"> 647</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-648"><a href="#LiveStreamDownloader-648"><span class="linenos"> 648</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">modified_content</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-649"><a href="#LiveStreamDownloader-649"><span class="linenos"> 649</span></a>
</span><span id="LiveStreamDownloader-650"><a href="#LiveStreamDownloader-650"><span class="linenos"> 650</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_urls_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-651"><a href="#LiveStreamDownloader-651"><span class="linenos"> 651</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-652"><a href="#LiveStreamDownloader-652"><span class="linenos"> 652</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-653"><a href="#LiveStreamDownloader-653"><span class="linenos"> 653</span></a>
</span><span id="LiveStreamDownloader-654"><a href="#LiveStreamDownloader-654"><span class="linenos"> 654</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;formats&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-655"><a href="#LiveStreamDownloader-655"><span class="linenos"> 655</span></a>            <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;formats&quot;</span><span class="p">]:</span>
</span><span id="LiveStreamDownloader-656"><a href="#LiveStreamDownloader-656"><span class="linenos"> 656</span></a>                <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-657"><a href="#LiveStreamDownloader-657"><span class="linenos"> 657</span></a>                    <span class="nb">format</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-658"><a href="#LiveStreamDownloader-658"><span class="linenos"> 658</span></a>
</span><span id="LiveStreamDownloader-659"><a href="#LiveStreamDownloader-659"><span class="linenos"> 659</span></a>                <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-660"><a href="#LiveStreamDownloader-660"><span class="linenos"> 660</span></a>                    <span class="nb">format</span><span class="p">[</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-661"><a href="#LiveStreamDownloader-661"><span class="linenos"> 661</span></a>
</span><span id="LiveStreamDownloader-662"><a href="#LiveStreamDownloader-662"><span class="linenos"> 662</span></a>                <span class="nb">format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fragment_base_url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-663"><a href="#LiveStreamDownloader-663"><span class="linenos"> 663</span></a>                <span class="nb">format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fragments&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-664"><a href="#LiveStreamDownloader-664"><span class="linenos"> 664</span></a>
</span><span id="LiveStreamDownloader-665"><a href="#LiveStreamDownloader-665"><span class="linenos"> 665</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-666"><a href="#LiveStreamDownloader-666"><span class="linenos"> 666</span></a>            <span class="k">for</span> <span class="n">thumbnail</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">]:</span>
</span><span id="LiveStreamDownloader-667"><a href="#LiveStreamDownloader-667"><span class="linenos"> 667</span></a>                <span class="k">if</span> <span class="n">thumbnail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-668"><a href="#LiveStreamDownloader-668"><span class="linenos"> 668</span></a>                    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">thumbnail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-669"><a href="#LiveStreamDownloader-669"><span class="linenos"> 669</span></a>                    <span class="n">thumbnail</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="si">}{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-670"><a href="#LiveStreamDownloader-670"><span class="linenos"> 670</span></a>
</span><span id="LiveStreamDownloader-671"><a href="#LiveStreamDownloader-671"><span class="linenos"> 671</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-672"><a href="#LiveStreamDownloader-672"><span class="linenos"> 672</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-673"><a href="#LiveStreamDownloader-673"><span class="linenos"> 673</span></a>
</span><span id="LiveStreamDownloader-674"><a href="#LiveStreamDownloader-674"><span class="linenos"> 674</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-675"><a href="#LiveStreamDownloader-675"><span class="linenos"> 675</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-676"><a href="#LiveStreamDownloader-676"><span class="linenos"> 676</span></a>
</span><span id="LiveStreamDownloader-677"><a href="#LiveStreamDownloader-677"><span class="linenos"> 677</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;removed_urls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="LiveStreamDownloader-678"><a href="#LiveStreamDownloader-678"><span class="linenos"> 678</span></a>
</span><span id="LiveStreamDownloader-679"><a href="#LiveStreamDownloader-679"><span class="linenos"> 679</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-680"><a href="#LiveStreamDownloader-680"><span class="linenos"> 680</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-681"><a href="#LiveStreamDownloader-681"><span class="linenos"> 681</span></a>
</span><span id="LiveStreamDownloader-682"><a href="#LiveStreamDownloader-682"><span class="linenos"> 682</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_auxiliary_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-683"><a href="#LiveStreamDownloader-683"><span class="linenos"> 683</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-684"><a href="#LiveStreamDownloader-684"><span class="linenos"> 684</span></a>
</span><span id="LiveStreamDownloader-685"><a href="#LiveStreamDownloader-685"><span class="linenos"> 685</span></a>        <span class="n">base_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader-686"><a href="#LiveStreamDownloader-686"><span class="linenos"> 686</span></a>
</span><span id="LiveStreamDownloader-687"><a href="#LiveStreamDownloader-687"><span class="linenos"> 687</span></a>        <span class="n">created_files</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader-688"><a href="#LiveStreamDownloader-688"><span class="linenos"> 688</span></a>
</span><span id="LiveStreamDownloader-689"><a href="#LiveStreamDownloader-689"><span class="linenos"> 689</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
</span><span id="LiveStreamDownloader-690"><a href="#LiveStreamDownloader-690"><span class="linenos"> 690</span></a>
</span><span id="LiveStreamDownloader-691"><a href="#LiveStreamDownloader-691"><span class="linenos"> 691</span></a>        <span class="k">class</span><span class="w"> </span><span class="nc">YTDLP_Auxiliary_logger</span><span class="p">(</span><span class="n">YTDLPLogger</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-692"><a href="#LiveStreamDownloader-692"><span class="linenos"> 692</span></a>            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-693"><a href="#LiveStreamDownloader-693"><span class="linenos"> 693</span></a>                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-694"><a href="#LiveStreamDownloader-694"><span class="linenos"> 694</span></a>                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-695"><a href="#LiveStreamDownloader-695"><span class="linenos"> 695</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-696"><a href="#LiveStreamDownloader-696"><span class="linenos"> 696</span></a>
</span><span id="LiveStreamDownloader-697"><a href="#LiveStreamDownloader-697"><span class="linenos"> 697</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-698"><a href="#LiveStreamDownloader-698"><span class="linenos"> 698</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[live-chat] &quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-699"><a href="#LiveStreamDownloader-699"><span class="linenos"> 699</span></a>                    <span class="k">return</span> <span class="n">msg</span>
</span><span id="LiveStreamDownloader-700"><a href="#LiveStreamDownloader-700"><span class="linenos"> 700</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[live-chat] </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-701"><a href="#LiveStreamDownloader-701"><span class="linenos"> 701</span></a>
</span><span id="LiveStreamDownloader-702"><a href="#LiveStreamDownloader-702"><span class="linenos"> 702</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-703"><a href="#LiveStreamDownloader-703"><span class="linenos"> 703</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-704"><a href="#LiveStreamDownloader-704"><span class="linenos"> 704</span></a>
</span><span id="LiveStreamDownloader-705"><a href="#LiveStreamDownloader-705"><span class="linenos"> 705</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-706"><a href="#LiveStreamDownloader-706"><span class="linenos"> 706</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-707"><a href="#LiveStreamDownloader-707"><span class="linenos"> 707</span></a>
</span><span id="LiveStreamDownloader-708"><a href="#LiveStreamDownloader-708"><span class="linenos"> 708</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-709"><a href="#LiveStreamDownloader-709"><span class="linenos"> 709</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-710"><a href="#LiveStreamDownloader-710"><span class="linenos"> 710</span></a>
</span><span id="LiveStreamDownloader-711"><a href="#LiveStreamDownloader-711"><span class="linenos"> 711</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-712"><a href="#LiveStreamDownloader-712"><span class="linenos"> 712</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-713"><a href="#LiveStreamDownloader-713"><span class="linenos"> 713</span></a>
</span><span id="LiveStreamDownloader-714"><a href="#LiveStreamDownloader-714"><span class="linenos"> 714</span></a>        <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LiveStreamDownloader-715"><a href="#LiveStreamDownloader-715"><span class="linenos"> 715</span></a>            <span class="s2">&quot;skip_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-716"><a href="#LiveStreamDownloader-716"><span class="linenos"> 716</span></a>            <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-717"><a href="#LiveStreamDownloader-717"><span class="linenos"> 717</span></a>            <span class="c1">#        &#39;cookiefile&#39;: options.get(&#39;cookies&#39;, None),</span>
</span><span id="LiveStreamDownloader-718"><a href="#LiveStreamDownloader-718"><span class="linenos"> 718</span></a>            <span class="s2">&quot;writeinfojson&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_info_json&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-719"><a href="#LiveStreamDownloader-719"><span class="linenos"> 719</span></a>            <span class="s2">&quot;writedescription&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_description&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-720"><a href="#LiveStreamDownloader-720"><span class="linenos"> 720</span></a>            <span class="s2">&quot;writethumbnail&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_thumbnail&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embed_thumbnail&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
</span><span id="LiveStreamDownloader-721"><a href="#LiveStreamDownloader-721"><span class="linenos"> 721</span></a>            <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="n">base_output</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-722"><a href="#LiveStreamDownloader-722"><span class="linenos"> 722</span></a>            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-723"><a href="#LiveStreamDownloader-723"><span class="linenos"> 723</span></a>            <span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="n">YTDLPLogger</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-724"><a href="#LiveStreamDownloader-724"><span class="linenos"> 724</span></a>        <span class="p">}</span>
</span><span id="LiveStreamDownloader-725"><a href="#LiveStreamDownloader-725"><span class="linenos"> 725</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-726"><a href="#LiveStreamDownloader-726"><span class="linenos"> 726</span></a>            <span class="n">ydl_opts</span><span class="p">[</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">((</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-727"><a href="#LiveStreamDownloader-727"><span class="linenos"> 727</span></a>
</span><span id="LiveStreamDownloader-728"><a href="#LiveStreamDownloader-728"><span class="linenos"> 728</span></a>        <span class="k">with</span> <span class="n">YoutubeDL</span><span class="p">(</span><span class="n">ydl_opts</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-729"><a href="#LiveStreamDownloader-729"><span class="linenos"> 729</span></a>            <span class="c1"># base_name = ydl.prepare_filename(info_dict)</span>
</span><span id="LiveStreamDownloader-730"><a href="#LiveStreamDownloader-730"><span class="linenos"> 730</span></a>            <span class="c1"># result = ydl.download_with_info_file(info_dict)</span>
</span><span id="LiveStreamDownloader-731"><a href="#LiveStreamDownloader-731"><span class="linenos"> 731</span></a>
</span><span id="LiveStreamDownloader-732"><a href="#LiveStreamDownloader-732"><span class="linenos"> 732</span></a>            <span class="k">if</span> <span class="n">ydl</span><span class="o">.</span><span class="n">_write_info_json</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;infojson&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-733"><a href="#LiveStreamDownloader-733"><span class="linenos"> 733</span></a>                <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;infojson&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-734"><a href="#LiveStreamDownloader-734"><span class="linenos"> 734</span></a>            <span class="p">):</span>
</span><span id="LiveStreamDownloader-735"><a href="#LiveStreamDownloader-735"><span class="linenos"> 735</span></a>                <span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;info_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-736"><a href="#LiveStreamDownloader-736"><span class="linenos"> 736</span></a>                    <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;infojson&quot;</span><span class="p">),</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;info_json&quot;</span>
</span><span id="LiveStreamDownloader-737"><a href="#LiveStreamDownloader-737"><span class="linenos"> 737</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader-738"><a href="#LiveStreamDownloader-738"><span class="linenos"> 738</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-739"><a href="#LiveStreamDownloader-739"><span class="linenos"> 739</span></a>                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remove_ip_from_json&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-740"><a href="#LiveStreamDownloader-740"><span class="linenos"> 740</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">replace_ip_in_json</span><span class="p">(</span><span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;info_json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="LiveStreamDownloader-741"><a href="#LiveStreamDownloader-741"><span class="linenos"> 741</span></a>                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;clean_urls&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-742"><a href="#LiveStreamDownloader-742"><span class="linenos"> 742</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_urls_from_json</span><span class="p">(</span><span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;info_json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="LiveStreamDownloader-743"><a href="#LiveStreamDownloader-743"><span class="linenos"> 743</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-744"><a href="#LiveStreamDownloader-744"><span class="linenos"> 744</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-745"><a href="#LiveStreamDownloader-745"><span class="linenos"> 745</span></a>
</span><span id="LiveStreamDownloader-746"><a href="#LiveStreamDownloader-746"><span class="linenos"> 746</span></a>            <span class="k">if</span> <span class="n">ydl</span><span class="o">.</span><span class="n">_write_description</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-747"><a href="#LiveStreamDownloader-747"><span class="linenos"> 747</span></a>                <span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-748"><a href="#LiveStreamDownloader-748"><span class="linenos"> 748</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader-749"><a href="#LiveStreamDownloader-749"><span class="linenos"> 749</span></a>                <span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-750"><a href="#LiveStreamDownloader-750"><span class="linenos"> 750</span></a>                    <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">),</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;description&quot;</span>
</span><span id="LiveStreamDownloader-751"><a href="#LiveStreamDownloader-751"><span class="linenos"> 751</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader-752"><a href="#LiveStreamDownloader-752"><span class="linenos"> 752</span></a>
</span><span id="LiveStreamDownloader-753"><a href="#LiveStreamDownloader-753"><span class="linenos"> 753</span></a>            <span class="n">thumbnails</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">_write_thumbnails</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;thumbnail&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-754"><a href="#LiveStreamDownloader-754"><span class="linenos"> 754</span></a>
</span><span id="LiveStreamDownloader-755"><a href="#LiveStreamDownloader-755"><span class="linenos"> 755</span></a>            <span class="k">if</span> <span class="n">thumbnails</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-756"><a href="#LiveStreamDownloader-756"><span class="linenos"> 756</span></a>                <span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">thumbnails</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-757"><a href="#LiveStreamDownloader-757"><span class="linenos"> 757</span></a>
</span><span id="LiveStreamDownloader-758"><a href="#LiveStreamDownloader-758"><span class="linenos"> 758</span></a>        <span class="k">return</span> <span class="n">created_files</span><span class="p">,</span> <span class="s2">&quot;auxiliary&quot;</span>
</span><span id="LiveStreamDownloader-759"><a href="#LiveStreamDownloader-759"><span class="linenos"> 759</span></a>
</span><span id="LiveStreamDownloader-760"><a href="#LiveStreamDownloader-760"><span class="linenos"> 760</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_mp4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-761"><a href="#LiveStreamDownloader-761"><span class="linenos"> 761</span></a>        <span class="c1"># self.logger.debug(&quot;Files: {0}&quot;.format(json.dumps(file_names)))</span>
</span><span id="LiveStreamDownloader-762"><a href="#LiveStreamDownloader-762"><span class="linenos"> 762</span></a>        <span class="n">stream_manifests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="LiveStreamDownloader-763"><a href="#LiveStreamDownloader-763"><span class="linenos"> 763</span></a>        <span class="k">for</span> <span class="n">manifest</span><span class="p">,</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">stream_manifests</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-764"><a href="#LiveStreamDownloader-764"><span class="linenos"> 764</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LiveStreamDownloader-765"><a href="#LiveStreamDownloader-765"><span class="linenos"> 765</span></a>            <span class="n">thumbnail</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-766"><a href="#LiveStreamDownloader-766"><span class="linenos"> 766</span></a>            <span class="n">video</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader-767"><a href="#LiveStreamDownloader-767"><span class="linenos"> 767</span></a>            <span class="n">ext</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-768"><a href="#LiveStreamDownloader-768"><span class="linenos"> 768</span></a>
</span><span id="LiveStreamDownloader-769"><a href="#LiveStreamDownloader-769"><span class="linenos"> 769</span></a>            <span class="n">ffmpeg_builder</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ffmpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span> <span class="s2">&quot;-nostdin&quot;</span><span class="p">,</span> <span class="s2">&quot;-loglevel&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;-stats&quot;</span><span class="p">]</span>
</span><span id="LiveStreamDownloader-770"><a href="#LiveStreamDownloader-770"><span class="linenos"> 770</span></a>
</span><span id="LiveStreamDownloader-771"><a href="#LiveStreamDownloader-771"><span class="linenos"> 771</span></a>            <span class="c1"># Add input files</span>
</span><span id="LiveStreamDownloader-772"><a href="#LiveStreamDownloader-772"><span class="linenos"> 772</span></a>            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-773"><a href="#LiveStreamDownloader-773"><span class="linenos"> 773</span></a>                <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-thread_queue_size&quot;</span><span class="p">,</span> <span class="s2">&quot;1024&quot;</span><span class="p">,</span> <span class="s2">&quot;-seekable&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())]</span>
</span><span id="LiveStreamDownloader-774"><a href="#LiveStreamDownloader-774"><span class="linenos"> 774</span></a>                <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-775"><a href="#LiveStreamDownloader-775"><span class="linenos"> 775</span></a>                <span class="n">video</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="LiveStreamDownloader-776"><a href="#LiveStreamDownloader-776"><span class="linenos"> 776</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader-777"><a href="#LiveStreamDownloader-777"><span class="linenos"> 777</span></a>
</span><span id="LiveStreamDownloader-778"><a href="#LiveStreamDownloader-778"><span class="linenos"> 778</span></a>            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-779"><a href="#LiveStreamDownloader-779"><span class="linenos"> 779</span></a>                <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-thread_queue_size&quot;</span><span class="p">,</span> <span class="s2">&quot;1024&quot;</span><span class="p">,</span> <span class="s2">&quot;-seekable&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())]</span>
</span><span id="LiveStreamDownloader-780"><a href="#LiveStreamDownloader-780"><span class="linenos"> 780</span></a>                <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-781"><a href="#LiveStreamDownloader-781"><span class="linenos"> 781</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader-782"><a href="#LiveStreamDownloader-782"><span class="linenos"> 782</span></a>                <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-783"><a href="#LiveStreamDownloader-783"><span class="linenos"> 783</span></a>                    <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.mka&quot;</span>
</span><span id="LiveStreamDownloader-784"><a href="#LiveStreamDownloader-784"><span class="linenos"> 784</span></a>
</span><span id="LiveStreamDownloader-785"><a href="#LiveStreamDownloader-785"><span class="linenos"> 785</span></a>            <span class="c1"># Determine output path</span>
</span><span id="LiveStreamDownloader-786"><a href="#LiveStreamDownloader-786"><span class="linenos"> 786</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-787"><a href="#LiveStreamDownloader-787"><span class="linenos"> 787</span></a>
</span><span id="LiveStreamDownloader-788"><a href="#LiveStreamDownloader-788"><span class="linenos"> 788</span></a>            <span class="n">base_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader-789"><a href="#LiveStreamDownloader-789"><span class="linenos"> 789</span></a>
</span><span id="LiveStreamDownloader-790"><a href="#LiveStreamDownloader-790"><span class="linenos"> 790</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_manifests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-791"><a href="#LiveStreamDownloader-791"><span class="linenos"> 791</span></a>                <span class="n">base_output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_output</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">manifest</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-792"><a href="#LiveStreamDownloader-792"><span class="linenos"> 792</span></a>
</span><span id="LiveStreamDownloader-793"><a href="#LiveStreamDownloader-793"><span class="linenos"> 793</span></a>            <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-794"><a href="#LiveStreamDownloader-794"><span class="linenos"> 794</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No extension detected, switching to yt-dlp decided video (defaulting to MP4)&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-795"><a href="#LiveStreamDownloader-795"><span class="linenos"> 795</span></a>                <span class="n">ext</span> <span class="o">=</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-796"><a href="#LiveStreamDownloader-796"><span class="linenos"> 796</span></a>            <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-797"><a href="#LiveStreamDownloader-797"><span class="linenos"> 797</span></a>                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-798"><a href="#LiveStreamDownloader-798"><span class="linenos"> 798</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">base_output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-799"><a href="#LiveStreamDownloader-799"><span class="linenos"> 799</span></a>                <span class="n">base_output</span> <span class="o">=</span> <span class="n">base_output</span> <span class="o">+</span> <span class="n">ext</span>
</span><span id="LiveStreamDownloader-800"><a href="#LiveStreamDownloader-800"><span class="linenos"> 800</span></a>
</span><span id="LiveStreamDownloader-801"><a href="#LiveStreamDownloader-801"><span class="linenos"> 801</span></a>            <span class="k">if</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embed_thumbnail&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-802"><a href="#LiveStreamDownloader-802"><span class="linenos"> 802</span></a>                <span class="k">if</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="LiveStreamDownloader-803"><a href="#LiveStreamDownloader-803"><span class="linenos"> 803</span></a>                    <span class="c1"># Use &quot;guess_file_type&quot; if function exists (added in 3.13), otherwise fall back to depreciated version</span>
</span><span id="LiveStreamDownloader-804"><a href="#LiveStreamDownloader-804"><span class="linenos"> 804</span></a>                    <span class="n">guess</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mimetypes</span><span class="p">,</span> <span class="s2">&quot;guess_file_type&quot;</span><span class="p">,</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-805"><a href="#LiveStreamDownloader-805"><span class="linenos"> 805</span></a>
</span><span id="LiveStreamDownloader-806"><a href="#LiveStreamDownloader-806"><span class="linenos"> 806</span></a>                    <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-807"><a href="#LiveStreamDownloader-807"><span class="linenos"> 807</span></a>
</span><span id="LiveStreamDownloader-808"><a href="#LiveStreamDownloader-808"><span class="linenos"> 808</span></a>                    <span class="c1"># If not jpeg or png, convert to png</span>
</span><span id="LiveStreamDownloader-809"><a href="#LiveStreamDownloader-809"><span class="linenos"> 809</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">mime_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/png&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-810"><a href="#LiveStreamDownloader-810"><span class="linenos"> 810</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-811"><a href="#LiveStreamDownloader-811"><span class="linenos"> 811</span></a>                            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a JPG or PNG file, converting to png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-812"><a href="#LiveStreamDownloader-812"><span class="linenos"> 812</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader-813"><a href="#LiveStreamDownloader-813"><span class="linenos"> 813</span></a>                        <span class="n">png_thumbnail</span> <span class="o">=</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-814"><a href="#LiveStreamDownloader-814"><span class="linenos"> 814</span></a>
</span><span id="LiveStreamDownloader-815"><a href="#LiveStreamDownloader-815"><span class="linenos"> 815</span></a>                        <span class="n">thumbnail_conversion</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LiveStreamDownloader-816"><a href="#LiveStreamDownloader-816"><span class="linenos"> 816</span></a>                            <span class="s2">&quot;ffmpeg&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-817"><a href="#LiveStreamDownloader-817"><span class="linenos"> 817</span></a>                            <span class="s2">&quot;-y&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-818"><a href="#LiveStreamDownloader-818"><span class="linenos"> 818</span></a>                            <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-819"><a href="#LiveStreamDownloader-819"><span class="linenos"> 819</span></a>                            <span class="s2">&quot;-nostdin&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-820"><a href="#LiveStreamDownloader-820"><span class="linenos"> 820</span></a>                            <span class="s2">&quot;-loglevel&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-821"><a href="#LiveStreamDownloader-821"><span class="linenos"> 821</span></a>                            <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-822"><a href="#LiveStreamDownloader-822"><span class="linenos"> 822</span></a>                            <span class="s2">&quot;-stats&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-823"><a href="#LiveStreamDownloader-823"><span class="linenos"> 823</span></a>                            <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-824"><a href="#LiveStreamDownloader-824"><span class="linenos"> 824</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader-825"><a href="#LiveStreamDownloader-825"><span class="linenos"> 825</span></a>                            <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-826"><a href="#LiveStreamDownloader-826"><span class="linenos"> 826</span></a>                            <span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-827"><a href="#LiveStreamDownloader-827"><span class="linenos"> 827</span></a>                            <span class="s2">&quot;-compression_level&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-828"><a href="#LiveStreamDownloader-828"><span class="linenos"> 828</span></a>                            <span class="s2">&quot;9&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-829"><a href="#LiveStreamDownloader-829"><span class="linenos"> 829</span></a>                            <span class="s2">&quot;-pred&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-830"><a href="#LiveStreamDownloader-830"><span class="linenos"> 830</span></a>                            <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-831"><a href="#LiveStreamDownloader-831"><span class="linenos"> 831</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">png_thumbnail</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader-832"><a href="#LiveStreamDownloader-832"><span class="linenos"> 832</span></a>                        <span class="p">]</span>
</span><span id="LiveStreamDownloader-833"><a href="#LiveStreamDownloader-833"><span class="linenos"> 833</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-834"><a href="#LiveStreamDownloader-834"><span class="linenos"> 834</span></a>                            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-835"><a href="#LiveStreamDownloader-835"><span class="linenos"> 835</span></a>                                <span class="n">thumbnail_conversion</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-836"><a href="#LiveStreamDownloader-836"><span class="linenos"> 836</span></a>                                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-837"><a href="#LiveStreamDownloader-837"><span class="linenos"> 837</span></a>                                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-838"><a href="#LiveStreamDownloader-838"><span class="linenos"> 838</span></a>                                <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-839"><a href="#LiveStreamDownloader-839"><span class="linenos"> 839</span></a>                                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-840"><a href="#LiveStreamDownloader-840"><span class="linenos"> 840</span></a>                            <span class="p">)</span>
</span><span id="LiveStreamDownloader-841"><a href="#LiveStreamDownloader-841"><span class="linenos"> 841</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Replacing thumbnail with .png version&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-842"><a href="#LiveStreamDownloader-842"><span class="linenos"> 842</span></a>                            <span class="n">file_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-843"><a href="#LiveStreamDownloader-843"><span class="linenos"> 843</span></a>                            <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">png_thumbnail</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-844"><a href="#LiveStreamDownloader-844"><span class="linenos"> 844</span></a>
</span><span id="LiveStreamDownloader-845"><a href="#LiveStreamDownloader-845"><span class="linenos"> 845</span></a>                        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-846"><a href="#LiveStreamDownloader-846"><span class="linenos"> 846</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-847"><a href="#LiveStreamDownloader-847"><span class="linenos"> 847</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-848"><a href="#LiveStreamDownloader-848"><span class="linenos"> 848</span></a>
</span><span id="LiveStreamDownloader-849"><a href="#LiveStreamDownloader-849"><span class="linenos"> 849</span></a>                    <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="LiveStreamDownloader-850"><a href="#LiveStreamDownloader-850"><span class="linenos"> 850</span></a>                    <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;.mkv&quot;</span><span class="p">:</span>  <span class="c1"># Don&#39;t add input file for mkv, use attach later</span>
</span><span id="LiveStreamDownloader-851"><a href="#LiveStreamDownloader-851"><span class="linenos"> 851</span></a>                        <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LiveStreamDownloader-852"><a href="#LiveStreamDownloader-852"><span class="linenos"> 852</span></a>                            <span class="s2">&quot;-thread_queue_size&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-853"><a href="#LiveStreamDownloader-853"><span class="linenos"> 853</span></a>                            <span class="s2">&quot;1024&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-854"><a href="#LiveStreamDownloader-854"><span class="linenos"> 854</span></a>                            <span class="s2">&quot;-seekable&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-855"><a href="#LiveStreamDownloader-855"><span class="linenos"> 855</span></a>                            <span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-856"><a href="#LiveStreamDownloader-856"><span class="linenos"> 856</span></a>                            <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-857"><a href="#LiveStreamDownloader-857"><span class="linenos"> 857</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader-858"><a href="#LiveStreamDownloader-858"><span class="linenos"> 858</span></a>                        <span class="p">]</span>
</span><span id="LiveStreamDownloader-859"><a href="#LiveStreamDownloader-859"><span class="linenos"> 859</span></a>                        <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-860"><a href="#LiveStreamDownloader-860"><span class="linenos"> 860</span></a>                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader-861"><a href="#LiveStreamDownloader-861"><span class="linenos"> 861</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-862"><a href="#LiveStreamDownloader-862"><span class="linenos"> 862</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-863"><a href="#LiveStreamDownloader-863"><span class="linenos"> 863</span></a>                        <span class="s2">&quot;Thumbnail file: </span><span class="si">{}</span><span class="s2"> is missing, continuing without embedding&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-864"><a href="#LiveStreamDownloader-864"><span class="linenos"> 864</span></a>                            <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-865"><a href="#LiveStreamDownloader-865"><span class="linenos"> 865</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader-866"><a href="#LiveStreamDownloader-866"><span class="linenos"> 866</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader-867"><a href="#LiveStreamDownloader-867"><span class="linenos"> 867</span></a>
</span><span id="LiveStreamDownloader-868"><a href="#LiveStreamDownloader-868"><span class="linenos"> 868</span></a>            <span class="c1"># Add faststart</span>
</span><span id="LiveStreamDownloader-869"><a href="#LiveStreamDownloader-869"><span class="linenos"> 869</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-movflags&quot;</span><span class="p">,</span> <span class="s2">&quot;faststart&quot;</span><span class="p">])</span>
</span><span id="LiveStreamDownloader-870"><a href="#LiveStreamDownloader-870"><span class="linenos"> 870</span></a>
</span><span id="LiveStreamDownloader-871"><a href="#LiveStreamDownloader-871"><span class="linenos"> 871</span></a>            <span class="c1"># Add mappings</span>
</span><span id="LiveStreamDownloader-872"><a href="#LiveStreamDownloader-872"><span class="linenos"> 872</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-873"><a href="#LiveStreamDownloader-873"><span class="linenos"> 873</span></a>                <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-map&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
</span><span id="LiveStreamDownloader-874"><a href="#LiveStreamDownloader-874"><span class="linenos"> 874</span></a>                <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-875"><a href="#LiveStreamDownloader-875"><span class="linenos"> 875</span></a>
</span><span id="LiveStreamDownloader-876"><a href="#LiveStreamDownloader-876"><span class="linenos"> 876</span></a>            <span class="k">if</span> <span class="n">thumbnail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-877"><a href="#LiveStreamDownloader-877"><span class="linenos"> 877</span></a>                <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.mkv&quot;</span><span class="p">:</span>  <span class="c1"># If file will be mkv, attach file instead</span>
</span><span id="LiveStreamDownloader-878"><a href="#LiveStreamDownloader-878"><span class="linenos"> 878</span></a>                    <span class="c1"># Use &quot;guess_file_type&quot; if function exists (added in 3.13), otherwise fall back to depreciated version</span>
</span><span id="LiveStreamDownloader-879"><a href="#LiveStreamDownloader-879"><span class="linenos"> 879</span></a>                    <span class="n">guess</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mimetypes</span><span class="p">,</span> <span class="s2">&quot;guess_file_type&quot;</span><span class="p">,</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-880"><a href="#LiveStreamDownloader-880"><span class="linenos"> 880</span></a>                    <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-881"><a href="#LiveStreamDownloader-881"><span class="linenos"> 881</span></a>                    <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-882"><a href="#LiveStreamDownloader-882"><span class="linenos"> 882</span></a>                        <span class="p">[</span>
</span><span id="LiveStreamDownloader-883"><a href="#LiveStreamDownloader-883"><span class="linenos"> 883</span></a>                            <span class="s2">&quot;-attach&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-884"><a href="#LiveStreamDownloader-884"><span class="linenos"> 884</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader-885"><a href="#LiveStreamDownloader-885"><span class="linenos"> 885</span></a>                            <span class="s2">&quot;-metadata:s:t:0&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-886"><a href="#LiveStreamDownloader-886"><span class="linenos"> 886</span></a>                            <span class="s2">&quot;filename=cover</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-887"><a href="#LiveStreamDownloader-887"><span class="linenos"> 887</span></a>                            <span class="s2">&quot;-metadata:s:t:0&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-888"><a href="#LiveStreamDownloader-888"><span class="linenos"> 888</span></a>                            <span class="s2">&quot;mimetype=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mime_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader-889"><a href="#LiveStreamDownloader-889"><span class="linenos"> 889</span></a>                        <span class="p">]</span>
</span><span id="LiveStreamDownloader-890"><a href="#LiveStreamDownloader-890"><span class="linenos"> 890</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader-891"><a href="#LiveStreamDownloader-891"><span class="linenos"> 891</span></a>
</span><span id="LiveStreamDownloader-892"><a href="#LiveStreamDownloader-892"><span class="linenos"> 892</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># For other formats, attach using disposition instead</span>
</span><span id="LiveStreamDownloader-893"><a href="#LiveStreamDownloader-893"><span class="linenos"> 893</span></a>                    <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;-disposition:</span><span class="si">{</span><span class="n">thumbnail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;attached_pic&quot;</span><span class="p">])</span>
</span><span id="LiveStreamDownloader-894"><a href="#LiveStreamDownloader-894"><span class="linenos"> 894</span></a>
</span><span id="LiveStreamDownloader-895"><a href="#LiveStreamDownloader-895"><span class="linenos"> 895</span></a>            <span class="c1"># Add Copy codec</span>
</span><span id="LiveStreamDownloader-896"><a href="#LiveStreamDownloader-896"><span class="linenos"> 896</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">])</span>
</span><span id="LiveStreamDownloader-897"><a href="#LiveStreamDownloader-897"><span class="linenos"> 897</span></a>
</span><span id="LiveStreamDownloader-898"><a href="#LiveStreamDownloader-898"><span class="linenos"> 898</span></a>            <span class="c1"># Add metadata</span>
</span><span id="LiveStreamDownloader-899"><a href="#LiveStreamDownloader-899"><span class="linenos"> 899</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;DATE=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;upload_date&quot;</span><span class="p">))])</span>
</span><span id="LiveStreamDownloader-900"><a href="#LiveStreamDownloader-900"><span class="linenos"> 900</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-901"><a href="#LiveStreamDownloader-901"><span class="linenos"> 901</span></a>                <span class="p">[</span>
</span><span id="LiveStreamDownloader-902"><a href="#LiveStreamDownloader-902"><span class="linenos"> 902</span></a>                    <span class="s2">&quot;-metadata&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-903"><a href="#LiveStreamDownloader-903"><span class="linenos"> 903</span></a>                    <span class="s2">&quot;COMMENT=</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;original_url&quot;</span><span class="p">),</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
</span><span id="LiveStreamDownloader-904"><a href="#LiveStreamDownloader-904"><span class="linenos"> 904</span></a>                <span class="p">]</span>
</span><span id="LiveStreamDownloader-905"><a href="#LiveStreamDownloader-905"><span class="linenos"> 905</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-906"><a href="#LiveStreamDownloader-906"><span class="linenos"> 906</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;TITLE=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fulltitle&quot;</span><span class="p">))])</span>
</span><span id="LiveStreamDownloader-907"><a href="#LiveStreamDownloader-907"><span class="linenos"> 907</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;ARTIST=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">))])</span>
</span><span id="LiveStreamDownloader-908"><a href="#LiveStreamDownloader-908"><span class="linenos"> 908</span></a>
</span><span id="LiveStreamDownloader-909"><a href="#LiveStreamDownloader-909"><span class="linenos"> 909</span></a>            <span class="c1"># Add output file to ffmpeg command</span>
</span><span id="LiveStreamDownloader-910"><a href="#LiveStreamDownloader-910"><span class="linenos"> 910</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">base_output</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()))</span>
</span><span id="LiveStreamDownloader-911"><a href="#LiveStreamDownloader-911"><span class="linenos"> 911</span></a>
</span><span id="LiveStreamDownloader-912"><a href="#LiveStreamDownloader-912"><span class="linenos"> 912</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_ffmpeg_command&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-913"><a href="#LiveStreamDownloader-913"><span class="linenos"> 913</span></a>                <span class="n">ffmpeg_command_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.ffmpeg.txt&quot;</span>
</span><span id="LiveStreamDownloader-914"><a href="#LiveStreamDownloader-914"><span class="linenos"> 914</span></a>                <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">][</span><span class="s2">&quot;ffmpeg_cmd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-915"><a href="#LiveStreamDownloader-915"><span class="linenos"> 915</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">write_ffmpeg_command</span><span class="p">(</span><span class="n">ffmpeg_builder</span><span class="p">,</span> <span class="n">ffmpeg_command_file</span><span class="p">),</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;ffmpeg_command&quot;</span>
</span><span id="LiveStreamDownloader-916"><a href="#LiveStreamDownloader-916"><span class="linenos"> 916</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader-917"><a href="#LiveStreamDownloader-917"><span class="linenos"> 917</span></a>
</span><span id="LiveStreamDownloader-918"><a href="#LiveStreamDownloader-918"><span class="linenos"> 918</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;merge&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader-919"><a href="#LiveStreamDownloader-919"><span class="linenos"> 919</span></a>                <span class="k">return</span> <span class="n">file_names</span>
</span><span id="LiveStreamDownloader-920"><a href="#LiveStreamDownloader-920"><span class="linenos"> 920</span></a>
</span><span id="LiveStreamDownloader-921"><a href="#LiveStreamDownloader-921"><span class="linenos"> 921</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FFmpeg command: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ffmpeg_builder</span><span class="p">)))</span>
</span><span id="LiveStreamDownloader-922"><a href="#LiveStreamDownloader-922"><span class="linenos"> 922</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing ffmpeg. Outputting to </span><span class="si">{</span><span class="n">ffmpeg_builder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-923"><a href="#LiveStreamDownloader-923"><span class="linenos"> 923</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-924"><a href="#LiveStreamDownloader-924"><span class="linenos"> 924</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-925"><a href="#LiveStreamDownloader-925"><span class="linenos"> 925</span></a>                    <span class="n">ffmpeg_builder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-926"><a href="#LiveStreamDownloader-926"><span class="linenos"> 926</span></a>                    <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-927"><a href="#LiveStreamDownloader-927"><span class="linenos"> 927</span></a>                    <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-928"><a href="#LiveStreamDownloader-928"><span class="linenos"> 928</span></a>                    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-929"><a href="#LiveStreamDownloader-929"><span class="linenos"> 929</span></a>                    <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-930"><a href="#LiveStreamDownloader-930"><span class="linenos"> 930</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader-931"><a href="#LiveStreamDownloader-931"><span class="linenos"> 931</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FFmpeg STDOUT: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-932"><a href="#LiveStreamDownloader-932"><span class="linenos"> 932</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FFmpeg STDERR: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-933"><a href="#LiveStreamDownloader-933"><span class="linenos"> 933</span></a>            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-934"><a href="#LiveStreamDownloader-934"><span class="linenos"> 934</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-935"><a href="#LiveStreamDownloader-935"><span class="linenos"> 935</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-936"><a href="#LiveStreamDownloader-936"><span class="linenos"> 936</span></a>                <span class="k">raise</span>
</span><span id="LiveStreamDownloader-937"><a href="#LiveStreamDownloader-937"><span class="linenos"> 937</span></a>
</span><span id="LiveStreamDownloader-938"><a href="#LiveStreamDownloader-938"><span class="linenos"> 938</span></a>            <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">][</span><span class="s2">&quot;merged&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">base_output</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-939"><a href="#LiveStreamDownloader-939"><span class="linenos"> 939</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-940"><a href="#LiveStreamDownloader-940"><span class="linenos"> 940</span></a>                <span class="s2">&quot;Successfully merged files into: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="LiveStreamDownloader-941"><a href="#LiveStreamDownloader-941"><span class="linenos"> 941</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-942"><a href="#LiveStreamDownloader-942"><span class="linenos"> 942</span></a>
</span><span id="LiveStreamDownloader-943"><a href="#LiveStreamDownloader-943"><span class="linenos"> 943</span></a>            <span class="c1"># Remove temp video and audio files</span>
</span><span id="LiveStreamDownloader-944"><a href="#LiveStreamDownloader-944"><span class="linenos"> 944</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_ts_files&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader-945"><a href="#LiveStreamDownloader-945"><span class="linenos"> 945</span></a>                <span class="k">if</span> <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-946"><a href="#LiveStreamDownloader-946"><span class="linenos"> 946</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()))</span>
</span><span id="LiveStreamDownloader-947"><a href="#LiveStreamDownloader-947"><span class="linenos"> 947</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-948"><a href="#LiveStreamDownloader-948"><span class="linenos"> 948</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-949"><a href="#LiveStreamDownloader-949"><span class="linenos"> 949</span></a>                <span class="k">if</span> <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-950"><a href="#LiveStreamDownloader-950"><span class="linenos"> 950</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()))</span>
</span><span id="LiveStreamDownloader-951"><a href="#LiveStreamDownloader-951"><span class="linenos"> 951</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-952"><a href="#LiveStreamDownloader-952"><span class="linenos"> 952</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-953"><a href="#LiveStreamDownloader-953"><span class="linenos"> 953</span></a>
</span><span id="LiveStreamDownloader-954"><a href="#LiveStreamDownloader-954"><span class="linenos"> 954</span></a>        <span class="k">return</span> <span class="n">file_names</span>
</span><span id="LiveStreamDownloader-955"><a href="#LiveStreamDownloader-955"><span class="linenos"> 955</span></a>        <span class="c1"># for file in file_names:</span>
</span><span id="LiveStreamDownloader-956"><a href="#LiveStreamDownloader-956"><span class="linenos"> 956</span></a>        <span class="c1">#    os.remove(file)</span>
</span><span id="LiveStreamDownloader-957"><a href="#LiveStreamDownloader-957"><span class="linenos"> 957</span></a>
</span><span id="LiveStreamDownloader-958"><a href="#LiveStreamDownloader-958"><span class="linenos"> 958</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_ffmpeg_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command_array</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-959"><a href="#LiveStreamDownloader-959"><span class="linenos"> 959</span></a>        <span class="c1"># Determine the platform</span>
</span><span id="LiveStreamDownloader-960"><a href="#LiveStreamDownloader-960"><span class="linenos"> 960</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader-961"><a href="#LiveStreamDownloader-961"><span class="linenos"> 961</span></a><span class="sd">        Builds a platform-compatible FFmpeg command with proper quoting.</span>
</span><span id="LiveStreamDownloader-962"><a href="#LiveStreamDownloader-962"><span class="linenos"> 962</span></a>
</span><span id="LiveStreamDownloader-963"><a href="#LiveStreamDownloader-963"><span class="linenos"> 963</span></a><span class="sd">        Args:</span>
</span><span id="LiveStreamDownloader-964"><a href="#LiveStreamDownloader-964"><span class="linenos"> 964</span></a><span class="sd">            command_array (list): List of arguments to append to the command.</span>
</span><span id="LiveStreamDownloader-965"><a href="#LiveStreamDownloader-965"><span class="linenos"> 965</span></a><span class="sd">            filename: Filename to write command to</span>
</span><span id="LiveStreamDownloader-966"><a href="#LiveStreamDownloader-966"><span class="linenos"> 966</span></a>
</span><span id="LiveStreamDownloader-967"><a href="#LiveStreamDownloader-967"><span class="linenos"> 967</span></a><span class="sd">        Returns:</span>
</span><span id="LiveStreamDownloader-968"><a href="#LiveStreamDownloader-968"><span class="linenos"> 968</span></a><span class="sd">            str: A properly quoted FFmpeg command.</span>
</span><span id="LiveStreamDownloader-969"><a href="#LiveStreamDownloader-969"><span class="linenos"> 969</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader-970"><a href="#LiveStreamDownloader-970"><span class="linenos"> 970</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>  <span class="c1"># Windows</span>
</span><span id="LiveStreamDownloader-971"><a href="#LiveStreamDownloader-971"><span class="linenos"> 971</span></a>            <span class="c1"># Handle special quoting and escaping for Windows</span>
</span><span id="LiveStreamDownloader-972"><a href="#LiveStreamDownloader-972"><span class="linenos"> 972</span></a>            <span class="n">quoted_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LiveStreamDownloader-973"><a href="#LiveStreamDownloader-973"><span class="linenos"> 973</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">command_array</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-974"><a href="#LiveStreamDownloader-974"><span class="linenos"> 974</span></a>                <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-975"><a href="#LiveStreamDownloader-975"><span class="linenos"> 975</span></a>                    <span class="c1"># Replace newlines with literal \n</span>
</span><span id="LiveStreamDownloader-976"><a href="#LiveStreamDownloader-976"><span class="linenos"> 976</span></a>                    <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-977"><a href="#LiveStreamDownloader-977"><span class="linenos"> 977</span></a>                <span class="c1"># Escape double quotes and wrap in double quotes if necessary</span>
</span><span id="LiveStreamDownloader-978"><a href="#LiveStreamDownloader-978"><span class="linenos"> 978</span></a>                <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">arg</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader-979"><a href="#LiveStreamDownloader-979"><span class="linenos"> 979</span></a>                    <span class="n">arg</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-980"><a href="#LiveStreamDownloader-980"><span class="linenos"> 980</span></a>                <span class="n">quoted_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-981"><a href="#LiveStreamDownloader-981"><span class="linenos"> 981</span></a>            <span class="n">command_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">quoted_args</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-982"><a href="#LiveStreamDownloader-982"><span class="linenos"> 982</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># POSIX (Linux/macOS)</span>
</span><span id="LiveStreamDownloader-983"><a href="#LiveStreamDownloader-983"><span class="linenos"> 983</span></a>            <span class="c1"># Use shlex.quote for safe quoting</span>
</span><span id="LiveStreamDownloader-984"><a href="#LiveStreamDownloader-984"><span class="linenos"> 984</span></a>            <span class="c1"># quoted_args = [shlex.quote(arg) for arg in arguments]</span>
</span><span id="LiveStreamDownloader-985"><a href="#LiveStreamDownloader-985"><span class="linenos"> 985</span></a>            <span class="n">command_string</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command_array</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-986"><a href="#LiveStreamDownloader-986"><span class="linenos"> 986</span></a>
</span><span id="LiveStreamDownloader-987"><a href="#LiveStreamDownloader-987"><span class="linenos"> 987</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-988"><a href="#LiveStreamDownloader-988"><span class="linenos"> 988</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-989"><a href="#LiveStreamDownloader-989"><span class="linenos"> 989</span></a>
</span><span id="LiveStreamDownloader-990"><a href="#LiveStreamDownloader-990"><span class="linenos"> 990</span></a>        <span class="k">return</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader-991"><a href="#LiveStreamDownloader-991"><span class="linenos"> 991</span></a>
</span><span id="LiveStreamDownloader-992"><a href="#LiveStreamDownloader-992"><span class="linenos"> 992</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-993"><a href="#LiveStreamDownloader-993"><span class="linenos"> 993</span></a>        <span class="c1"># List of units in order</span>
</span><span id="LiveStreamDownloader-994"><a href="#LiveStreamDownloader-994"><span class="linenos"> 994</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">,</span> <span class="s2">&quot;PB&quot;</span><span class="p">,</span> <span class="s2">&quot;EB&quot;</span><span class="p">]</span>
</span><span id="LiveStreamDownloader-995"><a href="#LiveStreamDownloader-995"><span class="linenos"> 995</span></a>
</span><span id="LiveStreamDownloader-996"><a href="#LiveStreamDownloader-996"><span class="linenos"> 996</span></a>        <span class="c1"># Start with bytes and convert to larger units</span>
</span><span id="LiveStreamDownloader-997"><a href="#LiveStreamDownloader-997"><span class="linenos"> 997</span></a>        <span class="n">unit_index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LiveStreamDownloader-998"><a href="#LiveStreamDownloader-998"><span class="linenos"> 998</span></a>        <span class="k">while</span> <span class="nb">bytes</span> <span class="o">&gt;=</span> <span class="mi">1024</span> <span class="ow">and</span> <span class="n">unit_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-999"><a href="#LiveStreamDownloader-999"><span class="linenos"> 999</span></a>            <span class="nb">bytes</span> <span class="o">/=</span> <span class="mi">1024</span>
</span><span id="LiveStreamDownloader-1000"><a href="#LiveStreamDownloader-1000"><span class="linenos">1000</span></a>            <span class="n">unit_index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader-1001"><a href="#LiveStreamDownloader-1001"><span class="linenos">1001</span></a>
</span><span id="LiveStreamDownloader-1002"><a href="#LiveStreamDownloader-1002"><span class="linenos">1002</span></a>        <span class="c1"># Format and return the result</span>
</span><span id="LiveStreamDownloader-1003"><a href="#LiveStreamDownloader-1003"><span class="linenos">1003</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bytes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">units</span><span class="p">[</span><span class="n">unit_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-1004"><a href="#LiveStreamDownloader-1004"><span class="linenos">1004</span></a>
</span><span id="LiveStreamDownloader-1005"><a href="#LiveStreamDownloader-1005"><span class="linenos">1005</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-1006"><a href="#LiveStreamDownloader-1006"><span class="linenos">1006</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stats_as_json&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1007"><a href="#LiveStreamDownloader-1007"><span class="linenos">1007</span></a>            <span class="c1"># \033[K clears the line after printing the JSON</span>
</span><span id="LiveStreamDownloader-1008"><a href="#LiveStreamDownloader-1008"><span class="linenos">1008</span></a>            <span class="k">return</span>
</span><span id="LiveStreamDownloader-1009"><a href="#LiveStreamDownloader-1009"><span class="linenos">1009</span></a>
</span><span id="LiveStreamDownloader-1010"><a href="#LiveStreamDownloader-1010"><span class="linenos">1010</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-1011"><a href="#LiveStreamDownloader-1011"><span class="linenos">1011</span></a>            <span class="k">return</span>
</span><span id="LiveStreamDownloader-1012"><a href="#LiveStreamDownloader-1012"><span class="linenos">1012</span></a>
</span><span id="LiveStreamDownloader-1013"><a href="#LiveStreamDownloader-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader-1014"><a href="#LiveStreamDownloader-1014"><span class="linenos">1014</span></a>            <span class="k">return</span>
</span><span id="LiveStreamDownloader-1015"><a href="#LiveStreamDownloader-1015"><span class="linenos">1015</span></a>
</span><span id="LiveStreamDownloader-1016"><a href="#LiveStreamDownloader-1016"><span class="linenos">1016</span></a>        <span class="c1"># Build the output parts in a list</span>
</span><span id="LiveStreamDownloader-1017"><a href="#LiveStreamDownloader-1017"><span class="linenos">1017</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">]</span>
</span><span id="LiveStreamDownloader-1018"><a href="#LiveStreamDownloader-1018"><span class="linenos">1018</span></a>
</span><span id="LiveStreamDownloader-1019"><a href="#LiveStreamDownloader-1019"><span class="linenos">1019</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1020"><a href="#LiveStreamDownloader-1020"><span class="linenos">1020</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="LiveStreamDownloader-1021"><a href="#LiveStreamDownloader-1021"><span class="linenos">1021</span></a>            <span class="n">v_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Video: </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;downloaded_segments&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;latest_sequence&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-1022"><a href="#LiveStreamDownloader-1022"><span class="linenos">1022</span></a>            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1023"><a href="#LiveStreamDownloader-1023"><span class="linenos">1023</span></a>                <span class="n">v_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LiveStreamDownloader-1024"><a href="#LiveStreamDownloader-1024"><span class="linenos">1024</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_str</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1025"><a href="#LiveStreamDownloader-1025"><span class="linenos">1025</span></a>
</span><span id="LiveStreamDownloader-1026"><a href="#LiveStreamDownloader-1026"><span class="linenos">1026</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1027"><a href="#LiveStreamDownloader-1027"><span class="linenos">1027</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="LiveStreamDownloader-1028"><a href="#LiveStreamDownloader-1028"><span class="linenos">1028</span></a>            <span class="n">a_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Audio: </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;downloaded_segments&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;latest_sequence&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader-1029"><a href="#LiveStreamDownloader-1029"><span class="linenos">1029</span></a>            <span class="c1"># Note: Fixed a likely typo in your original code where you checked</span>
</span><span id="LiveStreamDownloader-1030"><a href="#LiveStreamDownloader-1030"><span class="linenos">1030</span></a>            <span class="c1"># video status while printing audio stats</span>
</span><span id="LiveStreamDownloader-1031"><a href="#LiveStreamDownloader-1031"><span class="linenos">1031</span></a>            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1032"><a href="#LiveStreamDownloader-1032"><span class="linenos">1032</span></a>                <span class="n">a_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LiveStreamDownloader-1033"><a href="#LiveStreamDownloader-1033"><span class="linenos">1033</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_str</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1034"><a href="#LiveStreamDownloader-1034"><span class="linenos">1034</span></a>
</span><span id="LiveStreamDownloader-1035"><a href="#LiveStreamDownloader-1035"><span class="linenos">1035</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_filesize&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_filesize&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1036"><a href="#LiveStreamDownloader-1036"><span class="linenos">1036</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_filesize&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-1037"><a href="#LiveStreamDownloader-1037"><span class="linenos">1037</span></a>                <span class="s2">&quot;current_filesize&quot;</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="LiveStreamDownloader-1038"><a href="#LiveStreamDownloader-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-1039"><a href="#LiveStreamDownloader-1039"><span class="linenos">1039</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;~</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="si">}</span><span class="s2"> downloaded&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1040"><a href="#LiveStreamDownloader-1040"><span class="linenos">1040</span></a>
</span><span id="LiveStreamDownloader-1041"><a href="#LiveStreamDownloader-1041"><span class="linenos">1041</span></a>        <span class="c1"># Join everything with commas or spaces</span>
</span><span id="LiveStreamDownloader-1042"><a href="#LiveStreamDownloader-1042"><span class="linenos">1042</span></a>        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1043"><a href="#LiveStreamDownloader-1043"><span class="linenos">1043</span></a>
</span><span id="LiveStreamDownloader-1044"><a href="#LiveStreamDownloader-1044"><span class="linenos">1044</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_line&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1045"><a href="#LiveStreamDownloader-1045"><span class="linenos">1045</span></a>            <span class="k">pass</span>
</span><span id="LiveStreamDownloader-1046"><a href="#LiveStreamDownloader-1046"><span class="linenos">1046</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-1047"><a href="#LiveStreamDownloader-1047"><span class="linenos">1047</span></a>            <span class="c1"># \r moves to start, \033[K clears anything left over from the previous longer line</span>
</span><span id="LiveStreamDownloader-1048"><a href="#LiveStreamDownloader-1048"><span class="linenos">1048</span></a>            <span class="k">pass</span>
</span><span id="LiveStreamDownloader-1049"><a href="#LiveStreamDownloader-1049"><span class="linenos">1049</span></a>
</span><span id="LiveStreamDownloader-1050"><a href="#LiveStreamDownloader-1050"><span class="linenos">1050</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_url_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-1051"><a href="#LiveStreamDownloader-1051"><span class="linenos">1051</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1052"><a href="#LiveStreamDownloader-1052"><span class="linenos">1052</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1053"><a href="#LiveStreamDownloader-1053"><span class="linenos">1053</span></a>        <span class="n">query</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>  <span class="c1"># add or replace parameter</span>
</span><span id="LiveStreamDownloader-1054"><a href="#LiveStreamDownloader-1054"><span class="linenos">1054</span></a>
</span><span id="LiveStreamDownloader-1055"><a href="#LiveStreamDownloader-1055"><span class="linenos">1055</span></a>        <span class="n">new_query</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1056"><a href="#LiveStreamDownloader-1056"><span class="linenos">1056</span></a>        <span class="n">new_url</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">new_query</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1057"><a href="#LiveStreamDownloader-1057"><span class="linenos">1057</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">urlunparse</span><span class="p">(</span><span class="n">new_url</span><span class="p">))</span>
</span><span id="LiveStreamDownloader-1058"><a href="#LiveStreamDownloader-1058"><span class="linenos">1058</span></a>
</span><span id="LiveStreamDownloader-1059"><a href="#LiveStreamDownloader-1059"><span class="linenos">1059</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">trim_info_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">keys_to_keep</span><span class="p">:</span> <span class="nb">set</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1060"><a href="#LiveStreamDownloader-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">info_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">keys_to_keep</span><span class="p">}</span>
</span><span id="LiveStreamDownloader-1061"><a href="#LiveStreamDownloader-1061"><span class="linenos">1061</span></a>
</span><span id="LiveStreamDownloader-1062"><a href="#LiveStreamDownloader-1062"><span class="linenos">1062</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_format_segment_playlist_from_info_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-1063"><a href="#LiveStreamDownloader-1063"><span class="linenos">1063</span></a>        <span class="k">for</span> <span class="n">stream_format</span> <span class="ow">in</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;formats&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="LiveStreamDownloader-1064"><a href="#LiveStreamDownloader-1064"><span class="linenos">1064</span></a>            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="LiveStreamDownloader-1065"><a href="#LiveStreamDownloader-1065"><span class="linenos">1065</span></a>                <span class="n">stream_format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fragments&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1066"><a href="#LiveStreamDownloader-1066"><span class="linenos">1066</span></a>
</span><span id="LiveStreamDownloader-1067"><a href="#LiveStreamDownloader-1067"><span class="linenos">1067</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_info_json</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-1068"><a href="#LiveStreamDownloader-1068"><span class="linenos">1068</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1069"><a href="#LiveStreamDownloader-1069"><span class="linenos">1069</span></a>        <span class="n">update_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1070"><a href="#LiveStreamDownloader-1070"><span class="linenos">1070</span></a>        <span class="n">video_id</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1071"><a href="#LiveStreamDownloader-1071"><span class="linenos">1071</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1072"><a href="#LiveStreamDownloader-1072"><span class="linenos">1072</span></a>        <span class="n">additional_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1073"><a href="#LiveStreamDownloader-1073"><span class="linenos">1073</span></a>        <span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1074"><a href="#LiveStreamDownloader-1074"><span class="linenos">1074</span></a>        <span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1075"><a href="#LiveStreamDownloader-1075"><span class="linenos">1075</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader-1076"><a href="#LiveStreamDownloader-1076"><span class="linenos">1076</span></a>        <span class="c1"># Check if time difference is greater than the threshold. If doesn&#39;t exist, subtraction of zero will always be true</span>
</span><span id="LiveStreamDownloader-1077"><a href="#LiveStreamDownloader-1077"><span class="linenos">1077</span></a>        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;refresh_time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">update_threshold</span><span class="p">:</span>
</span><span id="LiveStreamDownloader-1078"><a href="#LiveStreamDownloader-1078"><span class="linenos">1078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span> <span class="o">=</span> <span class="n">get_video_info</span><span class="p">(</span>
</span><span id="LiveStreamDownloader-1079"><a href="#LiveStreamDownloader-1079"><span class="linenos">1079</span></a>                <span class="n">video_id</span><span class="o">=</span><span class="n">video_id</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1080"><a href="#LiveStreamDownloader-1080"><span class="linenos">1080</span></a>                <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1081"><a href="#LiveStreamDownloader-1081"><span class="linenos">1081</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1082"><a href="#LiveStreamDownloader-1082"><span class="linenos">1082</span></a>                <span class="n">additional_options</span><span class="o">=</span><span class="n">additional_options</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1083"><a href="#LiveStreamDownloader-1083"><span class="linenos">1083</span></a>                <span class="n">include_dash</span><span class="o">=</span><span class="n">include_dash</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1084"><a href="#LiveStreamDownloader-1084"><span class="linenos">1084</span></a>                <span class="n">include_m3u8</span><span class="o">=</span><span class="n">include_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1085"><a href="#LiveStreamDownloader-1085"><span class="linenos">1085</span></a>                <span class="n">clean_info_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader-1086"><a href="#LiveStreamDownloader-1086"><span class="linenos">1086</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader-1087"><a href="#LiveStreamDownloader-1087"><span class="linenos">1087</span></a>
</span><span id="LiveStreamDownloader-1088"><a href="#LiveStreamDownloader-1088"><span class="linenos">1088</span></a>            <span class="c1"># Remove unnecessary items for info.json used purely for url refresh</span>
</span><span id="LiveStreamDownloader-1089"><a href="#LiveStreamDownloader-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_format_segment_playlist_from_info_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1090"><a href="#LiveStreamDownloader-1090"><span class="linenos">1090</span></a>
</span><span id="LiveStreamDownloader-1091"><a href="#LiveStreamDownloader-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1092"><a href="#LiveStreamDownloader-1092"><span class="linenos">1092</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1093"><a href="#LiveStreamDownloader-1093"><span class="linenos">1093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader-1094"><a href="#LiveStreamDownloader-1094"><span class="linenos">1094</span></a>
</span><span id="LiveStreamDownloader-1095"><a href="#LiveStreamDownloader-1095"><span class="linenos">1095</span></a>            <span class="c1"># Add refresh time for reference</span>
</span><span id="LiveStreamDownloader-1096"><a href="#LiveStreamDownloader-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">[</span><span class="s2">&quot;refresh_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="LiveStreamDownloader-1097"><a href="#LiveStreamDownloader-1097"><span class="linenos">1097</span></a>
</span><span id="LiveStreamDownloader-1098"><a href="#LiveStreamDownloader-1098"><span class="linenos">1098</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span>
</span><span id="LiveStreamDownloader-1099"><a href="#LiveStreamDownloader-1099"><span class="linenos">1099</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span>
</span></pre></div>


    

                            <div id="LiveStreamDownloader.__init__" class="classattr">
                                        <input id="LiveStreamDownloader.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">LiveStreamDownloader</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">kill_all</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="n">at</span> <span class="mh">0x7fcd7685e210</span><span class="p">:</span> <span class="n">unset</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">cleanup</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="n">at</span> <span class="mh">0x7fcd7685e990</span><span class="p">:</span> <span class="n">unset</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">kill_this</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="LiveStreamDownloader.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.__init__-40"><a href="#LiveStreamDownloader.__init__-40"><span class="linenos">40</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.__init__-41"><a href="#LiveStreamDownloader.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.__init__-42"><a href="#LiveStreamDownloader.__init__-42"><span class="linenos">42</span></a>        <span class="n">kill_all</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
</span><span id="LiveStreamDownloader.__init__-43"><a href="#LiveStreamDownloader.__init__-43"><span class="linenos">43</span></a>        <span class="n">cleanup</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">(),</span>
</span><span id="LiveStreamDownloader.__init__-44"><a href="#LiveStreamDownloader.__init__-44"><span class="linenos">44</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.__init__-45"><a href="#LiveStreamDownloader.__init__-45"><span class="linenos">45</span></a>        <span class="n">kill_this</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.__init__-46"><a href="#LiveStreamDownloader.__init__-46"><span class="linenos">46</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.__init__-47"><a href="#LiveStreamDownloader.__init__-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.__init__-48"><a href="#LiveStreamDownloader.__init__-48"><span class="linenos">48</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="LiveStreamDownloader.__init__-49"><a href="#LiveStreamDownloader.__init__-49"><span class="linenos">49</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.__init__-50"><a href="#LiveStreamDownloader.__init__-50"><span class="linenos">50</span></a>            <span class="c1"># 1. Create a Named Logger instance and assign it to self.logger</span>
</span><span id="LiveStreamDownloader.__init__-51"><a href="#LiveStreamDownloader.__init__-51"><span class="linenos">51</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.__init__-52"><a href="#LiveStreamDownloader.__init__-52"><span class="linenos">52</span></a>            <span class="c1"># Ensure it processes messages (important if you don&#39;t call setup_logging immediately)</span>
</span><span id="LiveStreamDownloader.__init__-53"><a href="#LiveStreamDownloader.__init__-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.__init__-54"><a href="#LiveStreamDownloader.__init__-54"><span class="linenos">54</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="LiveStreamDownloader.__init__-55"><a href="#LiveStreamDownloader.__init__-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span> <span class="o">=</span> <span class="n">kill_this</span> <span class="ow">or</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.__init__-56"><a href="#LiveStreamDownloader.__init__-56"><span class="linenos">56</span></a>
</span><span id="LiveStreamDownloader.__init__-57"><a href="#LiveStreamDownloader.__init__-57"><span class="linenos">57</span></a>        <span class="c1"># Global state converted to instance attributes</span>
</span><span id="LiveStreamDownloader.__init__-58"><a href="#LiveStreamDownloader.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span> <span class="o">=</span> <span class="n">kill_all</span>
</span><span id="LiveStreamDownloader.__init__-59"><a href="#LiveStreamDownloader.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">cleanup</span>
</span><span id="LiveStreamDownloader.__init__-60"><a href="#LiveStreamDownloader.__init__-60"><span class="linenos">60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live_chat_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.__init__-61"><a href="#LiveStreamDownloader.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chat_timeout</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.__init__-62"><a href="#LiveStreamDownloader.__init__-62"><span class="linenos">62</span></a>        <span class="c1"># File name dictionary</span>
</span><span id="LiveStreamDownloader.__init__-63"><a href="#LiveStreamDownloader.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;streams&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="LiveStreamDownloader.__init__-64"><a href="#LiveStreamDownloader.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader.__init__-65"><a href="#LiveStreamDownloader.__init__-65"><span class="linenos">65</span></a>
</span><span id="LiveStreamDownloader.__init__-66"><a href="#LiveStreamDownloader.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader.__init__-67"><a href="#LiveStreamDownloader.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="LiveStreamDownloader.__init__-68"><a href="#LiveStreamDownloader.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.kill_this" class="classattr">
                                <div class="attr variable">
            <span class="name">kill_this</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.kill_this"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.kill_all" class="classattr">
                                <div class="attr variable">
            <span class="name">kill_all</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.kill_all"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.cleanup" class="classattr">
                                <div class="attr variable">
            <span class="name">cleanup</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.cleanup"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.live_chat_result" class="classattr">
                                <div class="attr variable">
            <span class="name">live_chat_result</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.live_chat_result"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.chat_timeout" class="classattr">
                                <div class="attr variable">
            <span class="name">chat_timeout</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.chat_timeout"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.file_names" class="classattr">
                                <div class="attr variable">
            <span class="name">file_names</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.file_names"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.stats" class="classattr">
                                <div class="attr variable">
            <span class="name">stats</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.stats"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.refresh_json" class="classattr">
                                <div class="attr variable">
            <span class="name">refresh_json</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.refresh_json"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.live_status" class="classattr">
                                <div class="attr variable">
            <span class="name">live_status</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.live_status"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.lock" class="classattr">
                                <div class="attr variable">
            <span class="name">lock</span><span class="annotation">: _thread.lock</span>

        
    </div>
    <a class="headerlink" href="#LiveStreamDownloader.lock"></a>
    
    

                            </div>
                            <div id="LiveStreamDownloader.download_stream" class="classattr">
                                        <input id="LiveStreamDownloader.download_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">info_dict</span>,</span><span class="param">	<span class="n">resolution</span>,</span><span class="param">	<span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">folder</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">file_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">keep_database</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">cookies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">retries</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">proxies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">force_m3u8</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">manifest</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.download_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.download_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.download_stream-71"><a href="#LiveStreamDownloader.download_stream-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_stream</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_stream-72"><a href="#LiveStreamDownloader.download_stream-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-73"><a href="#LiveStreamDownloader.download_stream-73"><span class="linenos"> 73</span></a>        <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-74"><a href="#LiveStreamDownloader.download_stream-74"><span class="linenos"> 74</span></a>        <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-75"><a href="#LiveStreamDownloader.download_stream-75"><span class="linenos"> 75</span></a>        <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-76"><a href="#LiveStreamDownloader.download_stream-76"><span class="linenos"> 76</span></a>        <span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-77"><a href="#LiveStreamDownloader.download_stream-77"><span class="linenos"> 77</span></a>        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-78"><a href="#LiveStreamDownloader.download_stream-78"><span class="linenos"> 78</span></a>        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-79"><a href="#LiveStreamDownloader.download_stream-79"><span class="linenos"> 79</span></a>        <span class="n">keep_database</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-80"><a href="#LiveStreamDownloader.download_stream-80"><span class="linenos"> 80</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-81"><a href="#LiveStreamDownloader.download_stream-81"><span class="linenos"> 81</span></a>        <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-82"><a href="#LiveStreamDownloader.download_stream-82"><span class="linenos"> 82</span></a>        <span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-83"><a href="#LiveStreamDownloader.download_stream-83"><span class="linenos"> 83</span></a>        <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-84"><a href="#LiveStreamDownloader.download_stream-84"><span class="linenos"> 84</span></a>        <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-85"><a href="#LiveStreamDownloader.download_stream-85"><span class="linenos"> 85</span></a>        <span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-86"><a href="#LiveStreamDownloader.download_stream-86"><span class="linenos"> 86</span></a>        <span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-87"><a href="#LiveStreamDownloader.download_stream-87"><span class="linenos"> 87</span></a>        <span class="n">force_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-88"><a href="#LiveStreamDownloader.download_stream-88"><span class="linenos"> 88</span></a>        <span class="n">manifest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-89"><a href="#LiveStreamDownloader.download_stream-89"><span class="linenos"> 89</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-90"><a href="#LiveStreamDownloader.download_stream-90"><span class="linenos"> 90</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader.download_stream-91"><a href="#LiveStreamDownloader.download_stream-91"><span class="linenos"> 91</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream-92"><a href="#LiveStreamDownloader.download_stream-92"><span class="linenos"> 92</span></a>            <span class="n">download_params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_stream-93"><a href="#LiveStreamDownloader.download_stream-93"><span class="linenos"> 93</span></a>            <span class="n">download_params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;download_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream</span><span class="p">})</span>
</span><span id="LiveStreamDownloader.download_stream-94"><a href="#LiveStreamDownloader.download_stream-94"><span class="linenos"> 94</span></a>            <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_stream-95"><a href="#LiveStreamDownloader.download_stream-95"><span class="linenos"> 95</span></a>            <span class="n">filetype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_stream-96"><a href="#LiveStreamDownloader.download_stream-96"><span class="linenos"> 96</span></a>
</span><span id="LiveStreamDownloader.download_stream-97"><a href="#LiveStreamDownloader.download_stream-97"><span class="linenos"> 97</span></a>            <span class="k">with</span> <span class="n">DownloadStream</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_stream-98"><a href="#LiveStreamDownloader.download_stream-98"><span class="linenos"> 98</span></a>                <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-99"><a href="#LiveStreamDownloader.download_stream-99"><span class="linenos"> 99</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-100"><a href="#LiveStreamDownloader.download_stream-100"><span class="linenos">100</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-101"><a href="#LiveStreamDownloader.download_stream-101"><span class="linenos">101</span></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-102"><a href="#LiveStreamDownloader.download_stream-102"><span class="linenos">102</span></a>                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-103"><a href="#LiveStreamDownloader.download_stream-103"><span class="linenos">103</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-104"><a href="#LiveStreamDownloader.download_stream-104"><span class="linenos">104</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-105"><a href="#LiveStreamDownloader.download_stream-105"><span class="linenos">105</span></a>                <span class="n">fragment_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-106"><a href="#LiveStreamDownloader.download_stream-106"><span class="linenos">106</span></a>                <span class="n">yt_dlp_options</span><span class="o">=</span><span class="n">yt_dlp_options</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-107"><a href="#LiveStreamDownloader.download_stream-107"><span class="linenos">107</span></a>                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-108"><a href="#LiveStreamDownloader.download_stream-108"><span class="linenos">108</span></a>                <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="n">yt_dlp_sort</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-109"><a href="#LiveStreamDownloader.download_stream-109"><span class="linenos">109</span></a>                <span class="n">include_dash</span><span class="o">=</span><span class="n">include_dash</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-110"><a href="#LiveStreamDownloader.download_stream-110"><span class="linenos">110</span></a>                <span class="n">include_m3u8</span><span class="o">=</span><span class="n">include_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-111"><a href="#LiveStreamDownloader.download_stream-111"><span class="linenos">111</span></a>                <span class="n">force_m3u8</span><span class="o">=</span><span class="n">force_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-112"><a href="#LiveStreamDownloader.download_stream-112"><span class="linenos">112</span></a>                <span class="n">download_params</span><span class="o">=</span><span class="n">download_params</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-113"><a href="#LiveStreamDownloader.download_stream-113"><span class="linenos">113</span></a>                <span class="n">livestream_coordinator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-114"><a href="#LiveStreamDownloader.download_stream-114"><span class="linenos">114</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream-115"><a href="#LiveStreamDownloader.download_stream-115"><span class="linenos">115</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">downloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream-116"><a href="#LiveStreamDownloader.download_stream-116"><span class="linenos">116</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Recording&quot;</span>
</span><span id="LiveStreamDownloader.download_stream-117"><a href="#LiveStreamDownloader.download_stream-117"><span class="linenos">117</span></a>                <span class="n">downloader</span><span class="o">.</span><span class="n">live_dl</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_stream-118"><a href="#LiveStreamDownloader.download_stream-118"><span class="linenos">118</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">combine_segments_to_file</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">merged_file_name</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream-119"><a href="#LiveStreamDownloader.download_stream-119"><span class="linenos">119</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_database</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream-120"><a href="#LiveStreamDownloader.download_stream-120"><span class="linenos">120</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging to ts complete, removing </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream-121"><a href="#LiveStreamDownloader.download_stream-121"><span class="linenos">121</span></a>                    <span class="n">downloader</span><span class="o">.</span><span class="n">delete_temp_database</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_stream-122"><a href="#LiveStreamDownloader.download_stream-122"><span class="linenos">122</span></a>                <span class="k">elif</span> <span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream-123"><a href="#LiveStreamDownloader.download_stream-123"><span class="linenos">123</span></a>                    <span class="n">database_file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream-124"><a href="#LiveStreamDownloader.download_stream-124"><span class="linenos">124</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream-125"><a href="#LiveStreamDownloader.download_stream-125"><span class="linenos">125</span></a>
</span><span id="LiveStreamDownloader.download_stream-126"><a href="#LiveStreamDownloader.download_stream-126"><span class="linenos">126</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream-127"><a href="#LiveStreamDownloader.download_stream-127"><span class="linenos">127</span></a>                <span class="n">filetype</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">type</span>
</span><span id="LiveStreamDownloader.download_stream-128"><a href="#LiveStreamDownloader.download_stream-128"><span class="linenos">128</span></a>
</span><span id="LiveStreamDownloader.download_stream-129"><a href="#LiveStreamDownloader.download_stream-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">file</span><span class="p">})</span>
</span><span id="LiveStreamDownloader.download_stream-130"><a href="#LiveStreamDownloader.download_stream-130"><span class="linenos">130</span></a>
</span><span id="LiveStreamDownloader.download_stream-131"><a href="#LiveStreamDownloader.download_stream-131"><span class="linenos">131</span></a>            <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">filetype</span>
</span><span id="LiveStreamDownloader.download_stream-132"><a href="#LiveStreamDownloader.download_stream-132"><span class="linenos">132</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream-133"><a href="#LiveStreamDownloader.download_stream-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error occurred while downloading stream&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream-134"><a href="#LiveStreamDownloader.download_stream-134"><span class="linenos">134</span></a>            <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.download_stream_direct" class="classattr">
                                        <input id="LiveStreamDownloader.download_stream_direct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_stream_direct</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">info_dict</span>,</span><span class="param">	<span class="n">resolution</span>,</span><span class="param">	<span class="n">batch_size</span>,</span><span class="param">	<span class="n">max_workers</span>,</span><span class="param">	<span class="n">folder</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">file_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">keep_state</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">cookies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">retries</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">proxies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">force_m3u8</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">manifest</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.download_stream_direct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.download_stream_direct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.download_stream_direct-137"><a href="#LiveStreamDownloader.download_stream_direct-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_stream_direct</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_stream_direct-138"><a href="#LiveStreamDownloader.download_stream_direct-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-139"><a href="#LiveStreamDownloader.download_stream_direct-139"><span class="linenos">139</span></a>        <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-140"><a href="#LiveStreamDownloader.download_stream_direct-140"><span class="linenos">140</span></a>        <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-141"><a href="#LiveStreamDownloader.download_stream_direct-141"><span class="linenos">141</span></a>        <span class="n">batch_size</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-142"><a href="#LiveStreamDownloader.download_stream_direct-142"><span class="linenos">142</span></a>        <span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-143"><a href="#LiveStreamDownloader.download_stream_direct-143"><span class="linenos">143</span></a>        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-144"><a href="#LiveStreamDownloader.download_stream_direct-144"><span class="linenos">144</span></a>        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-145"><a href="#LiveStreamDownloader.download_stream_direct-145"><span class="linenos">145</span></a>        <span class="n">keep_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-146"><a href="#LiveStreamDownloader.download_stream_direct-146"><span class="linenos">146</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-147"><a href="#LiveStreamDownloader.download_stream_direct-147"><span class="linenos">147</span></a>        <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-148"><a href="#LiveStreamDownloader.download_stream_direct-148"><span class="linenos">148</span></a>        <span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-149"><a href="#LiveStreamDownloader.download_stream_direct-149"><span class="linenos">149</span></a>        <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-150"><a href="#LiveStreamDownloader.download_stream_direct-150"><span class="linenos">150</span></a>        <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-151"><a href="#LiveStreamDownloader.download_stream_direct-151"><span class="linenos">151</span></a>        <span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-152"><a href="#LiveStreamDownloader.download_stream_direct-152"><span class="linenos">152</span></a>        <span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-153"><a href="#LiveStreamDownloader.download_stream_direct-153"><span class="linenos">153</span></a>        <span class="n">force_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-154"><a href="#LiveStreamDownloader.download_stream_direct-154"><span class="linenos">154</span></a>        <span class="n">manifest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-155"><a href="#LiveStreamDownloader.download_stream_direct-155"><span class="linenos">155</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-156"><a href="#LiveStreamDownloader.download_stream_direct-156"><span class="linenos">156</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader.download_stream_direct-157"><a href="#LiveStreamDownloader.download_stream_direct-157"><span class="linenos">157</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream_direct-158"><a href="#LiveStreamDownloader.download_stream_direct-158"><span class="linenos">158</span></a>            <span class="n">download_params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_stream_direct-159"><a href="#LiveStreamDownloader.download_stream_direct-159"><span class="linenos">159</span></a>            <span class="n">download_params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;download_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream_direct</span><span class="p">})</span>
</span><span id="LiveStreamDownloader.download_stream_direct-160"><a href="#LiveStreamDownloader.download_stream_direct-160"><span class="linenos">160</span></a>            <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_stream_direct-161"><a href="#LiveStreamDownloader.download_stream_direct-161"><span class="linenos">161</span></a>            <span class="n">filetype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_stream_direct-162"><a href="#LiveStreamDownloader.download_stream_direct-162"><span class="linenos">162</span></a>
</span><span id="LiveStreamDownloader.download_stream_direct-163"><a href="#LiveStreamDownloader.download_stream_direct-163"><span class="linenos">163</span></a>            <span class="k">with</span> <span class="n">DownloadStreamDirect</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_stream_direct-164"><a href="#LiveStreamDownloader.download_stream_direct-164"><span class="linenos">164</span></a>                <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-165"><a href="#LiveStreamDownloader.download_stream_direct-165"><span class="linenos">165</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-166"><a href="#LiveStreamDownloader.download_stream_direct-166"><span class="linenos">166</span></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-167"><a href="#LiveStreamDownloader.download_stream_direct-167"><span class="linenos">167</span></a>                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-168"><a href="#LiveStreamDownloader.download_stream_direct-168"><span class="linenos">168</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-169"><a href="#LiveStreamDownloader.download_stream_direct-169"><span class="linenos">169</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-170"><a href="#LiveStreamDownloader.download_stream_direct-170"><span class="linenos">170</span></a>                <span class="n">fragment_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-171"><a href="#LiveStreamDownloader.download_stream_direct-171"><span class="linenos">171</span></a>                <span class="n">yt_dlp_options</span><span class="o">=</span><span class="n">yt_dlp_options</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-172"><a href="#LiveStreamDownloader.download_stream_direct-172"><span class="linenos">172</span></a>                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-173"><a href="#LiveStreamDownloader.download_stream_direct-173"><span class="linenos">173</span></a>                <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="n">yt_dlp_sort</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-174"><a href="#LiveStreamDownloader.download_stream_direct-174"><span class="linenos">174</span></a>                <span class="n">include_dash</span><span class="o">=</span><span class="n">include_dash</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-175"><a href="#LiveStreamDownloader.download_stream_direct-175"><span class="linenos">175</span></a>                <span class="n">include_m3u8</span><span class="o">=</span><span class="n">include_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-176"><a href="#LiveStreamDownloader.download_stream_direct-176"><span class="linenos">176</span></a>                <span class="n">force_m3u8</span><span class="o">=</span><span class="n">force_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-177"><a href="#LiveStreamDownloader.download_stream_direct-177"><span class="linenos">177</span></a>                <span class="n">download_params</span><span class="o">=</span><span class="n">download_params</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-178"><a href="#LiveStreamDownloader.download_stream_direct-178"><span class="linenos">178</span></a>                <span class="n">livestream_coordinator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-179"><a href="#LiveStreamDownloader.download_stream_direct-179"><span class="linenos">179</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_stream_direct-180"><a href="#LiveStreamDownloader.download_stream_direct-180"><span class="linenos">180</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">downloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream_direct-181"><a href="#LiveStreamDownloader.download_stream_direct-181"><span class="linenos">181</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Recording&quot;</span>
</span><span id="LiveStreamDownloader.download_stream_direct-182"><a href="#LiveStreamDownloader.download_stream_direct-182"><span class="linenos">182</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">live_dl</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_stream_direct-183"><a href="#LiveStreamDownloader.download_stream_direct-183"><span class="linenos">183</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream_direct-184"><a href="#LiveStreamDownloader.download_stream_direct-184"><span class="linenos">184</span></a>                <span class="n">filetype</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">type</span>
</span><span id="LiveStreamDownloader.download_stream_direct-185"><a href="#LiveStreamDownloader.download_stream_direct-185"><span class="linenos">185</span></a>                <span class="n">downloader</span><span class="o">.</span><span class="n">delete_state_file</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_stream_direct-186"><a href="#LiveStreamDownloader.download_stream_direct-186"><span class="linenos">186</span></a>
</span><span id="LiveStreamDownloader.download_stream_direct-187"><a href="#LiveStreamDownloader.download_stream_direct-187"><span class="linenos">187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">file</span><span class="p">})</span>
</span><span id="LiveStreamDownloader.download_stream_direct-188"><a href="#LiveStreamDownloader.download_stream_direct-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">filetype</span>
</span><span id="LiveStreamDownloader.download_stream_direct-189"><a href="#LiveStreamDownloader.download_stream_direct-189"><span class="linenos">189</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_stream_direct-190"><a href="#LiveStreamDownloader.download_stream_direct-190"><span class="linenos">190</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error occurred while downloading stream&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_stream_direct-191"><a href="#LiveStreamDownloader.download_stream_direct-191"><span class="linenos">191</span></a>            <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.recover_stream" class="classattr">
                                        <input id="LiveStreamDownloader.recover_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recover_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">info_dict</span>,</span><span class="param">	<span class="n">resolution</span>,</span><span class="param">	<span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">folder</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">file_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">keep_database</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">cookies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">retries</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">proxies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">force_merge</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">recovery_failure_tolerance</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">manifest</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">stream_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">no_merge</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.recover_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.recover_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.recover_stream-193"><a href="#LiveStreamDownloader.recover_stream-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">recover_stream</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.recover_stream-194"><a href="#LiveStreamDownloader.recover_stream-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-195"><a href="#LiveStreamDownloader.recover_stream-195"><span class="linenos">195</span></a>        <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-196"><a href="#LiveStreamDownloader.recover_stream-196"><span class="linenos">196</span></a>        <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-197"><a href="#LiveStreamDownloader.recover_stream-197"><span class="linenos">197</span></a>        <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-198"><a href="#LiveStreamDownloader.recover_stream-198"><span class="linenos">198</span></a>        <span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-199"><a href="#LiveStreamDownloader.recover_stream-199"><span class="linenos">199</span></a>        <span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-200"><a href="#LiveStreamDownloader.recover_stream-200"><span class="linenos">200</span></a>        <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-201"><a href="#LiveStreamDownloader.recover_stream-201"><span class="linenos">201</span></a>        <span class="n">keep_database</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-202"><a href="#LiveStreamDownloader.recover_stream-202"><span class="linenos">202</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-203"><a href="#LiveStreamDownloader.recover_stream-203"><span class="linenos">203</span></a>        <span class="n">retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-204"><a href="#LiveStreamDownloader.recover_stream-204"><span class="linenos">204</span></a>        <span class="n">yt_dlp_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-205"><a href="#LiveStreamDownloader.recover_stream-205"><span class="linenos">205</span></a>        <span class="n">proxies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-206"><a href="#LiveStreamDownloader.recover_stream-206"><span class="linenos">206</span></a>        <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-207"><a href="#LiveStreamDownloader.recover_stream-207"><span class="linenos">207</span></a>        <span class="n">force_merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-208"><a href="#LiveStreamDownloader.recover_stream-208"><span class="linenos">208</span></a>        <span class="n">recovery_failure_tolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-209"><a href="#LiveStreamDownloader.recover_stream-209"><span class="linenos">209</span></a>        <span class="n">manifest</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-210"><a href="#LiveStreamDownloader.recover_stream-210"><span class="linenos">210</span></a>        <span class="n">stream_urls</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-211"><a href="#LiveStreamDownloader.recover_stream-211"><span class="linenos">211</span></a>        <span class="n">no_merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-212"><a href="#LiveStreamDownloader.recover_stream-212"><span class="linenos">212</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-213"><a href="#LiveStreamDownloader.recover_stream-213"><span class="linenos">213</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader.recover_stream-214"><a href="#LiveStreamDownloader.recover_stream-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="n">stream_urls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-215"><a href="#LiveStreamDownloader.recover_stream-215"><span class="linenos">215</span></a>            <span class="n">stream_urls</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LiveStreamDownloader.recover_stream-216"><a href="#LiveStreamDownloader.recover_stream-216"><span class="linenos">216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-217"><a href="#LiveStreamDownloader.recover_stream-217"><span class="linenos">217</span></a>            <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.recover_stream-218"><a href="#LiveStreamDownloader.recover_stream-218"><span class="linenos">218</span></a>            <span class="n">filetype</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.recover_stream-219"><a href="#LiveStreamDownloader.recover_stream-219"><span class="linenos">219</span></a>
</span><span id="LiveStreamDownloader.recover_stream-220"><a href="#LiveStreamDownloader.recover_stream-220"><span class="linenos">220</span></a>            <span class="k">with</span> <span class="n">StreamRecovery</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.recover_stream-221"><a href="#LiveStreamDownloader.recover_stream-221"><span class="linenos">221</span></a>                <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-222"><a href="#LiveStreamDownloader.recover_stream-222"><span class="linenos">222</span></a>                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-223"><a href="#LiveStreamDownloader.recover_stream-223"><span class="linenos">223</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-224"><a href="#LiveStreamDownloader.recover_stream-224"><span class="linenos">224</span></a>                <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-225"><a href="#LiveStreamDownloader.recover_stream-225"><span class="linenos">225</span></a>                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-226"><a href="#LiveStreamDownloader.recover_stream-226"><span class="linenos">226</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-227"><a href="#LiveStreamDownloader.recover_stream-227"><span class="linenos">227</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-228"><a href="#LiveStreamDownloader.recover_stream-228"><span class="linenos">228</span></a>                <span class="n">fragment_retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-229"><a href="#LiveStreamDownloader.recover_stream-229"><span class="linenos">229</span></a>                <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-230"><a href="#LiveStreamDownloader.recover_stream-230"><span class="linenos">230</span></a>                <span class="n">yt_dlp_sort</span><span class="o">=</span><span class="n">yt_dlp_sort</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-231"><a href="#LiveStreamDownloader.recover_stream-231"><span class="linenos">231</span></a>                <span class="n">livestream_coordinator</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-232"><a href="#LiveStreamDownloader.recover_stream-232"><span class="linenos">232</span></a>                <span class="n">stream_urls</span><span class="o">=</span><span class="n">stream_urls</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-233"><a href="#LiveStreamDownloader.recover_stream-233"><span class="linenos">233</span></a>                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.recover_stream-234"><a href="#LiveStreamDownloader.recover_stream-234"><span class="linenos">234</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">downloader</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-235"><a href="#LiveStreamDownloader.recover_stream-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Recording&quot;</span>
</span><span id="LiveStreamDownloader.recover_stream-236"><a href="#LiveStreamDownloader.recover_stream-236"><span class="linenos">236</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">live_dl</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.recover_stream-237"><a href="#LiveStreamDownloader.recover_stream-237"><span class="linenos">237</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">force_merge</span> <span class="ow">or</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">result</span> <span class="o">&lt;=</span> <span class="n">recovery_failure_tolerance</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">no_merge</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.recover_stream-238"><a href="#LiveStreamDownloader.recover_stream-238"><span class="linenos">238</span></a>                    <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-239"><a href="#LiveStreamDownloader.recover_stream-239"><span class="linenos">239</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.recover_stream-240"><a href="#LiveStreamDownloader.recover_stream-240"><span class="linenos">240</span></a>                            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">) Stream recovery of format </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> outstanding segments which were not able to complete. Exitting&quot;</span>
</span><span id="LiveStreamDownloader.recover_stream-241"><a href="#LiveStreamDownloader.recover_stream-241"><span class="linenos">241</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-242"><a href="#LiveStreamDownloader.recover_stream-242"><span class="linenos">242</span></a>                    <span class="n">file_name</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">combine_segments_to_file</span><span class="p">(</span><span class="n">downloader</span><span class="o">.</span><span class="n">merged_file_name</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-243"><a href="#LiveStreamDownloader.recover_stream-243"><span class="linenos">243</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_database</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-244"><a href="#LiveStreamDownloader.recover_stream-244"><span class="linenos">244</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging to ts complete, removing </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-245"><a href="#LiveStreamDownloader.recover_stream-245"><span class="linenos">245</span></a>                        <span class="n">downloader</span><span class="o">.</span><span class="n">delete_temp_database</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.recover_stream-246"><a href="#LiveStreamDownloader.recover_stream-246"><span class="linenos">246</span></a>                    <span class="k">elif</span> <span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-247"><a href="#LiveStreamDownloader.recover_stream-247"><span class="linenos">247</span></a>                        <span class="n">database_file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.recover_stream-248"><a href="#LiveStreamDownloader.recover_stream-248"><span class="linenos">248</span></a>                            <span class="n">downloader</span><span class="o">.</span><span class="n">temp_db_file</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span>
</span><span id="LiveStreamDownloader.recover_stream-249"><a href="#LiveStreamDownloader.recover_stream-249"><span class="linenos">249</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-250"><a href="#LiveStreamDownloader.recover_stream-250"><span class="linenos">250</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;databases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-251"><a href="#LiveStreamDownloader.recover_stream-251"><span class="linenos">251</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-252"><a href="#LiveStreamDownloader.recover_stream-252"><span class="linenos">252</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">) Stream recovery of format </span><span class="si">{</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> outstanding segments which were not able to complete. Exitting&quot;</span>
</span><span id="LiveStreamDownloader.recover_stream-253"><a href="#LiveStreamDownloader.recover_stream-253"><span class="linenos">253</span></a>                    <span class="k">raise</span> <span class="n">VideoDownloadError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-254"><a href="#LiveStreamDownloader.recover_stream-254"><span class="linenos">254</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">downloader</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-255"><a href="#LiveStreamDownloader.recover_stream-255"><span class="linenos">255</span></a>                <span class="n">filetype</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">type</span>
</span><span id="LiveStreamDownloader.recover_stream-256"><a href="#LiveStreamDownloader.recover_stream-256"><span class="linenos">256</span></a>
</span><span id="LiveStreamDownloader.recover_stream-257"><a href="#LiveStreamDownloader.recover_stream-257"><span class="linenos">257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;streams&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="nb">str</span><span class="p">(</span><span class="n">filetype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">file</span><span class="p">})</span>
</span><span id="LiveStreamDownloader.recover_stream-258"><a href="#LiveStreamDownloader.recover_stream-258"><span class="linenos">258</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.recover_stream-259"><a href="#LiveStreamDownloader.recover_stream-259"><span class="linenos">259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unexpected error occurred while downloading stream&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.recover_stream-260"><a href="#LiveStreamDownloader.recover_stream-260"><span class="linenos">260</span></a>            <span class="k">raise</span>
</span><span id="LiveStreamDownloader.recover_stream-261"><a href="#LiveStreamDownloader.recover_stream-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">filetype</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.submit_download" class="classattr">
                                        <input id="LiveStreamDownloader.submit_download-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">submit_download</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">executor</span>,</span><span class="param">	<span class="n">info_dict</span>,</span><span class="param">	<span class="n">resolution</span>,</span><span class="param">	<span class="n">options</span>,</span><span class="param">	<span class="n">download_folder</span>,</span><span class="param">	<span class="n">file_name</span>,</span><span class="param">	<span class="n">futures</span>,</span><span class="param">	<span class="n">is_audio</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.submit_download-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.submit_download"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.submit_download-263"><a href="#LiveStreamDownloader.submit_download-263"><span class="linenos">263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.submit_download-264"><a href="#LiveStreamDownloader.submit_download-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">False</span>
</span><span id="LiveStreamDownloader.submit_download-265"><a href="#LiveStreamDownloader.submit_download-265"><span class="linenos">265</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader.submit_download-266"><a href="#LiveStreamDownloader.submit_download-266"><span class="linenos">266</span></a>        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader.submit_download-267"><a href="#LiveStreamDownloader.submit_download-267"><span class="linenos">267</span></a>
</span><span id="LiveStreamDownloader.submit_download-268"><a href="#LiveStreamDownloader.submit_download-268"><span class="linenos">268</span></a>        <span class="c1"># Options only not used by recovery</span>
</span><span id="LiveStreamDownloader.submit_download-269"><a href="#LiveStreamDownloader.submit_download-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.submit_download-270"><a href="#LiveStreamDownloader.submit_download-270"><span class="linenos">270</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.submit_download-271"><a href="#LiveStreamDownloader.submit_download-271"><span class="linenos">271</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader.submit_download-272"><a href="#LiveStreamDownloader.submit_download-272"><span class="linenos">272</span></a>                    <span class="s2">&quot;include_dash&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-273"><a href="#LiveStreamDownloader.submit_download-273"><span class="linenos">273</span></a>                    <span class="s2">&quot;include_m3u8&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-274"><a href="#LiveStreamDownloader.submit_download-274"><span class="linenos">274</span></a>                    <span class="s2">&quot;force_m3u8&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-275"><a href="#LiveStreamDownloader.submit_download-275"><span class="linenos">275</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader.submit_download-276"><a href="#LiveStreamDownloader.submit_download-276"><span class="linenos">276</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-277"><a href="#LiveStreamDownloader.submit_download-277"><span class="linenos">277</span></a>
</span><span id="LiveStreamDownloader.submit_download-278"><a href="#LiveStreamDownloader.submit_download-278"><span class="linenos">278</span></a>        <span class="c1"># Select the function</span>
</span><span id="LiveStreamDownloader.submit_download-279"><a href="#LiveStreamDownloader.submit_download-279"><span class="linenos">279</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.submit_download-280"><a href="#LiveStreamDownloader.submit_download-280"><span class="linenos">280</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recover_stream</span>
</span><span id="LiveStreamDownloader.submit_download-281"><a href="#LiveStreamDownloader.submit_download-281"><span class="linenos">281</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.submit_download-282"><a href="#LiveStreamDownloader.submit_download-282"><span class="linenos">282</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader.submit_download-283"><a href="#LiveStreamDownloader.submit_download-283"><span class="linenos">283</span></a>                    <span class="s2">&quot;force_merge&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_recovery_merge&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-284"><a href="#LiveStreamDownloader.submit_download-284"><span class="linenos">284</span></a>                    <span class="s2">&quot;recovery_failure_tolerance&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery_failure_tolerance&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-285"><a href="#LiveStreamDownloader.submit_download-285"><span class="linenos">285</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader.submit_download-286"><a href="#LiveStreamDownloader.submit_download-286"><span class="linenos">286</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-287"><a href="#LiveStreamDownloader.submit_download-287"><span class="linenos">287</span></a>        <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;direct_to_ts&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.submit_download-288"><a href="#LiveStreamDownloader.submit_download-288"><span class="linenos">288</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream_direct</span>
</span><span id="LiveStreamDownloader.submit_download-289"><a href="#LiveStreamDownloader.submit_download-289"><span class="linenos">289</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.submit_download-290"><a href="#LiveStreamDownloader.submit_download-290"><span class="linenos">290</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader.submit_download-291"><a href="#LiveStreamDownloader.submit_download-291"><span class="linenos">291</span></a>                    <span class="s2">&quot;keep_state&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_database_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-292"><a href="#LiveStreamDownloader.submit_download-292"><span class="linenos">292</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader.submit_download-293"><a href="#LiveStreamDownloader.submit_download-293"><span class="linenos">293</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-294"><a href="#LiveStreamDownloader.submit_download-294"><span class="linenos">294</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.submit_download-295"><a href="#LiveStreamDownloader.submit_download-295"><span class="linenos">295</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_stream</span>
</span><span id="LiveStreamDownloader.submit_download-296"><a href="#LiveStreamDownloader.submit_download-296"><span class="linenos">296</span></a>            <span class="n">extra_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.submit_download-297"><a href="#LiveStreamDownloader.submit_download-297"><span class="linenos">297</span></a>                <span class="p">{</span>
</span><span id="LiveStreamDownloader.submit_download-298"><a href="#LiveStreamDownloader.submit_download-298"><span class="linenos">298</span></a>                    <span class="s2">&quot;keep_database&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_database_file&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-299"><a href="#LiveStreamDownloader.submit_download-299"><span class="linenos">299</span></a>                <span class="p">}</span>
</span><span id="LiveStreamDownloader.submit_download-300"><a href="#LiveStreamDownloader.submit_download-300"><span class="linenos">300</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-301"><a href="#LiveStreamDownloader.submit_download-301"><span class="linenos">301</span></a>
</span><span id="LiveStreamDownloader.submit_download-302"><a href="#LiveStreamDownloader.submit_download-302"><span class="linenos">302</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LiveStreamDownloader.submit_download-303"><a href="#LiveStreamDownloader.submit_download-303"><span class="linenos">303</span></a>            <span class="s2">&quot;info_dict&quot;</span><span class="p">:</span> <span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.submit_download-304"><a href="#LiveStreamDownloader.submit_download-304"><span class="linenos">304</span></a>            <span class="s2">&quot;resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;audio_only&quot;</span> <span class="k">if</span> <span class="n">is_audio</span> <span class="k">else</span> <span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.submit_download-305"><a href="#LiveStreamDownloader.submit_download-305"><span class="linenos">305</span></a>            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;batch_size&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-306"><a href="#LiveStreamDownloader.submit_download-306"><span class="linenos">306</span></a>            <span class="s2">&quot;max_workers&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-307"><a href="#LiveStreamDownloader.submit_download-307"><span class="linenos">307</span></a>            <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="n">download_folder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.submit_download-308"><a href="#LiveStreamDownloader.submit_download-308"><span class="linenos">308</span></a>            <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.submit_download-309"><a href="#LiveStreamDownloader.submit_download-309"><span class="linenos">309</span></a>            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segment_retries&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-310"><a href="#LiveStreamDownloader.submit_download-310"><span class="linenos">310</span></a>            <span class="s2">&quot;cookies&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cookies&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-311"><a href="#LiveStreamDownloader.submit_download-311"><span class="linenos">311</span></a>            <span class="s2">&quot;yt_dlp_options&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ytdlp_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-312"><a href="#LiveStreamDownloader.submit_download-312"><span class="linenos">312</span></a>            <span class="s2">&quot;proxies&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-313"><a href="#LiveStreamDownloader.submit_download-313"><span class="linenos">313</span></a>            <span class="s2">&quot;yt_dlp_sort&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_sort&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.submit_download-314"><a href="#LiveStreamDownloader.submit_download-314"><span class="linenos">314</span></a>        <span class="p">}</span>
</span><span id="LiveStreamDownloader.submit_download-315"><a href="#LiveStreamDownloader.submit_download-315"><span class="linenos">315</span></a>
</span><span id="LiveStreamDownloader.submit_download-316"><a href="#LiveStreamDownloader.submit_download-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="n">extra_kwargs</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.submit_download-317"><a href="#LiveStreamDownloader.submit_download-317"><span class="linenos">317</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_kwargs</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-318"><a href="#LiveStreamDownloader.submit_download-318"><span class="linenos">318</span></a>
</span><span id="LiveStreamDownloader.submit_download-319"><a href="#LiveStreamDownloader.submit_download-319"><span class="linenos">319</span></a>        <span class="c1"># Add any extra values not yet existing</span>
</span><span id="LiveStreamDownloader.submit_download-320"><a href="#LiveStreamDownloader.submit_download-320"><span class="linenos">320</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="LiveStreamDownloader.submit_download-321"><a href="#LiveStreamDownloader.submit_download-321"><span class="linenos">321</span></a>            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-322"><a href="#LiveStreamDownloader.submit_download-322"><span class="linenos">322</span></a>
</span><span id="LiveStreamDownloader.submit_download-323"><a href="#LiveStreamDownloader.submit_download-323"><span class="linenos">323</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting executor with: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-324"><a href="#LiveStreamDownloader.submit_download-324"><span class="linenos">324</span></a>
</span><span id="LiveStreamDownloader.submit_download-325"><a href="#LiveStreamDownloader.submit_download-325"><span class="linenos">325</span></a>        <span class="c1"># Submit to executor</span>
</span><span id="LiveStreamDownloader.submit_download-326"><a href="#LiveStreamDownloader.submit_download-326"><span class="linenos">326</span></a>        <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-327"><a href="#LiveStreamDownloader.submit_download-327"><span class="linenos">327</span></a>        <span class="n">futures</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.submit_download-328"><a href="#LiveStreamDownloader.submit_download-328"><span class="linenos">328</span></a>        <span class="k">return</span> <span class="n">future</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.download_segments" class="classattr">
                                        <input id="LiveStreamDownloader.download_segments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_segments</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">info_dict</span>,</span><span class="param">	<span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;best&#39;</span>,</span><span class="param">	<span class="n">options</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">thread_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.download_segments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.download_segments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.download_segments-331"><a href="#LiveStreamDownloader.download_segments-331"><span class="linenos">331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_segments</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-332"><a href="#LiveStreamDownloader.download_segments-332"><span class="linenos">332</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thread_event</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_segments-333"><a href="#LiveStreamDownloader.download_segments-333"><span class="linenos">333</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-334"><a href="#LiveStreamDownloader.download_segments-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-335"><a href="#LiveStreamDownloader.download_segments-335"><span class="linenos">335</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader.download_segments-336"><a href="#LiveStreamDownloader.download_segments-336"><span class="linenos">336</span></a>        <span class="n">futures</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-337"><a href="#LiveStreamDownloader.download_segments-337"><span class="linenos">337</span></a>
</span><span id="LiveStreamDownloader.download_segments-338"><a href="#LiveStreamDownloader.download_segments-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">thread_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-339"><a href="#LiveStreamDownloader.download_segments-339"><span class="linenos">339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span> <span class="o">=</span> <span class="n">thread_event</span>
</span><span id="LiveStreamDownloader.download_segments-340"><a href="#LiveStreamDownloader.download_segments-340"><span class="linenos">340</span></a>
</span><span id="LiveStreamDownloader.download_segments-341"><a href="#LiveStreamDownloader.download_segments-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-342"><a href="#LiveStreamDownloader.download_segments-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Starting&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-343"><a href="#LiveStreamDownloader.download_segments-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_segments-344"><a href="#LiveStreamDownloader.download_segments-344"><span class="linenos">344</span></a>        <span class="n">outputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_segments-345"><a href="#LiveStreamDownloader.download_segments-345"><span class="linenos">345</span></a>        <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_segments-346"><a href="#LiveStreamDownloader.download_segments-346"><span class="linenos">346</span></a>        <span class="c1"># Requires testing</span>
</span><span id="LiveStreamDownloader.download_segments-347"><a href="#LiveStreamDownloader.download_segments-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">outputFile</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_segments-348"><a href="#LiveStreamDownloader.download_segments-348"><span class="linenos">348</span></a>            <span class="n">_output_folder</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-349"><a href="#LiveStreamDownloader.download_segments-349"><span class="linenos">349</span></a>            <span class="n">download_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_segments-350"><a href="#LiveStreamDownloader.download_segments-350"><span class="linenos">350</span></a>            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_folder</span>
</span><span id="LiveStreamDownloader.download_segments-351"><a href="#LiveStreamDownloader.download_segments-351"><span class="linenos">351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-352"><a href="#LiveStreamDownloader.download_segments-352"><span class="linenos">352</span></a>            <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">outputFile</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-353"><a href="#LiveStreamDownloader.download_segments-353"><span class="linenos">353</span></a>        <span class="n">options</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
</span><span id="LiveStreamDownloader.download_segments-354"><a href="#LiveStreamDownloader.download_segments-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="n">download_folder</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-355"><a href="#LiveStreamDownloader.download_segments-355"><span class="linenos">355</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-356"><a href="#LiveStreamDownloader.download_segments-356"><span class="linenos">356</span></a>
</span><span id="LiveStreamDownloader.download_segments-357"><a href="#LiveStreamDownloader.download_segments-357"><span class="linenos">357</span></a>        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-358"><a href="#LiveStreamDownloader.download_segments-358"><span class="linenos">358</span></a>            <span class="n">done</span> <span class="o">=</span> <span class="n">not_done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-359"><a href="#LiveStreamDownloader.download_segments-359"><span class="linenos">359</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-360"><a href="#LiveStreamDownloader.download_segments-360"><span class="linenos">360</span></a>                <span class="c1"># Download auxiliary files (thumbnail, info,json etc)</span>
</span><span id="LiveStreamDownloader.download_segments-361"><a href="#LiveStreamDownloader.download_segments-361"><span class="linenos">361</span></a>                <span class="n">auxiliary_thread</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_auxiliary_files</span><span class="p">,</span> <span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-362"><a href="#LiveStreamDownloader.download_segments-362"><span class="linenos">362</span></a>                <span class="n">futures</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">auxiliary_thread</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-363"><a href="#LiveStreamDownloader.download_segments-363"><span class="linenos">363</span></a>
</span><span id="LiveStreamDownloader.download_segments-364"><a href="#LiveStreamDownloader.download_segments-364"><span class="linenos">364</span></a>                <span class="n">live_chat_thread</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.download_segments-365"><a href="#LiveStreamDownloader.download_segments-365"><span class="linenos">365</span></a>                <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;live_chat&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-366"><a href="#LiveStreamDownloader.download_segments-366"><span class="linenos">366</span></a>                    <span class="n">live_chat_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-367"><a href="#LiveStreamDownloader.download_segments-367"><span class="linenos">367</span></a>                        <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">download_live_chat</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader.download_segments-368"><a href="#LiveStreamDownloader.download_segments-368"><span class="linenos">368</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-369"><a href="#LiveStreamDownloader.download_segments-369"><span class="linenos">369</span></a>                    <span class="n">live_chat_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-370"><a href="#LiveStreamDownloader.download_segments-370"><span class="linenos">370</span></a>
</span><span id="LiveStreamDownloader.download_segments-371"><a href="#LiveStreamDownloader.download_segments-371"><span class="linenos">371</span></a>                <span class="n">format_check</span> <span class="o">=</span> <span class="n">Formats</span><span class="p">()</span><span class="o">.</span><span class="n">getFormatURL</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-372"><a href="#LiveStreamDownloader.download_segments-372"><span class="linenos">372</span></a>                    <span class="n">info_json</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_segments-373"><a href="#LiveStreamDownloader.download_segments-373"><span class="linenos">373</span></a>                    <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_segments-374"><a href="#LiveStreamDownloader.download_segments-374"><span class="linenos">374</span></a>                    <span class="n">sort</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_sort&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_segments-375"><a href="#LiveStreamDownloader.download_segments-375"><span class="linenos">375</span></a>                    <span class="n">include_dash</span><span class="o">=</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
</span><span id="LiveStreamDownloader.download_segments-376"><a href="#LiveStreamDownloader.download_segments-376"><span class="linenos">376</span></a>                    <span class="n">include_m3u8</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_segments-377"><a href="#LiveStreamDownloader.download_segments-377"><span class="linenos">377</span></a>                    <span class="n">force_m3u8</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force_m3u8&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_segments-378"><a href="#LiveStreamDownloader.download_segments-378"><span class="linenos">378</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-379"><a href="#LiveStreamDownloader.download_segments-379"><span class="linenos">379</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">format_check</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-380"><a href="#LiveStreamDownloader.download_segments-380"><span class="linenos">380</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Resolution is not valid or does not exist in stream&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-381"><a href="#LiveStreamDownloader.download_segments-381"><span class="linenos">381</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-382"><a href="#LiveStreamDownloader.download_segments-382"><span class="linenos">382</span></a>                <span class="c1"># For use of specificed format. Expects two values, but can work with more</span>
</span><span id="LiveStreamDownloader.download_segments-383"><a href="#LiveStreamDownloader.download_segments-383"><span class="linenos">383</span></a>                <span class="c1"># Video + Audio</span>
</span><span id="LiveStreamDownloader.download_segments-384"><a href="#LiveStreamDownloader.download_segments-384"><span class="linenos">384</span></a>
</span><span id="LiveStreamDownloader.download_segments-385"><a href="#LiveStreamDownloader.download_segments-385"><span class="linenos">385</span></a>                <span class="k">if</span> <span class="n">resolution</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;audio_only&quot;</span><span class="p">,</span> <span class="s2">&quot;ba&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_segments-386"><a href="#LiveStreamDownloader.download_segments-386"><span class="linenos">386</span></a>                    <span class="c1"># Video</span>
</span><span id="LiveStreamDownloader.download_segments-387"><a href="#LiveStreamDownloader.download_segments-387"><span class="linenos">387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-388"><a href="#LiveStreamDownloader.download_segments-388"><span class="linenos">388</span></a>                        <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">False</span>
</span><span id="LiveStreamDownloader.download_segments-389"><a href="#LiveStreamDownloader.download_segments-389"><span class="linenos">389</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-390"><a href="#LiveStreamDownloader.download_segments-390"><span class="linenos">390</span></a>                    <span class="k">if</span> <span class="n">format_check</span><span class="o">.</span><span class="n">protocol</span> <span class="o">!=</span> <span class="s2">&quot;m3u8_native&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-391"><a href="#LiveStreamDownloader.download_segments-391"><span class="linenos">391</span></a>                        <span class="c1"># Audio</span>
</span><span id="LiveStreamDownloader.download_segments-392"><a href="#LiveStreamDownloader.download_segments-392"><span class="linenos">392</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-393"><a href="#LiveStreamDownloader.download_segments-393"><span class="linenos">393</span></a>                            <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader.download_segments-394"><a href="#LiveStreamDownloader.download_segments-394"><span class="linenos">394</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-395"><a href="#LiveStreamDownloader.download_segments-395"><span class="linenos">395</span></a>                <span class="c1"># Audio-only</span>
</span><span id="LiveStreamDownloader.download_segments-396"><a href="#LiveStreamDownloader.download_segments-396"><span class="linenos">396</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-397"><a href="#LiveStreamDownloader.download_segments-397"><span class="linenos">397</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">submit_download</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-398"><a href="#LiveStreamDownloader.download_segments-398"><span class="linenos">398</span></a>                        <span class="n">executor</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">download_folder</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">is_audio</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader.download_segments-399"><a href="#LiveStreamDownloader.download_segments-399"><span class="linenos">399</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-400"><a href="#LiveStreamDownloader.download_segments-400"><span class="linenos">400</span></a>
</span><span id="LiveStreamDownloader.download_segments-401"><a href="#LiveStreamDownloader.download_segments-401"><span class="linenos">401</span></a>                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-402"><a href="#LiveStreamDownloader.download_segments-402"><span class="linenos">402</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="LiveStreamDownloader.download_segments-403"><a href="#LiveStreamDownloader.download_segments-403"><span class="linenos">403</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Thread kill event is set, ending...&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-404"><a href="#LiveStreamDownloader.download_segments-404"><span class="linenos">404</span></a>                        <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-405"><a href="#LiveStreamDownloader.download_segments-405"><span class="linenos">405</span></a>                    <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-406"><a href="#LiveStreamDownloader.download_segments-406"><span class="linenos">406</span></a>                        <span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span>
</span><span id="LiveStreamDownloader.download_segments-407"><a href="#LiveStreamDownloader.download_segments-407"><span class="linenos">407</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-408"><a href="#LiveStreamDownloader.download_segments-408"><span class="linenos">408</span></a>                    <span class="c1"># Continuously check for completion or interruption</span>
</span><span id="LiveStreamDownloader.download_segments-409"><a href="#LiveStreamDownloader.download_segments-409"><span class="linenos">409</span></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-410"><a href="#LiveStreamDownloader.download_segments-410"><span class="linenos">410</span></a>                        <span class="n">result</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-411"><a href="#LiveStreamDownloader.download_segments-411"><span class="linenos">411</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[31m</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-412"><a href="#LiveStreamDownloader.download_segments-412"><span class="linenos">412</span></a>
</span><span id="LiveStreamDownloader.download_segments-413"><a href="#LiveStreamDownloader.download_segments-413"><span class="linenos">413</span></a>                        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;auxiliary&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-414"><a href="#LiveStreamDownloader.download_segments-414"><span class="linenos">414</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-415"><a href="#LiveStreamDownloader.download_segments-415"><span class="linenos">415</span></a>
</span><span id="LiveStreamDownloader.download_segments-416"><a href="#LiveStreamDownloader.download_segments-416"><span class="linenos">416</span></a>                            <span class="c1"># Remove parts that would not be needed by stream downloaders</span>
</span><span id="LiveStreamDownloader.download_segments-417"><a href="#LiveStreamDownloader.download_segments-417"><span class="linenos">417</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_format_segment_playlist_from_info_dict</span><span class="p">(</span><span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-418"><a href="#LiveStreamDownloader.download_segments-418"><span class="linenos">418</span></a>                            <span class="n">info_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-419"><a href="#LiveStreamDownloader.download_segments-419"><span class="linenos">419</span></a>                            <span class="c1"># Remove no longer required parts for the rest of the downloader</span>
</span><span id="LiveStreamDownloader.download_segments-420"><a href="#LiveStreamDownloader.download_segments-420"><span class="linenos">420</span></a>                            <span class="c1"># info_dict = self.trim_info_json(info_dict=info_dict, keys_to_keep={&quot;id&quot;, &quot;ext&quot;, &quot;upload_date&quot;, &quot;original_url&quot;, &quot;description&quot;, &quot;fulltitle&quot;, &quot;channel&quot;})</span>
</span><span id="LiveStreamDownloader.download_segments-421"><a href="#LiveStreamDownloader.download_segments-421"><span class="linenos">421</span></a>
</span><span id="LiveStreamDownloader.download_segments-422"><a href="#LiveStreamDownloader.download_segments-422"><span class="linenos">422</span></a>                        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;video&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-423"><a href="#LiveStreamDownloader.download_segments-423"><span class="linenos">423</span></a>                            <span class="c1"># self.file_names[&#39;video&#39;] = result</span>
</span><span id="LiveStreamDownloader.download_segments-424"><a href="#LiveStreamDownloader.download_segments-424"><span class="linenos">424</span></a>                            <span class="k">pass</span>
</span><span id="LiveStreamDownloader.download_segments-425"><a href="#LiveStreamDownloader.download_segments-425"><span class="linenos">425</span></a>                        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;audio&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-426"><a href="#LiveStreamDownloader.download_segments-426"><span class="linenos">426</span></a>                            <span class="c1"># self.file_names[&#39;audio&#39;] = result</span>
</span><span id="LiveStreamDownloader.download_segments-427"><a href="#LiveStreamDownloader.download_segments-427"><span class="linenos">427</span></a>                            <span class="k">pass</span>
</span><span id="LiveStreamDownloader.download_segments-428"><a href="#LiveStreamDownloader.download_segments-428"><span class="linenos">428</span></a>                        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;live_chat&quot;</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-429"><a href="#LiveStreamDownloader.download_segments-429"><span class="linenos">429</span></a>                            <span class="k">pass</span>
</span><span id="LiveStreamDownloader.download_segments-430"><a href="#LiveStreamDownloader.download_segments-430"><span class="linenos">430</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-431"><a href="#LiveStreamDownloader.download_segments-431"><span class="linenos">431</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="LiveStreamDownloader.download_segments-432"><a href="#LiveStreamDownloader.download_segments-432"><span class="linenos">432</span></a>
</span><span id="LiveStreamDownloader.download_segments-433"><a href="#LiveStreamDownloader.download_segments-433"><span class="linenos">433</span></a>                        <span class="n">futures</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-434"><a href="#LiveStreamDownloader.download_segments-434"><span class="linenos">434</span></a>
</span><span id="LiveStreamDownloader.download_segments-435"><a href="#LiveStreamDownloader.download_segments-435"><span class="linenos">435</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-436"><a href="#LiveStreamDownloader.download_segments-436"><span class="linenos">436</span></a>                        <span class="k">break</span>
</span><span id="LiveStreamDownloader.download_segments-437"><a href="#LiveStreamDownloader.download_segments-437"><span class="linenos">437</span></a>                    <span class="c1"># else:</span>
</span><span id="LiveStreamDownloader.download_segments-438"><a href="#LiveStreamDownloader.download_segments-438"><span class="linenos">438</span></a>                    <span class="c1">#    time.sleep(0.9)</span>
</span><span id="LiveStreamDownloader.download_segments-439"><a href="#LiveStreamDownloader.download_segments-439"><span class="linenos">439</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-440"><a href="#LiveStreamDownloader.download_segments-440"><span class="linenos">440</span></a>
</span><span id="LiveStreamDownloader.download_segments-441"><a href="#LiveStreamDownloader.download_segments-441"><span class="linenos">441</span></a>                <span class="k">if</span> <span class="n">live_chat_thread</span> <span class="ow">and</span> <span class="n">live_chat_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span><span id="LiveStreamDownloader.download_segments-442"><a href="#LiveStreamDownloader.download_segments-442"><span class="linenos">442</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Media downloads finished, waiting for live chat to end...&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-443"><a href="#LiveStreamDownloader.download_segments-443"><span class="linenos">443</span></a>                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stop_chat_when_done&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_segments-444"><a href="#LiveStreamDownloader.download_segments-444"><span class="linenos">444</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">chat_timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-445"><a href="#LiveStreamDownloader.download_segments-445"><span class="linenos">445</span></a>                    <span class="k">while</span> <span class="n">live_chat_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kill_all</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span><span class="o">.</span><span class="n">is_set</span><span class="p">()):</span>
</span><span id="LiveStreamDownloader.download_segments-446"><a href="#LiveStreamDownloader.download_segments-446"><span class="linenos">446</span></a>                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-447"><a href="#LiveStreamDownloader.download_segments-447"><span class="linenos">447</span></a>
</span><span id="LiveStreamDownloader.download_segments-448"><a href="#LiveStreamDownloader.download_segments-448"><span class="linenos">448</span></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-449"><a href="#LiveStreamDownloader.download_segments-449"><span class="linenos">449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill_this</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-450"><a href="#LiveStreamDownloader.download_segments-450"><span class="linenos">450</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Keyboard interrupt detected&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-451"><a href="#LiveStreamDownloader.download_segments-451"><span class="linenos">451</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_done</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-452"><a href="#LiveStreamDownloader.download_segments-452"><span class="linenos">452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cancelling remaining threads&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-453"><a href="#LiveStreamDownloader.download_segments-453"><span class="linenos">453</span></a>                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">not_done</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_segments-454"><a href="#LiveStreamDownloader.download_segments-454"><span class="linenos">454</span></a>                    <span class="n">_</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_segments-455"><a href="#LiveStreamDownloader.download_segments-455"><span class="linenos">455</span></a>                <span class="n">done</span><span class="p">,</span> <span class="n">not_done</span> <span class="o">=</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_segments-456"><a href="#LiveStreamDownloader.download_segments-456"><span class="linenos">456</span></a>                    <span class="n">futures</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ALL_COMPLETED</span>
</span><span id="LiveStreamDownloader.download_segments-457"><a href="#LiveStreamDownloader.download_segments-457"><span class="linenos">457</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-458"><a href="#LiveStreamDownloader.download_segments-458"><span class="linenos">458</span></a>                <span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cancel_futures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-459"><a href="#LiveStreamDownloader.download_segments-459"><span class="linenos">459</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Shutdown all threads&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-460"><a href="#LiveStreamDownloader.download_segments-460"><span class="linenos">460</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Cancelled&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-461"><a href="#LiveStreamDownloader.download_segments-461"><span class="linenos">461</span></a>                <span class="k">raise</span>
</span><span id="LiveStreamDownloader.download_segments-462"><a href="#LiveStreamDownloader.download_segments-462"><span class="linenos">462</span></a>
</span><span id="LiveStreamDownloader.download_segments-463"><a href="#LiveStreamDownloader.download_segments-463"><span class="linenos">463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Muxing&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-464"><a href="#LiveStreamDownloader.download_segments-464"><span class="linenos">464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_mp4</span><span class="p">(</span><span class="n">file_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">,</span> <span class="n">info_dict</span><span class="o">=</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-465"><a href="#LiveStreamDownloader.download_segments-465"><span class="linenos">465</span></a>
</span><span id="LiveStreamDownloader.download_segments-466"><a href="#LiveStreamDownloader.download_segments-466"><span class="linenos">466</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Moving&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-467"><a href="#LiveStreamDownloader.download_segments-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_final</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">file_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_segments-468"><a href="#LiveStreamDownloader.download_segments-468"><span class="linenos">468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Finished&quot;</span>
</span><span id="LiveStreamDownloader.download_segments-469"><a href="#LiveStreamDownloader.download_segments-469"><span class="linenos">469</span></a>        <span class="c1"># move_to_final(info_dict, options, file_names)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.output_filename" class="classattr">
                                        <input id="LiveStreamDownloader.output_filename-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">output_filename</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">info_dict</span>, </span><span class="param"><span class="n">outtmpl</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.output_filename-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.output_filename"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.output_filename-471"><a href="#LiveStreamDownloader.output_filename-471"><span class="linenos">471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">output_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.output_filename-472"><a href="#LiveStreamDownloader.output_filename-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">YoutubeDL</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">outtmpl</span><span class="o">=</span><span class="n">outtmpl</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.output_filename-473"><a href="#LiveStreamDownloader.output_filename-473"><span class="linenos">473</span></a>            <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;ï¼…&quot;</span>
</span><span id="LiveStreamDownloader.output_filename-474"><a href="#LiveStreamDownloader.output_filename-474"><span class="linenos">474</span></a>        <span class="p">)</span>  <span class="c1"># Replace normal percent sign with unicode version to prevent ffmpeg errors</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.move_to_final" class="classattr">
                                        <input id="LiveStreamDownloader.move_to_final-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_to_final</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">options</span>, </span><span class="param"><span class="n">output_file</span>, </span><span class="param"><span class="n">file_names</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.move_to_final-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.move_to_final"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.move_to_final-476"><a href="#LiveStreamDownloader.move_to_final-476"><span class="linenos">476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">file_names</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-477"><a href="#LiveStreamDownloader.move_to_final-477"><span class="linenos">477</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">maybe_move</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">dest_func</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">file_names</span><span class="p">,</span> <span class="n">option_flag</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-478"><a href="#LiveStreamDownloader.move_to_final-478"><span class="linenos">478</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;key: key in file_names</span>
</span><span id="LiveStreamDownloader.move_to_final-479"><a href="#LiveStreamDownloader.move_to_final-479"><span class="linenos">479</span></a><span class="sd">            dest_func: func -&gt; pathlib -&gt; string dest path</span>
</span><span id="LiveStreamDownloader.move_to_final-480"><a href="#LiveStreamDownloader.move_to_final-480"><span class="linenos">480</span></a><span class="sd">            delete_if_false: if True, delete when option_flag not set</span>
</span><span id="LiveStreamDownloader.move_to_final-481"><a href="#LiveStreamDownloader.move_to_final-481"><span class="linenos">481</span></a><span class="sd">            option_flag: name of boolean option (write_thumbnail etc)</span>
</span><span id="LiveStreamDownloader.move_to_final-482"><a href="#LiveStreamDownloader.move_to_final-482"><span class="linenos">482</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader.move_to_final-483"><a href="#LiveStreamDownloader.move_to_final-483"><span class="linenos">483</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="n">file_names_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-484"><a href="#LiveStreamDownloader.move_to_final-484"><span class="linenos">484</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-485"><a href="#LiveStreamDownloader.move_to_final-485"><span class="linenos">485</span></a>                <span class="k">return</span>
</span><span id="LiveStreamDownloader.move_to_final-486"><a href="#LiveStreamDownloader.move_to_final-486"><span class="linenos">486</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-487"><a href="#LiveStreamDownloader.move_to_final-487"><span class="linenos">487</span></a>                <span class="c1"># deletion case (thumbnail / ffmpeg)</span>
</span><span id="LiveStreamDownloader.move_to_final-488"><a href="#LiveStreamDownloader.move_to_final-488"><span class="linenos">488</span></a>                <span class="k">if</span> <span class="n">option_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">option_flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.move_to_final-489"><a href="#LiveStreamDownloader.move_to_final-489"><span class="linenos">489</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-490"><a href="#LiveStreamDownloader.move_to_final-490"><span class="linenos">490</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-491"><a href="#LiveStreamDownloader.move_to_final-491"><span class="linenos">491</span></a>                    <span class="n">file_names_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-492"><a href="#LiveStreamDownloader.move_to_final-492"><span class="linenos">492</span></a>                    <span class="k">return</span>
</span><span id="LiveStreamDownloader.move_to_final-493"><a href="#LiveStreamDownloader.move_to_final-493"><span class="linenos">493</span></a>
</span><span id="LiveStreamDownloader.move_to_final-494"><a href="#LiveStreamDownloader.move_to_final-494"><span class="linenos">494</span></a>                <span class="n">dest</span> <span class="o">=</span> <span class="n">dest_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-495"><a href="#LiveStreamDownloader.move_to_final-495"><span class="linenos">495</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="LiveStreamDownloader.move_to_final-496"><a href="#LiveStreamDownloader.move_to_final-496"><span class="linenos">496</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moving </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-497"><a href="#LiveStreamDownloader.move_to_final-497"><span class="linenos">497</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">(),</span> <span class="n">dest</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-498"><a href="#LiveStreamDownloader.move_to_final-498"><span class="linenos">498</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-499"><a href="#LiveStreamDownloader.move_to_final-499"><span class="linenos">499</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2"> is already in final destination&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-500"><a href="#LiveStreamDownloader.move_to_final-500"><span class="linenos">500</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-501"><a href="#LiveStreamDownloader.move_to_final-501"><span class="linenos">501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unable to move </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-502"><a href="#LiveStreamDownloader.move_to_final-502"><span class="linenos">502</span></a>
</span><span id="LiveStreamDownloader.move_to_final-503"><a href="#LiveStreamDownloader.move_to_final-503"><span class="linenos">503</span></a>        <span class="c1"># ensure output dir exists</span>
</span><span id="LiveStreamDownloader.move_to_final-504"><a href="#LiveStreamDownloader.move_to_final-504"><span class="linenos">504</span></a>        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-505"><a href="#LiveStreamDownloader.move_to_final-505"><span class="linenos">505</span></a>        <span class="k">if</span> <span class="n">out_dir</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-506"><a href="#LiveStreamDownloader.move_to_final-506"><span class="linenos">506</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-507"><a href="#LiveStreamDownloader.move_to_final-507"><span class="linenos">507</span></a>
</span><span id="LiveStreamDownloader.move_to_final-508"><a href="#LiveStreamDownloader.move_to_final-508"><span class="linenos">508</span></a>        <span class="c1"># === individual file handlers ===</span>
</span><span id="LiveStreamDownloader.move_to_final-509"><a href="#LiveStreamDownloader.move_to_final-509"><span class="linenos">509</span></a>
</span><span id="LiveStreamDownloader.move_to_final-510"><a href="#LiveStreamDownloader.move_to_final-510"><span class="linenos">510</span></a>        <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">option_flag</span><span class="o">=</span><span class="s2">&quot;write_thumbnail&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-511"><a href="#LiveStreamDownloader.move_to_final-511"><span class="linenos">511</span></a>
</span><span id="LiveStreamDownloader.move_to_final-512"><a href="#LiveStreamDownloader.move_to_final-512"><span class="linenos">512</span></a>        <span class="n">maybe_move</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.move_to_final-513"><a href="#LiveStreamDownloader.move_to_final-513"><span class="linenos">513</span></a>            <span class="s2">&quot;info_json&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.move_to_final-514"><a href="#LiveStreamDownloader.move_to_final-514"><span class="linenos">514</span></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.info.json&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.move_to_final-515"><a href="#LiveStreamDownloader.move_to_final-515"><span class="linenos">515</span></a>        <span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-516"><a href="#LiveStreamDownloader.move_to_final-516"><span class="linenos">516</span></a>
</span><span id="LiveStreamDownloader.move_to_final-517"><a href="#LiveStreamDownloader.move_to_final-517"><span class="linenos">517</span></a>        <span class="n">maybe_move</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.move_to_final-518"><a href="#LiveStreamDownloader.move_to_final-518"><span class="linenos">518</span></a>            <span class="s2">&quot;description&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.move_to_final-519"><a href="#LiveStreamDownloader.move_to_final-519"><span class="linenos">519</span></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.move_to_final-520"><a href="#LiveStreamDownloader.move_to_final-520"><span class="linenos">520</span></a>        <span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-521"><a href="#LiveStreamDownloader.move_to_final-521"><span class="linenos">521</span></a>
</span><span id="LiveStreamDownloader.move_to_final-522"><a href="#LiveStreamDownloader.move_to_final-522"><span class="linenos">522</span></a>        <span class="n">stream_manifests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="LiveStreamDownloader.move_to_final-523"><a href="#LiveStreamDownloader.move_to_final-523"><span class="linenos">523</span></a>        <span class="k">for</span> <span class="n">manifest</span><span class="p">,</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">stream_manifests</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-524"><a href="#LiveStreamDownloader.move_to_final-524"><span class="linenos">524</span></a>            <span class="n">stream_output_file</span> <span class="o">=</span> <span class="n">output_file</span>
</span><span id="LiveStreamDownloader.move_to_final-525"><a href="#LiveStreamDownloader.move_to_final-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_manifests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-526"><a href="#LiveStreamDownloader.move_to_final-526"><span class="linenos">526</span></a>                <span class="n">stream_output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">manifest</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.move_to_final-527"><a href="#LiveStreamDownloader.move_to_final-527"><span class="linenos">527</span></a>            <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">_format</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-528"><a href="#LiveStreamDownloader.move_to_final-528"><span class="linenos">528</span></a>
</span><span id="LiveStreamDownloader.move_to_final-529"><a href="#LiveStreamDownloader.move_to_final-529"><span class="linenos">529</span></a>            <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">_format</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-530"><a href="#LiveStreamDownloader.move_to_final-530"><span class="linenos">530</span></a>
</span><span id="LiveStreamDownloader.move_to_final-531"><a href="#LiveStreamDownloader.move_to_final-531"><span class="linenos">531</span></a>            <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;merged&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stream_output_file</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_names_dict</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-532"><a href="#LiveStreamDownloader.move_to_final-532"><span class="linenos">532</span></a>
</span><span id="LiveStreamDownloader.move_to_final-533"><a href="#LiveStreamDownloader.move_to_final-533"><span class="linenos">533</span></a>        <span class="n">maybe_move</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.move_to_final-534"><a href="#LiveStreamDownloader.move_to_final-534"><span class="linenos">534</span></a>            <span class="s2">&quot;live_chat&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.move_to_final-535"><a href="#LiveStreamDownloader.move_to_final-535"><span class="linenos">535</span></a>            <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.live_chat.zip&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.move_to_final-536"><a href="#LiveStreamDownloader.move_to_final-536"><span class="linenos">536</span></a>        <span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-537"><a href="#LiveStreamDownloader.move_to_final-537"><span class="linenos">537</span></a>
</span><span id="LiveStreamDownloader.move_to_final-538"><a href="#LiveStreamDownloader.move_to_final-538"><span class="linenos">538</span></a>        <span class="c1"># special: databases = list</span>
</span><span id="LiveStreamDownloader.move_to_final-539"><a href="#LiveStreamDownloader.move_to_final-539"><span class="linenos">539</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-540"><a href="#LiveStreamDownloader.move_to_final-540"><span class="linenos">540</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="LiveStreamDownloader.move_to_final-541"><a href="#LiveStreamDownloader.move_to_final-541"><span class="linenos">541</span></a>                <span class="n">dest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">_format</span><span class="si">}{</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.move_to_final-542"><a href="#LiveStreamDownloader.move_to_final-542"><span class="linenos">542</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="LiveStreamDownloader.move_to_final-543"><a href="#LiveStreamDownloader.move_to_final-543"><span class="linenos">543</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moving </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-544"><a href="#LiveStreamDownloader.move_to_final-544"><span class="linenos">544</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">absolute</span><span class="p">(),</span> <span class="n">dest</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-545"><a href="#LiveStreamDownloader.move_to_final-545"><span class="linenos">545</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.move_to_final-546"><a href="#LiveStreamDownloader.move_to_final-546"><span class="linenos">546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unable to move database files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-547"><a href="#LiveStreamDownloader.move_to_final-547"><span class="linenos">547</span></a>
</span><span id="LiveStreamDownloader.move_to_final-548"><a href="#LiveStreamDownloader.move_to_final-548"><span class="linenos">548</span></a>        <span class="c1"># special: ffmpeg_cmd</span>
</span><span id="LiveStreamDownloader.move_to_final-549"><a href="#LiveStreamDownloader.move_to_final-549"><span class="linenos">549</span></a>        <span class="n">maybe_move</span><span class="p">(</span><span class="s2">&quot;ffmpeg_cmd&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">.ffmpeg.txt&quot;</span><span class="p">,</span> <span class="n">option_flag</span><span class="o">=</span><span class="s2">&quot;write_ffmpeg_command&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.move_to_final-550"><a href="#LiveStreamDownloader.move_to_final-550"><span class="linenos">550</span></a>
</span><span id="LiveStreamDownloader.move_to_final-551"><a href="#LiveStreamDownloader.move_to_final-551"><span class="linenos">551</span></a>        <span class="c1"># remove temp folder</span>
</span><span id="LiveStreamDownloader.move_to_final-552"><a href="#LiveStreamDownloader.move_to_final-552"><span class="linenos">552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader.move_to_final-553"><a href="#LiveStreamDownloader.move_to_final-553"><span class="linenos">553</span></a><span class="sd">        if options.get(&#39;temp_folder&#39;, None) is not None:</span>
</span><span id="LiveStreamDownloader.move_to_final-554"><a href="#LiveStreamDownloader.move_to_final-554"><span class="linenos">554</span></a><span class="sd">            try:</span>
</span><span id="LiveStreamDownloader.move_to_final-555"><a href="#LiveStreamDownloader.move_to_final-555"><span class="linenos">555</span></a><span class="sd">                os.rmdir(options.get(&#39;temp_folder&#39;))</span>
</span><span id="LiveStreamDownloader.move_to_final-556"><a href="#LiveStreamDownloader.move_to_final-556"><span class="linenos">556</span></a><span class="sd">            except OSError as e:</span>
</span><span id="LiveStreamDownloader.move_to_final-557"><a href="#LiveStreamDownloader.move_to_final-557"><span class="linenos">557</span></a><span class="sd">                if e.errno == errno.ENOTEMPTY:</span>
</span><span id="LiveStreamDownloader.move_to_final-558"><a href="#LiveStreamDownloader.move_to_final-558"><span class="linenos">558</span></a><span class="sd">                    self.logger.warning(f&quot;Error: Directory not empty: {e.filename}&quot;)</span>
</span><span id="LiveStreamDownloader.move_to_final-559"><a href="#LiveStreamDownloader.move_to_final-559"><span class="linenos">559</span></a><span class="sd">                else:</span>
</span><span id="LiveStreamDownloader.move_to_final-560"><a href="#LiveStreamDownloader.move_to_final-560"><span class="linenos">560</span></a><span class="sd">                    self.logger.exception(f&quot;Error removing temp folder: {e}&quot;)</span>
</span><span id="LiveStreamDownloader.move_to_final-561"><a href="#LiveStreamDownloader.move_to_final-561"><span class="linenos">561</span></a><span class="sd">            except Exception as e:</span>
</span><span id="LiveStreamDownloader.move_to_final-562"><a href="#LiveStreamDownloader.move_to_final-562"><span class="linenos">562</span></a><span class="sd">                self.logger.exception(f&quot;Error removing temp folder: {e}&quot;)</span>
</span><span id="LiveStreamDownloader.move_to_final-563"><a href="#LiveStreamDownloader.move_to_final-563"><span class="linenos">563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader.move_to_final-564"><a href="#LiveStreamDownloader.move_to_final-564"><span class="linenos">564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished moving files from temporary directory to output destination&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.download_live_chat" class="classattr">
                                        <input id="LiveStreamDownloader.download_live_chat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_live_chat</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">info_dict</span>, </span><span class="param"><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.download_live_chat-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.download_live_chat"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.download_live_chat-566"><a href="#LiveStreamDownloader.download_live_chat-566"><span class="linenos">566</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_live_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_live_chat-567"><a href="#LiveStreamDownloader.download_live_chat-567"><span class="linenos">567</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-568"><a href="#LiveStreamDownloader.download_live_chat-568"><span class="linenos">568</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-569"><a href="#LiveStreamDownloader.download_live_chat-569"><span class="linenos">569</span></a>        <span class="n">base_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader.download_live_chat-570"><a href="#LiveStreamDownloader.download_live_chat-570"><span class="linenos">570</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-571"><a href="#LiveStreamDownloader.download_live_chat-571"><span class="linenos">571</span></a>        <span class="k">class</span><span class="w"> </span><span class="nc">YTDLP_Chat_logger</span><span class="p">(</span><span class="n">YTDLPLogger</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_live_chat-572"><a href="#LiveStreamDownloader.download_live_chat-572"><span class="linenos">572</span></a>            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-573"><a href="#LiveStreamDownloader.download_live_chat-573"><span class="linenos">573</span></a>                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-574"><a href="#LiveStreamDownloader.download_live_chat-574"><span class="linenos">574</span></a>                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_live_chat-575"><a href="#LiveStreamDownloader.download_live_chat-575"><span class="linenos">575</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-576"><a href="#LiveStreamDownloader.download_live_chat-576"><span class="linenos">576</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-577"><a href="#LiveStreamDownloader.download_live_chat-577"><span class="linenos">577</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_live_chat-578"><a href="#LiveStreamDownloader.download_live_chat-578"><span class="linenos">578</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[live-chat] &quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_live_chat-579"><a href="#LiveStreamDownloader.download_live_chat-579"><span class="linenos">579</span></a>                    <span class="k">return</span> <span class="n">msg</span>
</span><span id="LiveStreamDownloader.download_live_chat-580"><a href="#LiveStreamDownloader.download_live_chat-580"><span class="linenos">580</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[live-chat] </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.download_live_chat-581"><a href="#LiveStreamDownloader.download_live_chat-581"><span class="linenos">581</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-582"><a href="#LiveStreamDownloader.download_live_chat-582"><span class="linenos">582</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-583"><a href="#LiveStreamDownloader.download_live_chat-583"><span class="linenos">583</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_live_chat-584"><a href="#LiveStreamDownloader.download_live_chat-584"><span class="linenos">584</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-585"><a href="#LiveStreamDownloader.download_live_chat-585"><span class="linenos">585</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-586"><a href="#LiveStreamDownloader.download_live_chat-586"><span class="linenos">586</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_live_chat-587"><a href="#LiveStreamDownloader.download_live_chat-587"><span class="linenos">587</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-588"><a href="#LiveStreamDownloader.download_live_chat-588"><span class="linenos">588</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-589"><a href="#LiveStreamDownloader.download_live_chat-589"><span class="linenos">589</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_live_chat-590"><a href="#LiveStreamDownloader.download_live_chat-590"><span class="linenos">590</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-591"><a href="#LiveStreamDownloader.download_live_chat-591"><span class="linenos">591</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-592"><a href="#LiveStreamDownloader.download_live_chat-592"><span class="linenos">592</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_live_chat-593"><a href="#LiveStreamDownloader.download_live_chat-593"><span class="linenos">593</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-594"><a href="#LiveStreamDownloader.download_live_chat-594"><span class="linenos">594</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
</span><span id="LiveStreamDownloader.download_live_chat-595"><a href="#LiveStreamDownloader.download_live_chat-595"><span class="linenos">595</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-596"><a href="#LiveStreamDownloader.download_live_chat-596"><span class="linenos">596</span></a>        <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LiveStreamDownloader.download_live_chat-597"><a href="#LiveStreamDownloader.download_live_chat-597"><span class="linenos">597</span></a>            <span class="s2">&quot;skip_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Skip downloading video/audio</span>
</span><span id="LiveStreamDownloader.download_live_chat-598"><a href="#LiveStreamDownloader.download_live_chat-598"><span class="linenos">598</span></a>            <span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="n">YTDLP_Chat_logger</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_live_chat-599"><a href="#LiveStreamDownloader.download_live_chat-599"><span class="linenos">599</span></a>            <span class="c1">#&#39;quiet&#39;: True,</span>
</span><span id="LiveStreamDownloader.download_live_chat-600"><a href="#LiveStreamDownloader.download_live_chat-600"><span class="linenos">600</span></a>            <span class="s2">&quot;cookiefile&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cookies&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_live_chat-601"><a href="#LiveStreamDownloader.download_live_chat-601"><span class="linenos">601</span></a>            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_live_chat-602"><a href="#LiveStreamDownloader.download_live_chat-602"><span class="linenos">602</span></a>            <span class="s2">&quot;concurrent_fragment_downloads&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_live_chat-603"><a href="#LiveStreamDownloader.download_live_chat-603"><span class="linenos">603</span></a>            <span class="c1">#&#39;live_from_start&#39;: True,</span>
</span><span id="LiveStreamDownloader.download_live_chat-604"><a href="#LiveStreamDownloader.download_live_chat-604"><span class="linenos">604</span></a>            <span class="s2">&quot;writesubtitles&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Extract subtitles (live chat)</span>
</span><span id="LiveStreamDownloader.download_live_chat-605"><a href="#LiveStreamDownloader.download_live_chat-605"><span class="linenos">605</span></a>            <span class="s2">&quot;subtitlesformat&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>  <span class="c1"># Set format to JSON</span>
</span><span id="LiveStreamDownloader.download_live_chat-606"><a href="#LiveStreamDownloader.download_live_chat-606"><span class="linenos">606</span></a>            <span class="s2">&quot;subtitleslangs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;live_chat&quot;</span><span class="p">],</span>  <span class="c1"># Only extract live chat subtitles</span>
</span><span id="LiveStreamDownloader.download_live_chat-607"><a href="#LiveStreamDownloader.download_live_chat-607"><span class="linenos">607</span></a>            <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="n">base_output</span><span class="p">,</span>  <span class="c1"># Save to a JSON file</span>
</span><span id="LiveStreamDownloader.download_live_chat-608"><a href="#LiveStreamDownloader.download_live_chat-608"><span class="linenos">608</span></a>        <span class="p">}</span>
</span><span id="LiveStreamDownloader.download_live_chat-609"><a href="#LiveStreamDownloader.download_live_chat-609"><span class="linenos">609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ytdlp_options&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="LiveStreamDownloader.download_live_chat-610"><a href="#LiveStreamDownloader.download_live_chat-610"><span class="linenos">610</span></a>        <span class="n">ydl_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ytdlp_options&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="LiveStreamDownloader.download_live_chat-611"><a href="#LiveStreamDownloader.download_live_chat-611"><span class="linenos">611</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-612"><a href="#LiveStreamDownloader.download_live_chat-612"><span class="linenos">612</span></a>        <span class="n">livechat_filename</span> <span class="o">=</span> <span class="n">base_output</span> <span class="o">+</span> <span class="s2">&quot;.live_chat.json&quot;</span>
</span><span id="LiveStreamDownloader.download_live_chat-613"><a href="#LiveStreamDownloader.download_live_chat-613"><span class="linenos">613</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-614"><a href="#LiveStreamDownloader.download_live_chat-614"><span class="linenos">614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading live chat to: </span><span class="si">{</span><span class="n">livechat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-615"><a href="#LiveStreamDownloader.download_live_chat-615"><span class="linenos">615</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-616"><a href="#LiveStreamDownloader.download_live_chat-616"><span class="linenos">616</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-617"><a href="#LiveStreamDownloader.download_live_chat-617"><span class="linenos">617</span></a>        <span class="n">part_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">livechat_filename</span><span class="si">}</span><span class="s2">.part&quot;</span>
</span><span id="LiveStreamDownloader.download_live_chat-618"><a href="#LiveStreamDownloader.download_live_chat-618"><span class="linenos">618</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">part_file</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_live_chat-619"><a href="#LiveStreamDownloader.download_live_chat-619"><span class="linenos">619</span></a>            <span class="c1"># Append part to</span>
</span><span id="LiveStreamDownloader.download_live_chat-620"><a href="#LiveStreamDownloader.download_live_chat-620"><span class="linenos">620</span></a>            <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># number of characters per chunk, up to 10M characters</span>
</span><span id="LiveStreamDownloader.download_live_chat-621"><a href="#LiveStreamDownloader.download_live_chat-621"><span class="linenos">621</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">part_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fa</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fb</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-622"><a href="#LiveStreamDownloader.download_live_chat-622"><span class="linenos">622</span></a>                <span class="k">while</span> <span class="n">chunk</span> <span class="o">:=</span> <span class="n">fa</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_live_chat-623"><a href="#LiveStreamDownloader.download_live_chat-623"><span class="linenos">623</span></a>                    <span class="n">fb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-624"><a href="#LiveStreamDownloader.download_live_chat-624"><span class="linenos">624</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">livechat_filename</span><span class="si">}</span><span class="s2">.part&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-625"><a href="#LiveStreamDownloader.download_live_chat-625"><span class="linenos">625</span></a>
</span><span id="LiveStreamDownloader.download_live_chat-626"><a href="#LiveStreamDownloader.download_live_chat-626"><span class="linenos">626</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-627"><a href="#LiveStreamDownloader.download_live_chat-627"><span class="linenos">627</span></a>            <span class="n">zip_filename</span> <span class="o">=</span> <span class="n">base_output</span> <span class="o">+</span> <span class="s2">&quot;.live_chat.zip&quot;</span>
</span><span id="LiveStreamDownloader.download_live_chat-628"><a href="#LiveStreamDownloader.download_live_chat-628"><span class="linenos">628</span></a>            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_live_chat-629"><a href="#LiveStreamDownloader.download_live_chat-629"><span class="linenos">629</span></a>                <span class="n">zip_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">allowZip64</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LiveStreamDownloader.download_live_chat-630"><a href="#LiveStreamDownloader.download_live_chat-630"><span class="linenos">630</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-631"><a href="#LiveStreamDownloader.download_live_chat-631"><span class="linenos">631</span></a>                <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_live_chat-632"><a href="#LiveStreamDownloader.download_live_chat-632"><span class="linenos">632</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">livechat_filename</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-633"><a href="#LiveStreamDownloader.download_live_chat-633"><span class="linenos">633</span></a>            <span class="n">live_chat</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;live_chat&quot;</span><span class="p">:</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">zip_filename</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;live_chat&quot;</span><span class="p">)}</span>
</span><span id="LiveStreamDownloader.download_live_chat-634"><a href="#LiveStreamDownloader.download_live_chat-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">live_chat</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_live_chat-635"><a href="#LiveStreamDownloader.download_live_chat-635"><span class="linenos">635</span></a>            <span class="k">return</span> <span class="n">live_chat</span><span class="p">,</span> <span class="s2">&quot;live_chat&quot;</span>
</span><span id="LiveStreamDownloader.download_live_chat-636"><a href="#LiveStreamDownloader.download_live_chat-636"><span class="linenos">636</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_live_chat-637"><a href="#LiveStreamDownloader.download_live_chat-637"><span class="linenos">637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[31m</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.replace_ip_in_json" class="classattr">
                                        <input id="LiveStreamDownloader.replace_ip_in_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">replace_ip_in_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_name</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.replace_ip_in_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.replace_ip_in_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.replace_ip_in_json-639"><a href="#LiveStreamDownloader.replace_ip_in_json-639"><span class="linenos">639</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">replace_ip_in_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.replace_ip_in_json-640"><a href="#LiveStreamDownloader.replace_ip_in_json-640"><span class="linenos">640</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;((?:[0-9]{1,3}\.)</span><span class="si">{3}</span><span class="s2">[0-9]{1,3})|((?:[a-f0-9]{1,4}:)</span><span class="si">{7}</span><span class="s2">[a-f0-9]{1,4})&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.replace_ip_in_json-641"><a href="#LiveStreamDownloader.replace_ip_in_json-641"><span class="linenos">641</span></a>
</span><span id="LiveStreamDownloader.replace_ip_in_json-642"><a href="#LiveStreamDownloader.replace_ip_in_json-642"><span class="linenos">642</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.replace_ip_in_json-643"><a href="#LiveStreamDownloader.replace_ip_in_json-643"><span class="linenos">643</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.replace_ip_in_json-644"><a href="#LiveStreamDownloader.replace_ip_in_json-644"><span class="linenos">644</span></a>
</span><span id="LiveStreamDownloader.replace_ip_in_json-645"><a href="#LiveStreamDownloader.replace_ip_in_json-645"><span class="linenos">645</span></a>        <span class="n">modified_content</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.replace_ip_in_json-646"><a href="#LiveStreamDownloader.replace_ip_in_json-646"><span class="linenos">646</span></a>
</span><span id="LiveStreamDownloader.replace_ip_in_json-647"><a href="#LiveStreamDownloader.replace_ip_in_json-647"><span class="linenos">647</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.replace_ip_in_json-648"><a href="#LiveStreamDownloader.replace_ip_in_json-648"><span class="linenos">648</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">modified_content</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.remove_urls_from_json" class="classattr">
                                        <input id="LiveStreamDownloader.remove_urls_from_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_urls_from_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_name</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.remove_urls_from_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.remove_urls_from_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.remove_urls_from_json-650"><a href="#LiveStreamDownloader.remove_urls_from_json-650"><span class="linenos">650</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_urls_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-651"><a href="#LiveStreamDownloader.remove_urls_from_json-651"><span class="linenos">651</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-652"><a href="#LiveStreamDownloader.remove_urls_from_json-652"><span class="linenos">652</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-653"><a href="#LiveStreamDownloader.remove_urls_from_json-653"><span class="linenos">653</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-654"><a href="#LiveStreamDownloader.remove_urls_from_json-654"><span class="linenos">654</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;formats&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-655"><a href="#LiveStreamDownloader.remove_urls_from_json-655"><span class="linenos">655</span></a>            <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;formats&quot;</span><span class="p">]:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-656"><a href="#LiveStreamDownloader.remove_urls_from_json-656"><span class="linenos">656</span></a>                <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-657"><a href="#LiveStreamDownloader.remove_urls_from_json-657"><span class="linenos">657</span></a>                    <span class="nb">format</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-658"><a href="#LiveStreamDownloader.remove_urls_from_json-658"><span class="linenos">658</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-659"><a href="#LiveStreamDownloader.remove_urls_from_json-659"><span class="linenos">659</span></a>                <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-660"><a href="#LiveStreamDownloader.remove_urls_from_json-660"><span class="linenos">660</span></a>                    <span class="nb">format</span><span class="p">[</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-661"><a href="#LiveStreamDownloader.remove_urls_from_json-661"><span class="linenos">661</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-662"><a href="#LiveStreamDownloader.remove_urls_from_json-662"><span class="linenos">662</span></a>                <span class="nb">format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fragment_base_url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-663"><a href="#LiveStreamDownloader.remove_urls_from_json-663"><span class="linenos">663</span></a>                <span class="nb">format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fragments&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-664"><a href="#LiveStreamDownloader.remove_urls_from_json-664"><span class="linenos">664</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-665"><a href="#LiveStreamDownloader.remove_urls_from_json-665"><span class="linenos">665</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-666"><a href="#LiveStreamDownloader.remove_urls_from_json-666"><span class="linenos">666</span></a>            <span class="k">for</span> <span class="n">thumbnail</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">]:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-667"><a href="#LiveStreamDownloader.remove_urls_from_json-667"><span class="linenos">667</span></a>                <span class="k">if</span> <span class="n">thumbnail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-668"><a href="#LiveStreamDownloader.remove_urls_from_json-668"><span class="linenos">668</span></a>                    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">thumbnail</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-669"><a href="#LiveStreamDownloader.remove_urls_from_json-669"><span class="linenos">669</span></a>                    <span class="n">thumbnail</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span><span class="si">}{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-670"><a href="#LiveStreamDownloader.remove_urls_from_json-670"><span class="linenos">670</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-671"><a href="#LiveStreamDownloader.remove_urls_from_json-671"><span class="linenos">671</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-672"><a href="#LiveStreamDownloader.remove_urls_from_json-672"><span class="linenos">672</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-673"><a href="#LiveStreamDownloader.remove_urls_from_json-673"><span class="linenos">673</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-674"><a href="#LiveStreamDownloader.remove_urls_from_json-674"><span class="linenos">674</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-675"><a href="#LiveStreamDownloader.remove_urls_from_json-675"><span class="linenos">675</span></a>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;manifest_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://www.youtube.com/watch?v=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-676"><a href="#LiveStreamDownloader.remove_urls_from_json-676"><span class="linenos">676</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-677"><a href="#LiveStreamDownloader.remove_urls_from_json-677"><span class="linenos">677</span></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;removed_urls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-678"><a href="#LiveStreamDownloader.remove_urls_from_json-678"><span class="linenos">678</span></a>
</span><span id="LiveStreamDownloader.remove_urls_from_json-679"><a href="#LiveStreamDownloader.remove_urls_from_json-679"><span class="linenos">679</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_urls_from_json-680"><a href="#LiveStreamDownloader.remove_urls_from_json-680"><span class="linenos">680</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.download_auxiliary_files" class="classattr">
                                        <input id="LiveStreamDownloader.download_auxiliary_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">download_auxiliary_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">info_dict</span>, </span><span class="param"><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.download_auxiliary_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.download_auxiliary_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.download_auxiliary_files-682"><a href="#LiveStreamDownloader.download_auxiliary_files-682"><span class="linenos">682</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download_auxiliary_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-683"><a href="#LiveStreamDownloader.download_auxiliary_files-683"><span class="linenos">683</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-684"><a href="#LiveStreamDownloader.download_auxiliary_files-684"><span class="linenos">684</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-685"><a href="#LiveStreamDownloader.download_auxiliary_files-685"><span class="linenos">685</span></a>        <span class="n">base_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-686"><a href="#LiveStreamDownloader.download_auxiliary_files-686"><span class="linenos">686</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-687"><a href="#LiveStreamDownloader.download_auxiliary_files-687"><span class="linenos">687</span></a>        <span class="n">created_files</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-688"><a href="#LiveStreamDownloader.download_auxiliary_files-688"><span class="linenos">688</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-689"><a href="#LiveStreamDownloader.download_auxiliary_files-689"><span class="linenos">689</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-690"><a href="#LiveStreamDownloader.download_auxiliary_files-690"><span class="linenos">690</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-691"><a href="#LiveStreamDownloader.download_auxiliary_files-691"><span class="linenos">691</span></a>        <span class="k">class</span><span class="w"> </span><span class="nc">YTDLP_Auxiliary_logger</span><span class="p">(</span><span class="n">YTDLPLogger</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-692"><a href="#LiveStreamDownloader.download_auxiliary_files-692"><span class="linenos">692</span></a>            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-693"><a href="#LiveStreamDownloader.download_auxiliary_files-693"><span class="linenos">693</span></a>                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-694"><a href="#LiveStreamDownloader.download_auxiliary_files-694"><span class="linenos">694</span></a>                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-695"><a href="#LiveStreamDownloader.download_auxiliary_files-695"><span class="linenos">695</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-696"><a href="#LiveStreamDownloader.download_auxiliary_files-696"><span class="linenos">696</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-697"><a href="#LiveStreamDownloader.download_auxiliary_files-697"><span class="linenos">697</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-698"><a href="#LiveStreamDownloader.download_auxiliary_files-698"><span class="linenos">698</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[live-chat] &quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-699"><a href="#LiveStreamDownloader.download_auxiliary_files-699"><span class="linenos">699</span></a>                    <span class="k">return</span> <span class="n">msg</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-700"><a href="#LiveStreamDownloader.download_auxiliary_files-700"><span class="linenos">700</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[live-chat] </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-701"><a href="#LiveStreamDownloader.download_auxiliary_files-701"><span class="linenos">701</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-702"><a href="#LiveStreamDownloader.download_auxiliary_files-702"><span class="linenos">702</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-703"><a href="#LiveStreamDownloader.download_auxiliary_files-703"><span class="linenos">703</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-704"><a href="#LiveStreamDownloader.download_auxiliary_files-704"><span class="linenos">704</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-705"><a href="#LiveStreamDownloader.download_auxiliary_files-705"><span class="linenos">705</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-706"><a href="#LiveStreamDownloader.download_auxiliary_files-706"><span class="linenos">706</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-707"><a href="#LiveStreamDownloader.download_auxiliary_files-707"><span class="linenos">707</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-708"><a href="#LiveStreamDownloader.download_auxiliary_files-708"><span class="linenos">708</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-709"><a href="#LiveStreamDownloader.download_auxiliary_files-709"><span class="linenos">709</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-710"><a href="#LiveStreamDownloader.download_auxiliary_files-710"><span class="linenos">710</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-711"><a href="#LiveStreamDownloader.download_auxiliary_files-711"><span class="linenos">711</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-712"><a href="#LiveStreamDownloader.download_auxiliary_files-712"><span class="linenos">712</span></a>                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-713"><a href="#LiveStreamDownloader.download_auxiliary_files-713"><span class="linenos">713</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-714"><a href="#LiveStreamDownloader.download_auxiliary_files-714"><span class="linenos">714</span></a>        <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-715"><a href="#LiveStreamDownloader.download_auxiliary_files-715"><span class="linenos">715</span></a>            <span class="s2">&quot;skip_download&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-716"><a href="#LiveStreamDownloader.download_auxiliary_files-716"><span class="linenos">716</span></a>            <span class="s2">&quot;quiet&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-717"><a href="#LiveStreamDownloader.download_auxiliary_files-717"><span class="linenos">717</span></a>            <span class="c1">#        &#39;cookiefile&#39;: options.get(&#39;cookies&#39;, None),</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-718"><a href="#LiveStreamDownloader.download_auxiliary_files-718"><span class="linenos">718</span></a>            <span class="s2">&quot;writeinfojson&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_info_json&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-719"><a href="#LiveStreamDownloader.download_auxiliary_files-719"><span class="linenos">719</span></a>            <span class="s2">&quot;writedescription&quot;</span><span class="p">:</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_description&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-720"><a href="#LiveStreamDownloader.download_auxiliary_files-720"><span class="linenos">720</span></a>            <span class="s2">&quot;writethumbnail&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_thumbnail&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embed_thumbnail&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-721"><a href="#LiveStreamDownloader.download_auxiliary_files-721"><span class="linenos">721</span></a>            <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="n">base_output</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-722"><a href="#LiveStreamDownloader.download_auxiliary_files-722"><span class="linenos">722</span></a>            <span class="s2">&quot;retries&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-723"><a href="#LiveStreamDownloader.download_auxiliary_files-723"><span class="linenos">723</span></a>            <span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="n">YTDLPLogger</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-724"><a href="#LiveStreamDownloader.download_auxiliary_files-724"><span class="linenos">724</span></a>        <span class="p">}</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-725"><a href="#LiveStreamDownloader.download_auxiliary_files-725"><span class="linenos">725</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-726"><a href="#LiveStreamDownloader.download_auxiliary_files-726"><span class="linenos">726</span></a>            <span class="n">ydl_opts</span><span class="p">[</span><span class="s2">&quot;proxy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">((</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;proxy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-727"><a href="#LiveStreamDownloader.download_auxiliary_files-727"><span class="linenos">727</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-728"><a href="#LiveStreamDownloader.download_auxiliary_files-728"><span class="linenos">728</span></a>        <span class="k">with</span> <span class="n">YoutubeDL</span><span class="p">(</span><span class="n">ydl_opts</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-729"><a href="#LiveStreamDownloader.download_auxiliary_files-729"><span class="linenos">729</span></a>            <span class="c1"># base_name = ydl.prepare_filename(info_dict)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-730"><a href="#LiveStreamDownloader.download_auxiliary_files-730"><span class="linenos">730</span></a>            <span class="c1"># result = ydl.download_with_info_file(info_dict)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-731"><a href="#LiveStreamDownloader.download_auxiliary_files-731"><span class="linenos">731</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-732"><a href="#LiveStreamDownloader.download_auxiliary_files-732"><span class="linenos">732</span></a>            <span class="k">if</span> <span class="n">ydl</span><span class="o">.</span><span class="n">_write_info_json</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;infojson&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-733"><a href="#LiveStreamDownloader.download_auxiliary_files-733"><span class="linenos">733</span></a>                <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;infojson&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-734"><a href="#LiveStreamDownloader.download_auxiliary_files-734"><span class="linenos">734</span></a>            <span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-735"><a href="#LiveStreamDownloader.download_auxiliary_files-735"><span class="linenos">735</span></a>                <span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;info_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-736"><a href="#LiveStreamDownloader.download_auxiliary_files-736"><span class="linenos">736</span></a>                    <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;infojson&quot;</span><span class="p">),</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;info_json&quot;</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-737"><a href="#LiveStreamDownloader.download_auxiliary_files-737"><span class="linenos">737</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-738"><a href="#LiveStreamDownloader.download_auxiliary_files-738"><span class="linenos">738</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-739"><a href="#LiveStreamDownloader.download_auxiliary_files-739"><span class="linenos">739</span></a>                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remove_ip_from_json&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-740"><a href="#LiveStreamDownloader.download_auxiliary_files-740"><span class="linenos">740</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">replace_ip_in_json</span><span class="p">(</span><span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;info_json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-741"><a href="#LiveStreamDownloader.download_auxiliary_files-741"><span class="linenos">741</span></a>                    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;clean_urls&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-742"><a href="#LiveStreamDownloader.download_auxiliary_files-742"><span class="linenos">742</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_urls_from_json</span><span class="p">(</span><span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;info_json&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-743"><a href="#LiveStreamDownloader.download_auxiliary_files-743"><span class="linenos">743</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-744"><a href="#LiveStreamDownloader.download_auxiliary_files-744"><span class="linenos">744</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-745"><a href="#LiveStreamDownloader.download_auxiliary_files-745"><span class="linenos">745</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-746"><a href="#LiveStreamDownloader.download_auxiliary_files-746"><span class="linenos">746</span></a>            <span class="k">if</span> <span class="n">ydl</span><span class="o">.</span><span class="n">_write_description</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-747"><a href="#LiveStreamDownloader.download_auxiliary_files-747"><span class="linenos">747</span></a>                <span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-748"><a href="#LiveStreamDownloader.download_auxiliary_files-748"><span class="linenos">748</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-749"><a href="#LiveStreamDownloader.download_auxiliary_files-749"><span class="linenos">749</span></a>                <span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-750"><a href="#LiveStreamDownloader.download_auxiliary_files-750"><span class="linenos">750</span></a>                    <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">),</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;description&quot;</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-751"><a href="#LiveStreamDownloader.download_auxiliary_files-751"><span class="linenos">751</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-752"><a href="#LiveStreamDownloader.download_auxiliary_files-752"><span class="linenos">752</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-753"><a href="#LiveStreamDownloader.download_auxiliary_files-753"><span class="linenos">753</span></a>            <span class="n">thumbnails</span> <span class="o">=</span> <span class="n">ydl</span><span class="o">.</span><span class="n">_write_thumbnails</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">ydl</span><span class="o">.</span><span class="n">prepare_filename</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="s2">&quot;thumbnail&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-754"><a href="#LiveStreamDownloader.download_auxiliary_files-754"><span class="linenos">754</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-755"><a href="#LiveStreamDownloader.download_auxiliary_files-755"><span class="linenos">755</span></a>            <span class="k">if</span> <span class="n">thumbnails</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-756"><a href="#LiveStreamDownloader.download_auxiliary_files-756"><span class="linenos">756</span></a>                <span class="n">created_files</span><span class="p">[</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">thumbnails</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.download_auxiliary_files-757"><a href="#LiveStreamDownloader.download_auxiliary_files-757"><span class="linenos">757</span></a>
</span><span id="LiveStreamDownloader.download_auxiliary_files-758"><a href="#LiveStreamDownloader.download_auxiliary_files-758"><span class="linenos">758</span></a>        <span class="k">return</span> <span class="n">created_files</span><span class="p">,</span> <span class="s2">&quot;auxiliary&quot;</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.create_mp4" class="classattr">
                                        <input id="LiveStreamDownloader.create_mp4-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_mp4</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_names</span>, </span><span class="param"><span class="n">info_dict</span>, </span><span class="param"><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.create_mp4-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.create_mp4"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.create_mp4-760"><a href="#LiveStreamDownloader.create_mp4-760"><span class="linenos">760</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_mp4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-761"><a href="#LiveStreamDownloader.create_mp4-761"><span class="linenos">761</span></a>        <span class="c1"># self.logger.debug(&quot;Files: {0}&quot;.format(json.dumps(file_names)))</span>
</span><span id="LiveStreamDownloader.create_mp4-762"><a href="#LiveStreamDownloader.create_mp4-762"><span class="linenos">762</span></a>        <span class="n">stream_manifests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="LiveStreamDownloader.create_mp4-763"><a href="#LiveStreamDownloader.create_mp4-763"><span class="linenos">763</span></a>        <span class="k">for</span> <span class="n">manifest</span><span class="p">,</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">stream_manifests</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-764"><a href="#LiveStreamDownloader.create_mp4-764"><span class="linenos">764</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LiveStreamDownloader.create_mp4-765"><a href="#LiveStreamDownloader.create_mp4-765"><span class="linenos">765</span></a>            <span class="n">thumbnail</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.create_mp4-766"><a href="#LiveStreamDownloader.create_mp4-766"><span class="linenos">766</span></a>            <span class="n">video</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="LiveStreamDownloader.create_mp4-767"><a href="#LiveStreamDownloader.create_mp4-767"><span class="linenos">767</span></a>            <span class="n">ext</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-768"><a href="#LiveStreamDownloader.create_mp4-768"><span class="linenos">768</span></a>
</span><span id="LiveStreamDownloader.create_mp4-769"><a href="#LiveStreamDownloader.create_mp4-769"><span class="linenos">769</span></a>            <span class="n">ffmpeg_builder</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ffmpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;-y&quot;</span><span class="p">,</span> <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span> <span class="s2">&quot;-nostdin&quot;</span><span class="p">,</span> <span class="s2">&quot;-loglevel&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;-stats&quot;</span><span class="p">]</span>
</span><span id="LiveStreamDownloader.create_mp4-770"><a href="#LiveStreamDownloader.create_mp4-770"><span class="linenos">770</span></a>
</span><span id="LiveStreamDownloader.create_mp4-771"><a href="#LiveStreamDownloader.create_mp4-771"><span class="linenos">771</span></a>            <span class="c1"># Add input files</span>
</span><span id="LiveStreamDownloader.create_mp4-772"><a href="#LiveStreamDownloader.create_mp4-772"><span class="linenos">772</span></a>            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-773"><a href="#LiveStreamDownloader.create_mp4-773"><span class="linenos">773</span></a>                <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-thread_queue_size&quot;</span><span class="p">,</span> <span class="s2">&quot;1024&quot;</span><span class="p">,</span> <span class="s2">&quot;-seekable&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())]</span>
</span><span id="LiveStreamDownloader.create_mp4-774"><a href="#LiveStreamDownloader.create_mp4-774"><span class="linenos">774</span></a>                <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-775"><a href="#LiveStreamDownloader.create_mp4-775"><span class="linenos">775</span></a>                <span class="n">video</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="LiveStreamDownloader.create_mp4-776"><a href="#LiveStreamDownloader.create_mp4-776"><span class="linenos">776</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader.create_mp4-777"><a href="#LiveStreamDownloader.create_mp4-777"><span class="linenos">777</span></a>
</span><span id="LiveStreamDownloader.create_mp4-778"><a href="#LiveStreamDownloader.create_mp4-778"><span class="linenos">778</span></a>            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-779"><a href="#LiveStreamDownloader.create_mp4-779"><span class="linenos">779</span></a>                <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-thread_queue_size&quot;</span><span class="p">,</span> <span class="s2">&quot;1024&quot;</span><span class="p">,</span> <span class="s2">&quot;-seekable&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())]</span>
</span><span id="LiveStreamDownloader.create_mp4-780"><a href="#LiveStreamDownloader.create_mp4-780"><span class="linenos">780</span></a>                <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-781"><a href="#LiveStreamDownloader.create_mp4-781"><span class="linenos">781</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader.create_mp4-782"><a href="#LiveStreamDownloader.create_mp4-782"><span class="linenos">782</span></a>                <span class="k">if</span> <span class="n">video</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-783"><a href="#LiveStreamDownloader.create_mp4-783"><span class="linenos">783</span></a>                    <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.mka&quot;</span>
</span><span id="LiveStreamDownloader.create_mp4-784"><a href="#LiveStreamDownloader.create_mp4-784"><span class="linenos">784</span></a>
</span><span id="LiveStreamDownloader.create_mp4-785"><a href="#LiveStreamDownloader.create_mp4-785"><span class="linenos">785</span></a>            <span class="c1"># Determine output path</span>
</span><span id="LiveStreamDownloader.create_mp4-786"><a href="#LiveStreamDownloader.create_mp4-786"><span class="linenos">786</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-787"><a href="#LiveStreamDownloader.create_mp4-787"><span class="linenos">787</span></a>
</span><span id="LiveStreamDownloader.create_mp4-788"><a href="#LiveStreamDownloader.create_mp4-788"><span class="linenos">788</span></a>            <span class="n">base_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;temp_folder&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
</span><span id="LiveStreamDownloader.create_mp4-789"><a href="#LiveStreamDownloader.create_mp4-789"><span class="linenos">789</span></a>
</span><span id="LiveStreamDownloader.create_mp4-790"><a href="#LiveStreamDownloader.create_mp4-790"><span class="linenos">790</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_manifests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-791"><a href="#LiveStreamDownloader.create_mp4-791"><span class="linenos">791</span></a>                <span class="n">base_output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_output</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">manifest</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.create_mp4-792"><a href="#LiveStreamDownloader.create_mp4-792"><span class="linenos">792</span></a>
</span><span id="LiveStreamDownloader.create_mp4-793"><a href="#LiveStreamDownloader.create_mp4-793"><span class="linenos">793</span></a>            <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-794"><a href="#LiveStreamDownloader.create_mp4-794"><span class="linenos">794</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No extension detected, switching to yt-dlp decided video (defaulting to MP4)&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-795"><a href="#LiveStreamDownloader.create_mp4-795"><span class="linenos">795</span></a>                <span class="n">ext</span> <span class="o">=</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-796"><a href="#LiveStreamDownloader.create_mp4-796"><span class="linenos">796</span></a>            <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-797"><a href="#LiveStreamDownloader.create_mp4-797"><span class="linenos">797</span></a>                <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-798"><a href="#LiveStreamDownloader.create_mp4-798"><span class="linenos">798</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">base_output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-799"><a href="#LiveStreamDownloader.create_mp4-799"><span class="linenos">799</span></a>                <span class="n">base_output</span> <span class="o">=</span> <span class="n">base_output</span> <span class="o">+</span> <span class="n">ext</span>
</span><span id="LiveStreamDownloader.create_mp4-800"><a href="#LiveStreamDownloader.create_mp4-800"><span class="linenos">800</span></a>
</span><span id="LiveStreamDownloader.create_mp4-801"><a href="#LiveStreamDownloader.create_mp4-801"><span class="linenos">801</span></a>            <span class="k">if</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;embed_thumbnail&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-802"><a href="#LiveStreamDownloader.create_mp4-802"><span class="linenos">802</span></a>                <span class="k">if</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="LiveStreamDownloader.create_mp4-803"><a href="#LiveStreamDownloader.create_mp4-803"><span class="linenos">803</span></a>                    <span class="c1"># Use &quot;guess_file_type&quot; if function exists (added in 3.13), otherwise fall back to depreciated version</span>
</span><span id="LiveStreamDownloader.create_mp4-804"><a href="#LiveStreamDownloader.create_mp4-804"><span class="linenos">804</span></a>                    <span class="n">guess</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mimetypes</span><span class="p">,</span> <span class="s2">&quot;guess_file_type&quot;</span><span class="p">,</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-805"><a href="#LiveStreamDownloader.create_mp4-805"><span class="linenos">805</span></a>
</span><span id="LiveStreamDownloader.create_mp4-806"><a href="#LiveStreamDownloader.create_mp4-806"><span class="linenos">806</span></a>                    <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.create_mp4-807"><a href="#LiveStreamDownloader.create_mp4-807"><span class="linenos">807</span></a>
</span><span id="LiveStreamDownloader.create_mp4-808"><a href="#LiveStreamDownloader.create_mp4-808"><span class="linenos">808</span></a>                    <span class="c1"># If not jpeg or png, convert to png</span>
</span><span id="LiveStreamDownloader.create_mp4-809"><a href="#LiveStreamDownloader.create_mp4-809"><span class="linenos">809</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">mime_type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;image/png&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-810"><a href="#LiveStreamDownloader.create_mp4-810"><span class="linenos">810</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-811"><a href="#LiveStreamDownloader.create_mp4-811"><span class="linenos">811</span></a>                            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a JPG or PNG file, converting to png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-812"><a href="#LiveStreamDownloader.create_mp4-812"><span class="linenos">812</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-813"><a href="#LiveStreamDownloader.create_mp4-813"><span class="linenos">813</span></a>                        <span class="n">png_thumbnail</span> <span class="o">=</span> <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-814"><a href="#LiveStreamDownloader.create_mp4-814"><span class="linenos">814</span></a>
</span><span id="LiveStreamDownloader.create_mp4-815"><a href="#LiveStreamDownloader.create_mp4-815"><span class="linenos">815</span></a>                        <span class="n">thumbnail_conversion</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LiveStreamDownloader.create_mp4-816"><a href="#LiveStreamDownloader.create_mp4-816"><span class="linenos">816</span></a>                            <span class="s2">&quot;ffmpeg&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-817"><a href="#LiveStreamDownloader.create_mp4-817"><span class="linenos">817</span></a>                            <span class="s2">&quot;-y&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-818"><a href="#LiveStreamDownloader.create_mp4-818"><span class="linenos">818</span></a>                            <span class="s2">&quot;-hide_banner&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-819"><a href="#LiveStreamDownloader.create_mp4-819"><span class="linenos">819</span></a>                            <span class="s2">&quot;-nostdin&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-820"><a href="#LiveStreamDownloader.create_mp4-820"><span class="linenos">820</span></a>                            <span class="s2">&quot;-loglevel&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-821"><a href="#LiveStreamDownloader.create_mp4-821"><span class="linenos">821</span></a>                            <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-822"><a href="#LiveStreamDownloader.create_mp4-822"><span class="linenos">822</span></a>                            <span class="s2">&quot;-stats&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-823"><a href="#LiveStreamDownloader.create_mp4-823"><span class="linenos">823</span></a>                            <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-824"><a href="#LiveStreamDownloader.create_mp4-824"><span class="linenos">824</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader.create_mp4-825"><a href="#LiveStreamDownloader.create_mp4-825"><span class="linenos">825</span></a>                            <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-826"><a href="#LiveStreamDownloader.create_mp4-826"><span class="linenos">826</span></a>                            <span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-827"><a href="#LiveStreamDownloader.create_mp4-827"><span class="linenos">827</span></a>                            <span class="s2">&quot;-compression_level&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-828"><a href="#LiveStreamDownloader.create_mp4-828"><span class="linenos">828</span></a>                            <span class="s2">&quot;9&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-829"><a href="#LiveStreamDownloader.create_mp4-829"><span class="linenos">829</span></a>                            <span class="s2">&quot;-pred&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-830"><a href="#LiveStreamDownloader.create_mp4-830"><span class="linenos">830</span></a>                            <span class="s2">&quot;mixed&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-831"><a href="#LiveStreamDownloader.create_mp4-831"><span class="linenos">831</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">png_thumbnail</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader.create_mp4-832"><a href="#LiveStreamDownloader.create_mp4-832"><span class="linenos">832</span></a>                        <span class="p">]</span>
</span><span id="LiveStreamDownloader.create_mp4-833"><a href="#LiveStreamDownloader.create_mp4-833"><span class="linenos">833</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-834"><a href="#LiveStreamDownloader.create_mp4-834"><span class="linenos">834</span></a>                            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-835"><a href="#LiveStreamDownloader.create_mp4-835"><span class="linenos">835</span></a>                                <span class="n">thumbnail_conversion</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-836"><a href="#LiveStreamDownloader.create_mp4-836"><span class="linenos">836</span></a>                                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-837"><a href="#LiveStreamDownloader.create_mp4-837"><span class="linenos">837</span></a>                                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-838"><a href="#LiveStreamDownloader.create_mp4-838"><span class="linenos">838</span></a>                                <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-839"><a href="#LiveStreamDownloader.create_mp4-839"><span class="linenos">839</span></a>                                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-840"><a href="#LiveStreamDownloader.create_mp4-840"><span class="linenos">840</span></a>                            <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-841"><a href="#LiveStreamDownloader.create_mp4-841"><span class="linenos">841</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Replacing thumbnail with .png version&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-842"><a href="#LiveStreamDownloader.create_mp4-842"><span class="linenos">842</span></a>                            <span class="n">file_names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-843"><a href="#LiveStreamDownloader.create_mp4-843"><span class="linenos">843</span></a>                            <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">png_thumbnail</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-844"><a href="#LiveStreamDownloader.create_mp4-844"><span class="linenos">844</span></a>
</span><span id="LiveStreamDownloader.create_mp4-845"><a href="#LiveStreamDownloader.create_mp4-845"><span class="linenos">845</span></a>                        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-846"><a href="#LiveStreamDownloader.create_mp4-846"><span class="linenos">846</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-847"><a href="#LiveStreamDownloader.create_mp4-847"><span class="linenos">847</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-848"><a href="#LiveStreamDownloader.create_mp4-848"><span class="linenos">848</span></a>
</span><span id="LiveStreamDownloader.create_mp4-849"><a href="#LiveStreamDownloader.create_mp4-849"><span class="linenos">849</span></a>                    <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="LiveStreamDownloader.create_mp4-850"><a href="#LiveStreamDownloader.create_mp4-850"><span class="linenos">850</span></a>                    <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;.mkv&quot;</span><span class="p">:</span>  <span class="c1"># Don&#39;t add input file for mkv, use attach later</span>
</span><span id="LiveStreamDownloader.create_mp4-851"><a href="#LiveStreamDownloader.create_mp4-851"><span class="linenos">851</span></a>                        <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LiveStreamDownloader.create_mp4-852"><a href="#LiveStreamDownloader.create_mp4-852"><span class="linenos">852</span></a>                            <span class="s2">&quot;-thread_queue_size&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-853"><a href="#LiveStreamDownloader.create_mp4-853"><span class="linenos">853</span></a>                            <span class="s2">&quot;1024&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-854"><a href="#LiveStreamDownloader.create_mp4-854"><span class="linenos">854</span></a>                            <span class="s2">&quot;-seekable&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-855"><a href="#LiveStreamDownloader.create_mp4-855"><span class="linenos">855</span></a>                            <span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-856"><a href="#LiveStreamDownloader.create_mp4-856"><span class="linenos">856</span></a>                            <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-857"><a href="#LiveStreamDownloader.create_mp4-857"><span class="linenos">857</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader.create_mp4-858"><a href="#LiveStreamDownloader.create_mp4-858"><span class="linenos">858</span></a>                        <span class="p">]</span>
</span><span id="LiveStreamDownloader.create_mp4-859"><a href="#LiveStreamDownloader.create_mp4-859"><span class="linenos">859</span></a>                        <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-860"><a href="#LiveStreamDownloader.create_mp4-860"><span class="linenos">860</span></a>                        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader.create_mp4-861"><a href="#LiveStreamDownloader.create_mp4-861"><span class="linenos">861</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-862"><a href="#LiveStreamDownloader.create_mp4-862"><span class="linenos">862</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-863"><a href="#LiveStreamDownloader.create_mp4-863"><span class="linenos">863</span></a>                        <span class="s2">&quot;Thumbnail file: </span><span class="si">{}</span><span class="s2"> is missing, continuing without embedding&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-864"><a href="#LiveStreamDownloader.create_mp4-864"><span class="linenos">864</span></a>                            <span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.create_mp4-865"><a href="#LiveStreamDownloader.create_mp4-865"><span class="linenos">865</span></a>                        <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-866"><a href="#LiveStreamDownloader.create_mp4-866"><span class="linenos">866</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-867"><a href="#LiveStreamDownloader.create_mp4-867"><span class="linenos">867</span></a>
</span><span id="LiveStreamDownloader.create_mp4-868"><a href="#LiveStreamDownloader.create_mp4-868"><span class="linenos">868</span></a>            <span class="c1"># Add faststart</span>
</span><span id="LiveStreamDownloader.create_mp4-869"><a href="#LiveStreamDownloader.create_mp4-869"><span class="linenos">869</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-movflags&quot;</span><span class="p">,</span> <span class="s2">&quot;faststart&quot;</span><span class="p">])</span>
</span><span id="LiveStreamDownloader.create_mp4-870"><a href="#LiveStreamDownloader.create_mp4-870"><span class="linenos">870</span></a>
</span><span id="LiveStreamDownloader.create_mp4-871"><a href="#LiveStreamDownloader.create_mp4-871"><span class="linenos">871</span></a>            <span class="c1"># Add mappings</span>
</span><span id="LiveStreamDownloader.create_mp4-872"><a href="#LiveStreamDownloader.create_mp4-872"><span class="linenos">872</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-873"><a href="#LiveStreamDownloader.create_mp4-873"><span class="linenos">873</span></a>                <span class="nb">input</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-map&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
</span><span id="LiveStreamDownloader.create_mp4-874"><a href="#LiveStreamDownloader.create_mp4-874"><span class="linenos">874</span></a>                <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-875"><a href="#LiveStreamDownloader.create_mp4-875"><span class="linenos">875</span></a>
</span><span id="LiveStreamDownloader.create_mp4-876"><a href="#LiveStreamDownloader.create_mp4-876"><span class="linenos">876</span></a>            <span class="k">if</span> <span class="n">thumbnail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-877"><a href="#LiveStreamDownloader.create_mp4-877"><span class="linenos">877</span></a>                <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.mkv&quot;</span><span class="p">:</span>  <span class="c1"># If file will be mkv, attach file instead</span>
</span><span id="LiveStreamDownloader.create_mp4-878"><a href="#LiveStreamDownloader.create_mp4-878"><span class="linenos">878</span></a>                    <span class="c1"># Use &quot;guess_file_type&quot; if function exists (added in 3.13), otherwise fall back to depreciated version</span>
</span><span id="LiveStreamDownloader.create_mp4-879"><a href="#LiveStreamDownloader.create_mp4-879"><span class="linenos">879</span></a>                    <span class="n">guess</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mimetypes</span><span class="p">,</span> <span class="s2">&quot;guess_file_type&quot;</span><span class="p">,</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-880"><a href="#LiveStreamDownloader.create_mp4-880"><span class="linenos">880</span></a>                    <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.create_mp4-881"><a href="#LiveStreamDownloader.create_mp4-881"><span class="linenos">881</span></a>                    <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-882"><a href="#LiveStreamDownloader.create_mp4-882"><span class="linenos">882</span></a>                        <span class="p">[</span>
</span><span id="LiveStreamDownloader.create_mp4-883"><a href="#LiveStreamDownloader.create_mp4-883"><span class="linenos">883</span></a>                            <span class="s2">&quot;-attach&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-884"><a href="#LiveStreamDownloader.create_mp4-884"><span class="linenos">884</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()),</span>
</span><span id="LiveStreamDownloader.create_mp4-885"><a href="#LiveStreamDownloader.create_mp4-885"><span class="linenos">885</span></a>                            <span class="s2">&quot;-metadata:s:t:0&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-886"><a href="#LiveStreamDownloader.create_mp4-886"><span class="linenos">886</span></a>                            <span class="s2">&quot;filename=cover</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;thumbnail&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.create_mp4-887"><a href="#LiveStreamDownloader.create_mp4-887"><span class="linenos">887</span></a>                            <span class="s2">&quot;-metadata:s:t:0&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-888"><a href="#LiveStreamDownloader.create_mp4-888"><span class="linenos">888</span></a>                            <span class="s2">&quot;mimetype=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mime_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span><span class="p">),</span>
</span><span id="LiveStreamDownloader.create_mp4-889"><a href="#LiveStreamDownloader.create_mp4-889"><span class="linenos">889</span></a>                        <span class="p">]</span>
</span><span id="LiveStreamDownloader.create_mp4-890"><a href="#LiveStreamDownloader.create_mp4-890"><span class="linenos">890</span></a>                    <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-891"><a href="#LiveStreamDownloader.create_mp4-891"><span class="linenos">891</span></a>
</span><span id="LiveStreamDownloader.create_mp4-892"><a href="#LiveStreamDownloader.create_mp4-892"><span class="linenos">892</span></a>                <span class="k">else</span><span class="p">:</span>  <span class="c1"># For other formats, attach using disposition instead</span>
</span><span id="LiveStreamDownloader.create_mp4-893"><a href="#LiveStreamDownloader.create_mp4-893"><span class="linenos">893</span></a>                    <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;-disposition:</span><span class="si">{</span><span class="n">thumbnail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;attached_pic&quot;</span><span class="p">])</span>
</span><span id="LiveStreamDownloader.create_mp4-894"><a href="#LiveStreamDownloader.create_mp4-894"><span class="linenos">894</span></a>
</span><span id="LiveStreamDownloader.create_mp4-895"><a href="#LiveStreamDownloader.create_mp4-895"><span class="linenos">895</span></a>            <span class="c1"># Add Copy codec</span>
</span><span id="LiveStreamDownloader.create_mp4-896"><a href="#LiveStreamDownloader.create_mp4-896"><span class="linenos">896</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">])</span>
</span><span id="LiveStreamDownloader.create_mp4-897"><a href="#LiveStreamDownloader.create_mp4-897"><span class="linenos">897</span></a>
</span><span id="LiveStreamDownloader.create_mp4-898"><a href="#LiveStreamDownloader.create_mp4-898"><span class="linenos">898</span></a>            <span class="c1"># Add metadata</span>
</span><span id="LiveStreamDownloader.create_mp4-899"><a href="#LiveStreamDownloader.create_mp4-899"><span class="linenos">899</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;DATE=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;upload_date&quot;</span><span class="p">))])</span>
</span><span id="LiveStreamDownloader.create_mp4-900"><a href="#LiveStreamDownloader.create_mp4-900"><span class="linenos">900</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-901"><a href="#LiveStreamDownloader.create_mp4-901"><span class="linenos">901</span></a>                <span class="p">[</span>
</span><span id="LiveStreamDownloader.create_mp4-902"><a href="#LiveStreamDownloader.create_mp4-902"><span class="linenos">902</span></a>                    <span class="s2">&quot;-metadata&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-903"><a href="#LiveStreamDownloader.create_mp4-903"><span class="linenos">903</span></a>                    <span class="s2">&quot;COMMENT=</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;original_url&quot;</span><span class="p">),</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
</span><span id="LiveStreamDownloader.create_mp4-904"><a href="#LiveStreamDownloader.create_mp4-904"><span class="linenos">904</span></a>                <span class="p">]</span>
</span><span id="LiveStreamDownloader.create_mp4-905"><a href="#LiveStreamDownloader.create_mp4-905"><span class="linenos">905</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-906"><a href="#LiveStreamDownloader.create_mp4-906"><span class="linenos">906</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;TITLE=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fulltitle&quot;</span><span class="p">))])</span>
</span><span id="LiveStreamDownloader.create_mp4-907"><a href="#LiveStreamDownloader.create_mp4-907"><span class="linenos">907</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;-metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;ARTIST=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;channel&quot;</span><span class="p">))])</span>
</span><span id="LiveStreamDownloader.create_mp4-908"><a href="#LiveStreamDownloader.create_mp4-908"><span class="linenos">908</span></a>
</span><span id="LiveStreamDownloader.create_mp4-909"><a href="#LiveStreamDownloader.create_mp4-909"><span class="linenos">909</span></a>            <span class="c1"># Add output file to ffmpeg command</span>
</span><span id="LiveStreamDownloader.create_mp4-910"><a href="#LiveStreamDownloader.create_mp4-910"><span class="linenos">910</span></a>            <span class="n">ffmpeg_builder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">base_output</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()))</span>
</span><span id="LiveStreamDownloader.create_mp4-911"><a href="#LiveStreamDownloader.create_mp4-911"><span class="linenos">911</span></a>
</span><span id="LiveStreamDownloader.create_mp4-912"><a href="#LiveStreamDownloader.create_mp4-912"><span class="linenos">912</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_ffmpeg_command&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-913"><a href="#LiveStreamDownloader.create_mp4-913"><span class="linenos">913</span></a>                <span class="n">ffmpeg_command_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.ffmpeg.txt&quot;</span>
</span><span id="LiveStreamDownloader.create_mp4-914"><a href="#LiveStreamDownloader.create_mp4-914"><span class="linenos">914</span></a>                <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">][</span><span class="s2">&quot;ffmpeg_cmd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-915"><a href="#LiveStreamDownloader.create_mp4-915"><span class="linenos">915</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">write_ffmpeg_command</span><span class="p">(</span><span class="n">ffmpeg_builder</span><span class="p">,</span> <span class="n">ffmpeg_command_file</span><span class="p">),</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;ffmpeg_command&quot;</span>
</span><span id="LiveStreamDownloader.create_mp4-916"><a href="#LiveStreamDownloader.create_mp4-916"><span class="linenos">916</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-917"><a href="#LiveStreamDownloader.create_mp4-917"><span class="linenos">917</span></a>
</span><span id="LiveStreamDownloader.create_mp4-918"><a href="#LiveStreamDownloader.create_mp4-918"><span class="linenos">918</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;merge&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader.create_mp4-919"><a href="#LiveStreamDownloader.create_mp4-919"><span class="linenos">919</span></a>                <span class="k">return</span> <span class="n">file_names</span>
</span><span id="LiveStreamDownloader.create_mp4-920"><a href="#LiveStreamDownloader.create_mp4-920"><span class="linenos">920</span></a>
</span><span id="LiveStreamDownloader.create_mp4-921"><a href="#LiveStreamDownloader.create_mp4-921"><span class="linenos">921</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FFmpeg command: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ffmpeg_builder</span><span class="p">)))</span>
</span><span id="LiveStreamDownloader.create_mp4-922"><a href="#LiveStreamDownloader.create_mp4-922"><span class="linenos">922</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing ffmpeg. Outputting to </span><span class="si">{</span><span class="n">ffmpeg_builder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-923"><a href="#LiveStreamDownloader.create_mp4-923"><span class="linenos">923</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-924"><a href="#LiveStreamDownloader.create_mp4-924"><span class="linenos">924</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-925"><a href="#LiveStreamDownloader.create_mp4-925"><span class="linenos">925</span></a>                    <span class="n">ffmpeg_builder</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-926"><a href="#LiveStreamDownloader.create_mp4-926"><span class="linenos">926</span></a>                    <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-927"><a href="#LiveStreamDownloader.create_mp4-927"><span class="linenos">927</span></a>                    <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-928"><a href="#LiveStreamDownloader.create_mp4-928"><span class="linenos">928</span></a>                    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-929"><a href="#LiveStreamDownloader.create_mp4-929"><span class="linenos">929</span></a>                    <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.create_mp4-930"><a href="#LiveStreamDownloader.create_mp4-930"><span class="linenos">930</span></a>                <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-931"><a href="#LiveStreamDownloader.create_mp4-931"><span class="linenos">931</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FFmpeg STDOUT: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-932"><a href="#LiveStreamDownloader.create_mp4-932"><span class="linenos">932</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FFmpeg STDERR: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-933"><a href="#LiveStreamDownloader.create_mp4-933"><span class="linenos">933</span></a>            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.create_mp4-934"><a href="#LiveStreamDownloader.create_mp4-934"><span class="linenos">934</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-935"><a href="#LiveStreamDownloader.create_mp4-935"><span class="linenos">935</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-936"><a href="#LiveStreamDownloader.create_mp4-936"><span class="linenos">936</span></a>                <span class="k">raise</span>
</span><span id="LiveStreamDownloader.create_mp4-937"><a href="#LiveStreamDownloader.create_mp4-937"><span class="linenos">937</span></a>
</span><span id="LiveStreamDownloader.create_mp4-938"><a href="#LiveStreamDownloader.create_mp4-938"><span class="linenos">938</span></a>            <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">][</span><span class="s2">&quot;merged&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">base_output</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-939"><a href="#LiveStreamDownloader.create_mp4-939"><span class="linenos">939</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.create_mp4-940"><a href="#LiveStreamDownloader.create_mp4-940"><span class="linenos">940</span></a>                <span class="s2">&quot;Successfully merged files into: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="LiveStreamDownloader.create_mp4-941"><a href="#LiveStreamDownloader.create_mp4-941"><span class="linenos">941</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-942"><a href="#LiveStreamDownloader.create_mp4-942"><span class="linenos">942</span></a>
</span><span id="LiveStreamDownloader.create_mp4-943"><a href="#LiveStreamDownloader.create_mp4-943"><span class="linenos">943</span></a>            <span class="c1"># Remove temp video and audio files</span>
</span><span id="LiveStreamDownloader.create_mp4-944"><a href="#LiveStreamDownloader.create_mp4-944"><span class="linenos">944</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_ts_files&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_temp_files&quot;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader.create_mp4-945"><a href="#LiveStreamDownloader.create_mp4-945"><span class="linenos">945</span></a>                <span class="k">if</span> <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-946"><a href="#LiveStreamDownloader.create_mp4-946"><span class="linenos">946</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()))</span>
</span><span id="LiveStreamDownloader.create_mp4-947"><a href="#LiveStreamDownloader.create_mp4-947"><span class="linenos">947</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-948"><a href="#LiveStreamDownloader.create_mp4-948"><span class="linenos">948</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-949"><a href="#LiveStreamDownloader.create_mp4-949"><span class="linenos">949</span></a>                <span class="k">if</span> <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.create_mp4-950"><a href="#LiveStreamDownloader.create_mp4-950"><span class="linenos">950</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()))</span>
</span><span id="LiveStreamDownloader.create_mp4-951"><a href="#LiveStreamDownloader.create_mp4-951"><span class="linenos">951</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-952"><a href="#LiveStreamDownloader.create_mp4-952"><span class="linenos">952</span></a>                    <span class="n">file_names</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="n">manifest</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.create_mp4-953"><a href="#LiveStreamDownloader.create_mp4-953"><span class="linenos">953</span></a>
</span><span id="LiveStreamDownloader.create_mp4-954"><a href="#LiveStreamDownloader.create_mp4-954"><span class="linenos">954</span></a>        <span class="k">return</span> <span class="n">file_names</span>
</span><span id="LiveStreamDownloader.create_mp4-955"><a href="#LiveStreamDownloader.create_mp4-955"><span class="linenos">955</span></a>        <span class="c1"># for file in file_names:</span>
</span><span id="LiveStreamDownloader.create_mp4-956"><a href="#LiveStreamDownloader.create_mp4-956"><span class="linenos">956</span></a>        <span class="c1">#    os.remove(file)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.write_ffmpeg_command" class="classattr">
                                        <input id="LiveStreamDownloader.write_ffmpeg_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_ffmpeg_command</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">command_array</span>, </span><span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.write_ffmpeg_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.write_ffmpeg_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.write_ffmpeg_command-958"><a href="#LiveStreamDownloader.write_ffmpeg_command-958"><span class="linenos">958</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_ffmpeg_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command_array</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-959"><a href="#LiveStreamDownloader.write_ffmpeg_command-959"><span class="linenos">959</span></a>        <span class="c1"># Determine the platform</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-960"><a href="#LiveStreamDownloader.write_ffmpeg_command-960"><span class="linenos">960</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-961"><a href="#LiveStreamDownloader.write_ffmpeg_command-961"><span class="linenos">961</span></a><span class="sd">        Builds a platform-compatible FFmpeg command with proper quoting.</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-962"><a href="#LiveStreamDownloader.write_ffmpeg_command-962"><span class="linenos">962</span></a>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-963"><a href="#LiveStreamDownloader.write_ffmpeg_command-963"><span class="linenos">963</span></a><span class="sd">        Args:</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-964"><a href="#LiveStreamDownloader.write_ffmpeg_command-964"><span class="linenos">964</span></a><span class="sd">            command_array (list): List of arguments to append to the command.</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-965"><a href="#LiveStreamDownloader.write_ffmpeg_command-965"><span class="linenos">965</span></a><span class="sd">            filename: Filename to write command to</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-966"><a href="#LiveStreamDownloader.write_ffmpeg_command-966"><span class="linenos">966</span></a>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-967"><a href="#LiveStreamDownloader.write_ffmpeg_command-967"><span class="linenos">967</span></a><span class="sd">        Returns:</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-968"><a href="#LiveStreamDownloader.write_ffmpeg_command-968"><span class="linenos">968</span></a><span class="sd">            str: A properly quoted FFmpeg command.</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-969"><a href="#LiveStreamDownloader.write_ffmpeg_command-969"><span class="linenos">969</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-970"><a href="#LiveStreamDownloader.write_ffmpeg_command-970"><span class="linenos">970</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>  <span class="c1"># Windows</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-971"><a href="#LiveStreamDownloader.write_ffmpeg_command-971"><span class="linenos">971</span></a>            <span class="c1"># Handle special quoting and escaping for Windows</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-972"><a href="#LiveStreamDownloader.write_ffmpeg_command-972"><span class="linenos">972</span></a>            <span class="n">quoted_args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-973"><a href="#LiveStreamDownloader.write_ffmpeg_command-973"><span class="linenos">973</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">command_array</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-974"><a href="#LiveStreamDownloader.write_ffmpeg_command-974"><span class="linenos">974</span></a>                <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-975"><a href="#LiveStreamDownloader.write_ffmpeg_command-975"><span class="linenos">975</span></a>                    <span class="c1"># Replace newlines with literal \n</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-976"><a href="#LiveStreamDownloader.write_ffmpeg_command-976"><span class="linenos">976</span></a>                    <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-977"><a href="#LiveStreamDownloader.write_ffmpeg_command-977"><span class="linenos">977</span></a>                <span class="c1"># Escape double quotes and wrap in double quotes if necessary</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-978"><a href="#LiveStreamDownloader.write_ffmpeg_command-978"><span class="linenos">978</span></a>                <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">arg</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-979"><a href="#LiveStreamDownloader.write_ffmpeg_command-979"><span class="linenos">979</span></a>                    <span class="n">arg</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-980"><a href="#LiveStreamDownloader.write_ffmpeg_command-980"><span class="linenos">980</span></a>                <span class="n">quoted_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-981"><a href="#LiveStreamDownloader.write_ffmpeg_command-981"><span class="linenos">981</span></a>            <span class="n">command_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">quoted_args</span><span class="p">))</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-982"><a href="#LiveStreamDownloader.write_ffmpeg_command-982"><span class="linenos">982</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># POSIX (Linux/macOS)</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-983"><a href="#LiveStreamDownloader.write_ffmpeg_command-983"><span class="linenos">983</span></a>            <span class="c1"># Use shlex.quote for safe quoting</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-984"><a href="#LiveStreamDownloader.write_ffmpeg_command-984"><span class="linenos">984</span></a>            <span class="c1"># quoted_args = [shlex.quote(arg) for arg in arguments]</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-985"><a href="#LiveStreamDownloader.write_ffmpeg_command-985"><span class="linenos">985</span></a>            <span class="n">command_string</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command_array</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-986"><a href="#LiveStreamDownloader.write_ffmpeg_command-986"><span class="linenos">986</span></a>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-987"><a href="#LiveStreamDownloader.write_ffmpeg_command-987"><span class="linenos">987</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-988"><a href="#LiveStreamDownloader.write_ffmpeg_command-988"><span class="linenos">988</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-989"><a href="#LiveStreamDownloader.write_ffmpeg_command-989"><span class="linenos">989</span></a>
</span><span id="LiveStreamDownloader.write_ffmpeg_command-990"><a href="#LiveStreamDownloader.write_ffmpeg_command-990"><span class="linenos">990</span></a>        <span class="k">return</span> <span class="n">filename</span>
</span></pre></div>


            <div class="docstring"><p>Builds a platform-compatible FFmpeg command with proper quoting.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>command_array (list):</strong>  List of arguments to append to the command.</li>
<li><strong>filename:</strong>  Filename to write command to</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>str: A properly quoted FFmpeg command.</p>
</blockquote>
</div>


                            </div>
                            <div id="LiveStreamDownloader.convert_bytes" class="classattr">
                                        <input id="LiveStreamDownloader.convert_bytes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_bytes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.convert_bytes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.convert_bytes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.convert_bytes-992"><a href="#LiveStreamDownloader.convert_bytes-992"><span class="linenos"> 992</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.convert_bytes-993"><a href="#LiveStreamDownloader.convert_bytes-993"><span class="linenos"> 993</span></a>        <span class="c1"># List of units in order</span>
</span><span id="LiveStreamDownloader.convert_bytes-994"><a href="#LiveStreamDownloader.convert_bytes-994"><span class="linenos"> 994</span></a>        <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">,</span> <span class="s2">&quot;PB&quot;</span><span class="p">,</span> <span class="s2">&quot;EB&quot;</span><span class="p">]</span>
</span><span id="LiveStreamDownloader.convert_bytes-995"><a href="#LiveStreamDownloader.convert_bytes-995"><span class="linenos"> 995</span></a>
</span><span id="LiveStreamDownloader.convert_bytes-996"><a href="#LiveStreamDownloader.convert_bytes-996"><span class="linenos"> 996</span></a>        <span class="c1"># Start with bytes and convert to larger units</span>
</span><span id="LiveStreamDownloader.convert_bytes-997"><a href="#LiveStreamDownloader.convert_bytes-997"><span class="linenos"> 997</span></a>        <span class="n">unit_index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LiveStreamDownloader.convert_bytes-998"><a href="#LiveStreamDownloader.convert_bytes-998"><span class="linenos"> 998</span></a>        <span class="k">while</span> <span class="nb">bytes</span> <span class="o">&gt;=</span> <span class="mi">1024</span> <span class="ow">and</span> <span class="n">unit_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.convert_bytes-999"><a href="#LiveStreamDownloader.convert_bytes-999"><span class="linenos"> 999</span></a>            <span class="nb">bytes</span> <span class="o">/=</span> <span class="mi">1024</span>
</span><span id="LiveStreamDownloader.convert_bytes-1000"><a href="#LiveStreamDownloader.convert_bytes-1000"><span class="linenos">1000</span></a>            <span class="n">unit_index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="LiveStreamDownloader.convert_bytes-1001"><a href="#LiveStreamDownloader.convert_bytes-1001"><span class="linenos">1001</span></a>
</span><span id="LiveStreamDownloader.convert_bytes-1002"><a href="#LiveStreamDownloader.convert_bytes-1002"><span class="linenos">1002</span></a>        <span class="c1"># Format and return the result</span>
</span><span id="LiveStreamDownloader.convert_bytes-1003"><a href="#LiveStreamDownloader.convert_bytes-1003"><span class="linenos">1003</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bytes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">units</span><span class="p">[</span><span class="n">unit_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.print_stats" class="classattr">
                                        <input id="LiveStreamDownloader.print_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">options</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.print_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.print_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.print_stats-1005"><a href="#LiveStreamDownloader.print_stats-1005"><span class="linenos">1005</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.print_stats-1006"><a href="#LiveStreamDownloader.print_stats-1006"><span class="linenos">1006</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stats_as_json&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1007"><a href="#LiveStreamDownloader.print_stats-1007"><span class="linenos">1007</span></a>            <span class="c1"># \033[K clears the line after printing the JSON</span>
</span><span id="LiveStreamDownloader.print_stats-1008"><a href="#LiveStreamDownloader.print_stats-1008"><span class="linenos">1008</span></a>            <span class="k">return</span>
</span><span id="LiveStreamDownloader.print_stats-1009"><a href="#LiveStreamDownloader.print_stats-1009"><span class="linenos">1009</span></a>
</span><span id="LiveStreamDownloader.print_stats-1010"><a href="#LiveStreamDownloader.print_stats-1010"><span class="linenos">1010</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.print_stats-1011"><a href="#LiveStreamDownloader.print_stats-1011"><span class="linenos">1011</span></a>            <span class="k">return</span>
</span><span id="LiveStreamDownloader.print_stats-1012"><a href="#LiveStreamDownloader.print_stats-1012"><span class="linenos">1012</span></a>
</span><span id="LiveStreamDownloader.print_stats-1013"><a href="#LiveStreamDownloader.print_stats-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">)):</span>
</span><span id="LiveStreamDownloader.print_stats-1014"><a href="#LiveStreamDownloader.print_stats-1014"><span class="linenos">1014</span></a>            <span class="k">return</span>
</span><span id="LiveStreamDownloader.print_stats-1015"><a href="#LiveStreamDownloader.print_stats-1015"><span class="linenos">1015</span></a>
</span><span id="LiveStreamDownloader.print_stats-1016"><a href="#LiveStreamDownloader.print_stats-1016"><span class="linenos">1016</span></a>        <span class="c1"># Build the output parts in a list</span>
</span><span id="LiveStreamDownloader.print_stats-1017"><a href="#LiveStreamDownloader.print_stats-1017"><span class="linenos">1017</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">]</span>
</span><span id="LiveStreamDownloader.print_stats-1018"><a href="#LiveStreamDownloader.print_stats-1018"><span class="linenos">1018</span></a>
</span><span id="LiveStreamDownloader.print_stats-1019"><a href="#LiveStreamDownloader.print_stats-1019"><span class="linenos">1019</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1020"><a href="#LiveStreamDownloader.print_stats-1020"><span class="linenos">1020</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="LiveStreamDownloader.print_stats-1021"><a href="#LiveStreamDownloader.print_stats-1021"><span class="linenos">1021</span></a>            <span class="n">v_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Video: </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;downloaded_segments&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;latest_sequence&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.print_stats-1022"><a href="#LiveStreamDownloader.print_stats-1022"><span class="linenos">1022</span></a>            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1023"><a href="#LiveStreamDownloader.print_stats-1023"><span class="linenos">1023</span></a>                <span class="n">v_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LiveStreamDownloader.print_stats-1024"><a href="#LiveStreamDownloader.print_stats-1024"><span class="linenos">1024</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_str</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.print_stats-1025"><a href="#LiveStreamDownloader.print_stats-1025"><span class="linenos">1025</span></a>
</span><span id="LiveStreamDownloader.print_stats-1026"><a href="#LiveStreamDownloader.print_stats-1026"><span class="linenos">1026</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1027"><a href="#LiveStreamDownloader.print_stats-1027"><span class="linenos">1027</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="LiveStreamDownloader.print_stats-1028"><a href="#LiveStreamDownloader.print_stats-1028"><span class="linenos">1028</span></a>            <span class="n">a_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Audio: </span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;downloaded_segments&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;latest_sequence&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="LiveStreamDownloader.print_stats-1029"><a href="#LiveStreamDownloader.print_stats-1029"><span class="linenos">1029</span></a>            <span class="c1"># Note: Fixed a likely typo in your original code where you checked</span>
</span><span id="LiveStreamDownloader.print_stats-1030"><a href="#LiveStreamDownloader.print_stats-1030"><span class="linenos">1030</span></a>            <span class="c1"># video status while printing audio stats</span>
</span><span id="LiveStreamDownloader.print_stats-1031"><a href="#LiveStreamDownloader.print_stats-1031"><span class="linenos">1031</span></a>            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1032"><a href="#LiveStreamDownloader.print_stats-1032"><span class="linenos">1032</span></a>                <span class="n">a_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="LiveStreamDownloader.print_stats-1033"><a href="#LiveStreamDownloader.print_stats-1033"><span class="linenos">1033</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_str</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.print_stats-1034"><a href="#LiveStreamDownloader.print_stats-1034"><span class="linenos">1034</span></a>
</span><span id="LiveStreamDownloader.print_stats-1035"><a href="#LiveStreamDownloader.print_stats-1035"><span class="linenos">1035</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_filesize&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_filesize&quot;</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1036"><a href="#LiveStreamDownloader.print_stats-1036"><span class="linenos">1036</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;video&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_filesize&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.print_stats-1037"><a href="#LiveStreamDownloader.print_stats-1037"><span class="linenos">1037</span></a>                <span class="s2">&quot;current_filesize&quot;</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="LiveStreamDownloader.print_stats-1038"><a href="#LiveStreamDownloader.print_stats-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.print_stats-1039"><a href="#LiveStreamDownloader.print_stats-1039"><span class="linenos">1039</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;~</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="si">}</span><span class="s2"> downloaded&quot;</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.print_stats-1040"><a href="#LiveStreamDownloader.print_stats-1040"><span class="linenos">1040</span></a>
</span><span id="LiveStreamDownloader.print_stats-1041"><a href="#LiveStreamDownloader.print_stats-1041"><span class="linenos">1041</span></a>        <span class="c1"># Join everything with commas or spaces</span>
</span><span id="LiveStreamDownloader.print_stats-1042"><a href="#LiveStreamDownloader.print_stats-1042"><span class="linenos">1042</span></a>        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.print_stats-1043"><a href="#LiveStreamDownloader.print_stats-1043"><span class="linenos">1043</span></a>
</span><span id="LiveStreamDownloader.print_stats-1044"><a href="#LiveStreamDownloader.print_stats-1044"><span class="linenos">1044</span></a>        <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_line&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.print_stats-1045"><a href="#LiveStreamDownloader.print_stats-1045"><span class="linenos">1045</span></a>            <span class="k">pass</span>
</span><span id="LiveStreamDownloader.print_stats-1046"><a href="#LiveStreamDownloader.print_stats-1046"><span class="linenos">1046</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.print_stats-1047"><a href="#LiveStreamDownloader.print_stats-1047"><span class="linenos">1047</span></a>            <span class="c1"># \r moves to start, \033[K clears anything left over from the previous longer line</span>
</span><span id="LiveStreamDownloader.print_stats-1048"><a href="#LiveStreamDownloader.print_stats-1048"><span class="linenos">1048</span></a>            <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.add_url_param" class="classattr">
                                        <input id="LiveStreamDownloader.add_url_param-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_url_param</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">key</span>, </span><span class="param"><span class="n">value</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.add_url_param-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.add_url_param"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.add_url_param-1050"><a href="#LiveStreamDownloader.add_url_param-1050"><span class="linenos">1050</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_url_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.add_url_param-1051"><a href="#LiveStreamDownloader.add_url_param-1051"><span class="linenos">1051</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.add_url_param-1052"><a href="#LiveStreamDownloader.add_url_param-1052"><span class="linenos">1052</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.add_url_param-1053"><a href="#LiveStreamDownloader.add_url_param-1053"><span class="linenos">1053</span></a>        <span class="n">query</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>  <span class="c1"># add or replace parameter</span>
</span><span id="LiveStreamDownloader.add_url_param-1054"><a href="#LiveStreamDownloader.add_url_param-1054"><span class="linenos">1054</span></a>
</span><span id="LiveStreamDownloader.add_url_param-1055"><a href="#LiveStreamDownloader.add_url_param-1055"><span class="linenos">1055</span></a>        <span class="n">new_query</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.add_url_param-1056"><a href="#LiveStreamDownloader.add_url_param-1056"><span class="linenos">1056</span></a>        <span class="n">new_url</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">new_query</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.add_url_param-1057"><a href="#LiveStreamDownloader.add_url_param-1057"><span class="linenos">1057</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">urlunparse</span><span class="p">(</span><span class="n">new_url</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.trim_info_json" class="classattr">
                                        <input id="LiveStreamDownloader.trim_info_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trim_info_json</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">info_dict</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">keys_to_keep</span><span class="p">:</span> <span class="nb">set</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.trim_info_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.trim_info_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.trim_info_json-1059"><a href="#LiveStreamDownloader.trim_info_json-1059"><span class="linenos">1059</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">trim_info_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">keys_to_keep</span><span class="p">:</span> <span class="nb">set</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.trim_info_json-1060"><a href="#LiveStreamDownloader.trim_info_json-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">info_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">keys_to_keep</span><span class="p">}</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict" class="classattr">
                                        <input id="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_format_segment_playlist_from_info_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">info_dict</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.remove_format_segment_playlist_from_info_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1062"><a href="#LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1062"><span class="linenos">1062</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_format_segment_playlist_from_info_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1063"><a href="#LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1063"><span class="linenos">1063</span></a>        <span class="k">for</span> <span class="n">stream_format</span> <span class="ow">in</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;formats&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1064"><a href="#LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1064"><span class="linenos">1064</span></a>            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1065"><a href="#LiveStreamDownloader.remove_format_segment_playlist_from_info_dict-1065"><span class="linenos">1065</span></a>                <span class="n">stream_format</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fragments&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="LiveStreamDownloader.refresh_info_json" class="classattr">
                                        <input id="LiveStreamDownloader.refresh_info_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">refresh_info_json</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">update_threshold</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">video_id</span>,</span><span class="param">	<span class="n">cookies</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">additional_options</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LiveStreamDownloader.refresh_info_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LiveStreamDownloader.refresh_info_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LiveStreamDownloader.refresh_info_json-1067"><a href="#LiveStreamDownloader.refresh_info_json-1067"><span class="linenos">1067</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_info_json</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1068"><a href="#LiveStreamDownloader.refresh_info_json-1068"><span class="linenos">1068</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1069"><a href="#LiveStreamDownloader.refresh_info_json-1069"><span class="linenos">1069</span></a>        <span class="n">update_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1070"><a href="#LiveStreamDownloader.refresh_info_json-1070"><span class="linenos">1070</span></a>        <span class="n">video_id</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1071"><a href="#LiveStreamDownloader.refresh_info_json-1071"><span class="linenos">1071</span></a>        <span class="n">cookies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1072"><a href="#LiveStreamDownloader.refresh_info_json-1072"><span class="linenos">1072</span></a>        <span class="n">additional_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1073"><a href="#LiveStreamDownloader.refresh_info_json-1073"><span class="linenos">1073</span></a>        <span class="n">include_dash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1074"><a href="#LiveStreamDownloader.refresh_info_json-1074"><span class="linenos">1074</span></a>        <span class="n">include_m3u8</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1075"><a href="#LiveStreamDownloader.refresh_info_json-1075"><span class="linenos">1075</span></a>    <span class="p">):</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1076"><a href="#LiveStreamDownloader.refresh_info_json-1076"><span class="linenos">1076</span></a>        <span class="c1"># Check if time difference is greater than the threshold. If doesn&#39;t exist, subtraction of zero will always be true</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1077"><a href="#LiveStreamDownloader.refresh_info_json-1077"><span class="linenos">1077</span></a>        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;refresh_time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">update_threshold</span><span class="p">:</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1078"><a href="#LiveStreamDownloader.refresh_info_json-1078"><span class="linenos">1078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span> <span class="o">=</span> <span class="n">get_video_info</span><span class="p">(</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1079"><a href="#LiveStreamDownloader.refresh_info_json-1079"><span class="linenos">1079</span></a>                <span class="n">video_id</span><span class="o">=</span><span class="n">video_id</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1080"><a href="#LiveStreamDownloader.refresh_info_json-1080"><span class="linenos">1080</span></a>                <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1081"><a href="#LiveStreamDownloader.refresh_info_json-1081"><span class="linenos">1081</span></a>                <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1082"><a href="#LiveStreamDownloader.refresh_info_json-1082"><span class="linenos">1082</span></a>                <span class="n">additional_options</span><span class="o">=</span><span class="n">additional_options</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1083"><a href="#LiveStreamDownloader.refresh_info_json-1083"><span class="linenos">1083</span></a>                <span class="n">include_dash</span><span class="o">=</span><span class="n">include_dash</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1084"><a href="#LiveStreamDownloader.refresh_info_json-1084"><span class="linenos">1084</span></a>                <span class="n">include_m3u8</span><span class="o">=</span><span class="n">include_m3u8</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1085"><a href="#LiveStreamDownloader.refresh_info_json-1085"><span class="linenos">1085</span></a>                <span class="n">clean_info_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1086"><a href="#LiveStreamDownloader.refresh_info_json-1086"><span class="linenos">1086</span></a>            <span class="p">)</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1087"><a href="#LiveStreamDownloader.refresh_info_json-1087"><span class="linenos">1087</span></a>
</span><span id="LiveStreamDownloader.refresh_info_json-1088"><a href="#LiveStreamDownloader.refresh_info_json-1088"><span class="linenos">1088</span></a>            <span class="c1"># Remove unnecessary items for info.json used purely for url refresh</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1089"><a href="#LiveStreamDownloader.refresh_info_json-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_format_segment_playlist_from_info_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1090"><a href="#LiveStreamDownloader.refresh_info_json-1090"><span class="linenos">1090</span></a>
</span><span id="LiveStreamDownloader.refresh_info_json-1091"><a href="#LiveStreamDownloader.refresh_info_json-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;thumbnails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1092"><a href="#LiveStreamDownloader.refresh_info_json-1092"><span class="linenos">1092</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1093"><a href="#LiveStreamDownloader.refresh_info_json-1093"><span class="linenos">1093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1094"><a href="#LiveStreamDownloader.refresh_info_json-1094"><span class="linenos">1094</span></a>
</span><span id="LiveStreamDownloader.refresh_info_json-1095"><a href="#LiveStreamDownloader.refresh_info_json-1095"><span class="linenos">1095</span></a>            <span class="c1"># Add refresh time for reference</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1096"><a href="#LiveStreamDownloader.refresh_info_json-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">[</span><span class="s2">&quot;refresh_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1097"><a href="#LiveStreamDownloader.refresh_info_json-1097"><span class="linenos">1097</span></a>
</span><span id="LiveStreamDownloader.refresh_info_json-1098"><a href="#LiveStreamDownloader.refresh_info_json-1098"><span class="linenos">1098</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span>
</span><span id="LiveStreamDownloader.refresh_info_json-1099"><a href="#LiveStreamDownloader.refresh_info_json-1099"><span class="linenos">1099</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">live_status</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="__version__">
                    <div class="attr variable">
            <span class="name">__version__</span>        =
<span class="default_value">&#39;0.0.0&#39;</span>

        
    </div>
    <a class="headerlink" href="#__version__"></a>
    
    

                </section>
    </main>
</body>
</html>